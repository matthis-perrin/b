{"version":3,"file":"index.js","mappings":"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CA;AACA;AACA,4BAA4BA,WAAY;AACxC;AACA;AACA;AACA;AACA,0CAA0CA,WAAY;AACtD;AACA;AACA,4DAA4DA,WAAY;AACxE,wCAAwCA,WAAY;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8BA,WAAY;AAC1C,8BAA8BA,WAAY;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA,0CACImJ,MAAM,GACD;AACT,4BAA4BA,MAAM,CAACC,SAAU,IAAGD,MAAM,CAACG,UAAW,IAAG,GAC7D,EACL;AACH;AACA;AACA;AACA;AACA;AACA,mDAAmDtJ,WAAY;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBACImJ,MAAM,GACD;AACT,qDAAqDnJ,WAAY;AACjE;AACA,8CAA8C,GACrC;AACT,0CACG;AACH;AACA,EAAE,GACI,EACL;AACD,EACEgJ,wBAAwB,KAAKxO,SAAS,GACjC;AACP;AACA,sDAAsDwF,WAAY;AAClE;AACA;AACA,wCAAwCA,WAAY;AACpD;AACA,8CAA8CA,WAAY;AAC1D;AACA;AACA,wCAAwCA,WAAY;AACpD,2BAA2BA,WAAY,SAAQgJ,wBAAyB;AACxE,gCAAgCA,wBAAyB,UACrDA,wBAAwB,GAAG,CAAC,GAAG,GAAG,GAAG,EACtC;AACH;AACA;AACA,0CAA0ChJ,WAAY;AACtD,qCAAqCA,WAAY;AACjD,+BAA+BA,WAAY;AAC3C;AACA,CAAC,GACK,EACL;AACD;AACA;AACA,2BAA2BA,WAAY;AACvC,YAAYyB,aAAc,IAAGzB,WAAY;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgByB,aAAc,IAAGzB,WAAY;AAC7C,4CAA4CA,WAAY;AACxD;AACA;AACA;AACA;AACA;AACA,uCAAuCA,WAAY;AACnD,wBAAwByB,aAAc,IAAGzB,WAAY;AACrD;AACA;AACA,6BAA6BA,WAAY;AACzC,YAAYyB,aAAc,IAAGzB,WAAY;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyCA,WAAY;AACrD,yCAAyCA,WAAY;AACrD;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6CA,WAAY;AACzD,8BAA8BA,WAAY;AAC1C,gCAAgCA,WAAY;AAC5C;AACA,EACEiJ,UAAU,KAAKzO,SAAS,GACnB;AACP;AACA;AACA,+CAA+CwF,WAAY;AAC3D,sBAAsByB,aAAc,IAAGzB,WAAY;AACnD;AACA,8CAA8CA,WAAY;AAC1D;AACA;AACA,uBAAuByB,aAAc,IAAGzB,WAAY;AACpD,uBAAuByB,aAAc;AACrC;AACA;AACA;AACA;AACA;AACA;AACA,0CAA0CzB,WAAY;AACtD,2BAA2ByB,aAAc,IAAGzB,WAAY;AACxD,2DAA2DA,WAAY;AACvE,2DAA2DA,WAAY;AACvE;AACA;AACA;AACA;AACA;AACA;AACA,yCAAyCA,WAAY;AACrD,yCAAyCA,WAAY;AACrD;AACA;AACA,4BAA4BA,WAAY;AACxC,YAAYyB,aAAc,IAAGzB,WAAY;AACzC;AACA;AACA,yCAAyCA,WAAY;AACrD,iBAAiBiJ,UAAW;AAC5B;AACA,8BAA8BjJ,WAAY;AAC1C;AACA,CAAC,GACK,EACL;AACD;AACA,4BAA4BA,WAAY;AACxC;AACA,sBAAsBA,WAAY;AAClC;AACA;AACA;AACA,CAAC,CAAC2G,IAAI,CAAC,CAAC;AACR;;;;;;;;;;AChXO,SAASkC,4BAA4BA,CAACpH,aAA4B,EAAU;EACjF,OAAQ;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmBA,aAAc;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,CAACkF,IAAI,CAAC,CAAC;AACR;;;;;;;;;;AC1CO,SAASmC,yBAAyBA,CACvCrH,aAA4B,EAC5BoI,eAA8B,EACtB;EACR,MAAMJ,UAAU,GAAGhI,aAAa,CAAC8E,WAAW,CAA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","sources":["webpack://b/external node-commonjs \"node:fs/promises\"","webpack://b/external node-commonjs \"node:path\"","webpack://b/external node-commonjs \"prompts\"","webpack://b/./src/fs.ts","webpack://b/external node-commonjs \"node:child_process\"","webpack://b/external node-commonjs \"node:fs\"","webpack://b/external node-commonjs \"prettier\"","webpack://b/./src/logger.ts","webpack://b/./src/models.ts","webpack://b/./src/project/generate_workspace.ts","webpack://b/external node-commonjs \"node:url\"","webpack://b/./src/hash.ts","webpack://b/external node-commonjs \"node:crypto\"","webpack://b/./src/project/generate_project.ts","webpack://b/./src/rand_safe.ts","webpack://b/./src/string_utils.ts","webpack://b/./src/project/gitignore.ts","webpack://b/./src/project/package_json.ts","webpack://b/./src/versions.ts","webpack://b/./src/project/terraform/all.ts","webpack://b/./src/project/terraform/frontend.ts","webpack://b/./src/project/terraform/lambda.ts","webpack://b/./src/project/terraform/provider.ts","webpack://b/./src/project/terraform/s3.ts","webpack://b/./src/type_utils.ts","webpack://b/./src/project/terraform/dynamo_user.ts","webpack://b/./src/project/terraform/dynamo_user_session.ts","webpack://b/./src/project/vscode_workspace.ts","webpack://b/webpack/bootstrap","webpack://b/webpack/runtime/compat get default export","webpack://b/webpack/runtime/define property getters","webpack://b/webpack/runtime/hasOwnProperty shorthand","webpack://b/webpack/runtime/make namespace object","webpack://b/./src/project/init_project.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:fs/promises\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:path\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"prompts\");","import {exec} from 'node:child_process';\nimport {promises, readFileSync} from 'node:fs';\nimport {dirname, join} from 'node:path';\n\nimport {BuiltInParserName, format} from 'prettier';\n\nexport const {access, readFile: readFileInternal, readdir, stat} = promises;\nconst {writeFile, mkdir, rm} = promises;\n\nexport async function readFile(path: string): Promise<string> {\n  const buffer = await readFileInternal(path);\n  return buffer.toString();\n}\n\nconst prettierConfig = (parser: BuiltInParserName) =>\n  ({\n    parser,\n    printWidth: 100,\n    singleQuote: true,\n    trailingComma: 'es5',\n    bracketSpacing: false,\n    arrowParens: 'avoid',\n    endOfLine: 'auto',\n  }) as const;\n\nexport async function prettierFormat(str: string, parser: BuiltInParserName): Promise<string> {\n  return format(str, prettierConfig(parser));\n}\n\nexport async function writeRawFile(path: string, content: string): Promise<void> {\n  await mkdir(dirname(path), {recursive: true});\n  await writeFile(path, content);\n}\n\nexport async function prettyJson(json: unknown, opts?: {compact?: boolean}): Promise<string> {\n  const {compact} = opts ?? {};\n  return format(\n    compact ? JSON.stringify(json) : JSON.stringify(json, undefined, 2),\n    prettierConfig('json')\n  );\n}\nexport async function writeJsonFile(path: string, json: unknown): Promise<void> {\n  await writeRawFile(path, await prettyJson(json));\n}\n\nexport async function prettyJs(js: string): Promise<string> {\n  return format(js, prettierConfig('babel'));\n}\nexport async function writeJsFile(path: string, js: string): Promise<void> {\n  await writeRawFile(path, await prettyJs(js));\n}\n\nexport async function prettyTs(ts: string): Promise<string> {\n  return format(ts, prettierConfig('typescript'));\n}\nexport async function writeTsFile(path: string, ts: string): Promise<void> {\n  await writeRawFile(path, await prettyTs(ts));\n}\n\nexport async function writeRawFileIfNotExists(path: string, content: string): Promise<void> {\n  if (await exists(path)) {\n    return;\n  }\n  await writeRawFile(path, content);\n}\n\nexport async function rmDir(dirPath: string): Promise<void> {\n  await rm(dirPath, {recursive: true, force: true});\n}\n\nexport async function cleanDir(dirPath: string): Promise<void> {\n  try {\n    await rmDir(dirPath);\n  } finally {\n    await mkdir(dirPath, {recursive: true});\n  }\n}\n\nexport async function cp(from: string, to: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    exec(`cp -R ${from} ${to}`, err => (err ? reject(err) : resolve()));\n  });\n}\n\nexport async function exists(path: string): Promise<boolean> {\n  try {\n    await access(path);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport async function maybeReadFile(path: string): Promise<string | undefined> {\n  try {\n    const fileContent = await readFile(path);\n    return fileContent.toString();\n  } catch {\n    return undefined;\n  }\n}\n\nexport function maybeReadFileSync(path: string): string | undefined {\n  try {\n    const fileContent = readFileSync(path);\n    return fileContent.toString();\n  } catch {\n    return undefined;\n  }\n}\n\nexport async function listFiles(path: string): Promise<string[]> {\n  const files: string[] = [];\n  const ents = await readdir(path, {withFileTypes: true});\n  const promises: Promise<void>[] = [];\n  for (const ent of ents) {\n    const entPath = join(path, ent.name);\n    if (ent.isDirectory()) {\n      promises.push(\n        listFiles(entPath).then(subFiles => {\n          files.push(...subFiles);\n        })\n      );\n    } else if (ent.isFile()) {\n      files.push(entPath);\n    }\n  }\n  await Promise.all(promises);\n  return files;\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:child_process\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:fs\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"prettier\");","export const {log, error} = console;\n","import {Brand} from '@src/type_utils';\n\nexport type WorkspaceName = Brand<string, 'WorkspaceName'>;\nexport type ProjectName = Brand<string, 'ProjectName'>;\n\n//\n// Project type\n//\n\nexport enum ProjectType {\n  Web = 'web',\n  LambdaFunction = 'lambda_function',\n  LambdaApi = 'lambda_api',\n  LambdaWebApi = 'lambda_web_api',\n  NodeScript = 'node_script',\n  Shared = 'shared',\n  SharedNode = 'shared-node',\n  SharedWeb = 'shared-web',\n}\n\nexport enum EslintType {\n  Web = 'web',\n  Node = 'node',\n  Lib = 'lib',\n}\n\nexport enum TsConfigType {\n  Web = 'web',\n  Node = 'node',\n  Lib = 'lib',\n}\nexport enum WebpackType {\n  Web = 'web',\n  Lib = 'lib', // shared\n  Lambda = 'lambda',\n  NodeScript = 'node-script',\n}\n\nexport interface ProjectTypeMetadata {\n  eslint: EslintType;\n  tsconfig: TsConfigType;\n  webpack?: WebpackType;\n}\n\nexport const PROJECT_TYPE_TO_METADATA = {\n  [ProjectType.Web]: {\n    eslint: EslintType.Web,\n    tsconfig: TsConfigType.Web,\n    webpack: WebpackType.Web,\n  },\n  [ProjectType.LambdaFunction]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lambda,\n  },\n  [ProjectType.LambdaApi]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lambda,\n  },\n  [ProjectType.LambdaWebApi]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lambda,\n  },\n  [ProjectType.NodeScript]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.NodeScript,\n  },\n  [ProjectType.Shared]: {\n    eslint: EslintType.Lib,\n    tsconfig: TsConfigType.Lib,\n    webpack: WebpackType.Lib,\n  },\n  [ProjectType.SharedNode]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lib,\n  },\n  [ProjectType.SharedWeb]: {\n    eslint: EslintType.Web,\n    tsconfig: TsConfigType.Web,\n    webpack: WebpackType.Lib,\n  },\n} satisfies Record<ProjectType, ProjectTypeMetadata>;\n\n//\n// Workspace Fragment type\n//\n\nexport enum WorkspaceFragmentType {\n  StaticWebsite = 'static-website',\n  StandaloneLambda = 'standalone-lambda',\n  ApiLambda = 'api-lambda',\n  WebApp = 'web-app',\n  NodeScript = 'node-script',\n  Shared = 'shared',\n  SharedNode = 'shared-node',\n  SharedWeb = 'shared-web',\n}\n\ninterface WorkspaceFragmentBase {\n  type: WorkspaceFragmentType;\n}\n\nexport interface WorkspaceFragmentRegistry {\n  [WorkspaceFragmentType.StaticWebsite]: {\n    type: WorkspaceFragmentType.StaticWebsite;\n    websiteName: ProjectName;\n  };\n  [WorkspaceFragmentType.StandaloneLambda]: {\n    type: WorkspaceFragmentType.StandaloneLambda;\n    lambdaName: ProjectName;\n    alarmEmail: string | undefined;\n    cloudwatchTriggerMinutes: number | undefined;\n  };\n  [WorkspaceFragmentType.ApiLambda]: {\n    type: WorkspaceFragmentType.ApiLambda;\n    lambdaName: ProjectName;\n    alarmEmail: string | undefined;\n    domain: string | undefined;\n  };\n  [WorkspaceFragmentType.WebApp]: {\n    type: WorkspaceFragmentType.WebApp;\n    websiteName: ProjectName;\n    lambdaName: ProjectName;\n    alarmEmail: string | undefined;\n    domain: string | undefined;\n  };\n  [WorkspaceFragmentType.NodeScript]: {\n    type: WorkspaceFragmentType.NodeScript;\n    scriptName: ProjectName;\n  };\n  [WorkspaceFragmentType.Shared]: {\n    type: WorkspaceFragmentType.Shared;\n  };\n  [WorkspaceFragmentType.SharedNode]: {\n    type: WorkspaceFragmentType.SharedNode;\n  };\n  [WorkspaceFragmentType.SharedWeb]: {\n    type: WorkspaceFragmentType.SharedWeb;\n  };\n}\n\ntype RegistryIsValid = WorkspaceFragmentRegistry extends Record<\n  WorkspaceFragmentType,\n  WorkspaceFragmentBase\n>\n  ? boolean\n  : never;\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateRegistry(): RegistryIsValid {\n  return true;\n}\n\nexport type WorkspaceFragment = WorkspaceFragmentRegistry[keyof WorkspaceFragmentRegistry];\n","import {execSync} from 'node:child_process';\nimport {join, relative} from 'node:path';\nimport {fileURLToPath} from 'node:url';\n\nimport {listFiles, prettyJs, prettyJson, readFile, writeRawFile} from '@src/fs';\nimport {md5} from '@src/hash';\nimport {log} from '@src/logger';\nimport {\n  ProjectName,\n  ProjectType,\n  WorkspaceFragment,\n  WorkspaceFragmentType,\n  WorkspaceName,\n} from '@src/models';\nimport {generateProject} from '@src/project/generate_project';\nimport {generateGitIgnore} from '@src/project/gitignore';\nimport {generateWorkspacePackageJson} from '@src/project/package_json';\nimport {\n  generateCommonTerraform,\n  generateDummyTerraformCredentials,\n  generateWorkspaceProjectTerraform,\n} from '@src/project/terraform/all';\nimport {generateDynamoUserTerraform} from '@src/project/terraform/dynamo_user';\nimport {generateDynamoUserSessionTerraform} from '@src/project/terraform/dynamo_user_session';\nimport {\n  FileHash,\n  generateCodeWorkspace,\n  Workspace,\n  writeWorkspace,\n} from '@src/project/vscode_workspace';\nimport {lowerCase} from '@src/string_utils';\nimport {neverHappens, removeUndefined} from '@src/type_utils';\nimport {PACKAGE_VERSIONS} from '@src/versions';\n\nconst TEMPLATES_PATH = join(fileURLToPath(import.meta.url), '../templates');\n\nexport interface WorkspaceProject {\n  projectName: ProjectName;\n  type: ProjectType;\n  fromFragment: WorkspaceFragment;\n  vars: Record<string, string>;\n}\n\nexport function getProjectsFromWorkspaceFragment(\n  fragment: WorkspaceFragment,\n  allFragments: WorkspaceFragment[]\n): WorkspaceProject[] {\n  if (fragment.type === WorkspaceFragmentType.StaticWebsite) {\n    return [\n      {\n        projectName: fragment.websiteName,\n        type: ProjectType.Web,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.websiteName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.StandaloneLambda) {\n    return [\n      {\n        projectName: fragment.lambdaName,\n        type: ProjectType.LambdaFunction,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.lambdaName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.ApiLambda) {\n    return [\n      {\n        projectName: fragment.lambdaName,\n        type: ProjectType.LambdaApi,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.lambdaName,\n          __BACKEND_NAME__: fragment.lambdaName,\n          __BACKEND_NAME_UPPERCASE__: fragment.lambdaName.toUpperCase(),\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.WebApp) {\n    const vars = {\n      __PROJECT_NAME__: fragment.lambdaName,\n      __BACKEND_NAME__: fragment.lambdaName,\n      __BACKEND_NAME_UPPERCASE__: fragment.lambdaName.toUpperCase(),\n      __FRONTEND_NAME__: fragment.websiteName,\n      __FRONTEND_NAME_UPPERCASE__: fragment.websiteName.toUpperCase(),\n    };\n    return [\n      {\n        projectName: fragment.websiteName,\n        type: ProjectType.Web,\n        fromFragment: fragment,\n        vars,\n      },\n      {\n        projectName: fragment.lambdaName,\n        type: ProjectType.LambdaWebApi,\n        fromFragment: fragment,\n        vars,\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.NodeScript) {\n    return [\n      {\n        projectName: fragment.scriptName,\n        type: ProjectType.NodeScript,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.scriptName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.SharedNode) {\n    const projectName = 'shared-node' as ProjectName;\n    return [\n      {\n        projectName,\n        type: ProjectType.SharedNode,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: projectName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.SharedWeb) {\n    const projectName = 'shared-web' as ProjectName;\n    return [\n      {\n        projectName,\n        type: ProjectType.SharedWeb,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: projectName,\n        },\n      },\n    ];\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  } else if (fragment.type === WorkspaceFragmentType.Shared) {\n    const projectName = 'shared' as ProjectName;\n    const otherVars: Record<string, string> = {};\n    const [bestBackend] = removeUndefined(\n      allFragments.map(frag => {\n        if (frag.type === WorkspaceFragmentType.WebApp) {\n          return {name: frag.lambdaName, prio: 1};\n        } else if (frag.type === WorkspaceFragmentType.ApiLambda) {\n          return {name: frag.lambdaName, prio: 2};\n        }\n        return undefined;\n      })\n    ).sort((a, b) => a.prio - b.prio);\n    if (bestBackend) {\n      otherVars['__BACKEND_NAME__'] = bestBackend.name;\n      otherVars['__BACKEND_NAME_UPPERCASE__'] = bestBackend.name.toUpperCase();\n    }\n    return [\n      {\n        projectName,\n        type: ProjectType.Shared,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: projectName,\n          ...otherVars,\n        },\n      },\n    ];\n  }\n  neverHappens(fragment, `Unknown ProjectType ${(fragment as WorkspaceFragment).type}`);\n}\n\nexport async function generateWorkspace(\n  dst: string,\n  workspaceName: WorkspaceName,\n  workspaceFragments: WorkspaceFragment[],\n  workspace: Workspace | undefined\n): Promise<void> {\n  const projects = workspaceFragments.flatMap(f =>\n    getProjectsFromWorkspaceFragment(f, workspaceFragments)\n  );\n\n  // Create projects files from templates\n  const projectFiles = await Promise.all(\n    projects.map(async project => generateProject(dst, project, workspace, workspaceName))\n  );\n\n  // Generate workspace root files\n  const SCRIPTS_PATH = join(fileURLToPath(import.meta.url), '../scripts');\n  const writeFile = async (path: string, file: string): Promise<FileHash> =>\n    writeWorkspaceFile(workspace, dst, path, file);\n  const workspaceFiles = await Promise.all([\n    // package.json\n    writeFile(\n      'package.json',\n      await prettyJson(generateWorkspacePackageJson(workspaceName, projects))\n    ),\n    // app.code-workspace\n    writeFile(\n      'app.code-workspace',\n      await prettyJson(generateCodeWorkspace(workspaceName, workspaceFragments))\n    ),\n    // .gitignore\n    writeFile('.gitignore', generateGitIgnore()),\n    // setup.js\n    writeFile('setup.js', await prettyJs(await readFile(join(SCRIPTS_PATH, 'setup.js')))),\n    // deploy.js\n    writeFile('deploy.js', await prettyJs(await readFile(join(SCRIPTS_PATH, 'deploy.js')))),\n    // build.js\n    writeFile('build.js', await prettyJs(await readFile(join(SCRIPTS_PATH, 'build.js')))),\n  ]);\n\n  // Vscode folder\n  const vscodePath = join(TEMPLATES_PATH, '.vscode');\n  const vscodeFileList = await listFiles(vscodePath);\n  const vscodeFiles = await Promise.all(\n    vscodeFileList.map(async file => {\n      const relativePath = relative(vscodePath, file);\n      const dstPath = join('.vscode', relativePath);\n      const content = await readFile(file);\n      return writeFile(dstPath, content);\n    })\n  );\n\n  // Terraform folder generation\n  const tablePrefix = lowerCase(workspaceName);\n  const terraformFiles = await Promise.all([\n    writeFile(join('terraform', '.aws-credentials'), generateDummyTerraformCredentials()),\n    writeFile(\n      join('terraform', `dynamo_table_${tablePrefix}_user.tf`),\n      generateDynamoUserTerraform(workspaceName)\n    ),\n    writeFile(\n      join('terraform', `dynamo_table_${tablePrefix}_user_session.tf`),\n      generateDynamoUserSessionTerraform(workspaceName)\n    ),\n    writeFile(join('terraform', 'base.tf'), generateCommonTerraform(workspaceName, projects)),\n    ...projects.map(async p => {\n      const content = generateWorkspaceProjectTerraform(workspaceName, p);\n      if (content === undefined) {\n        return;\n      }\n      const name = `${p.projectName}_terraform`;\n      return writeFile(join('terraform', `${name}.tf`), content);\n    }),\n  ]);\n\n  await writeWorkspace(dst, {\n    files: removeUndefined([\n      ...projectFiles.flat(),\n      ...workspaceFiles,\n      ...terraformFiles,\n      ...vscodeFiles,\n    ]),\n    fragments: workspaceFragments,\n    version: PACKAGE_VERSIONS.project,\n  });\n\n  // Run setup.js\n  log('Running post install script');\n  const commands = [`cd ${dst}`, `node setup.js`, `git init`];\n  execSync(commands.join(' && '), {stdio: ['ignore', 'inherit', 'inherit']});\n\n  // Final instructions\n  log(`Run the following to get started:`);\n  log(`cd ${relative(process.cwd(), dst)}; code app.code-workspace; yarn watch`);\n}\n\nexport async function writeWorkspaceFile(\n  workspace: Workspace | undefined,\n  root: string,\n  path: string,\n  file: string\n): Promise<FileHash> {\n  const newHash = md5(file);\n  const oldHash = workspace?.files.find(f => f.path === path)?.hash;\n  // Only write the file if it is different since last time we've generated the project.\n  // Prevent needlessly overwriting changes made in the project in between.\n  if (newHash !== oldHash) {\n    await writeRawFile(join(root, path), file);\n  }\n  return {path, hash: newHash};\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:url\");","import {createHash} from 'node:crypto';\n\nexport function md5(data: string | Buffer): string {\n  const content = typeof data === 'string' ? data : data.toString();\n  return createHash('md5').update(content).digest('hex');\n}\n\nexport function hashPassword(password: string, salt: string): string {\n  return createHash('sha256').update(`${password}${salt}`).digest('base64');\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:crypto\");","import {join, relative} from 'node:path';\nimport {fileURLToPath} from 'node:url';\n\nimport {listFiles, prettierFormat, prettyJson, readFile} from '@src/fs';\nimport {WorkspaceProject, writeWorkspaceFile} from '@src/project/generate_workspace';\nimport {FileHash, Workspace} from '@src/project/vscode_workspace';\nimport {randomStringSafe} from '@src/rand_safe';\nimport {upperCase} from '@src/string_utils';\n\nconst TEMPLATES_PATH = join(fileURLToPath(import.meta.url), '../templates');\n\nexport async function generateProject(\n  dst: string,\n  project: WorkspaceProject,\n  workspace: Workspace | undefined,\n  workspaceName: string\n): Promise<FileHash[]> {\n  const written: FileHash[] = [];\n  const writeFile = async (path: string, file: string): Promise<FileHash> =>\n    writeWorkspaceFile(workspace, dst, path, file);\n  const {projectName, type, vars} = project;\n  const defaultVars = {\n    __WORKSPACE_NAME__: workspaceName,\n    __WORKSPACE_NAME_UPPERCASE__: upperCase(workspaceName),\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    __COOKIE_ENCRYPTION_KEY__: randomStringSafe(32),\n  };\n\n  // Copy template files\n  const templatePath = join(TEMPLATES_PATH, type);\n  const files = await listFiles(templatePath);\n  await Promise.all(\n    files.map(async file => {\n      const relativePath = relative(templatePath, file);\n      const dstPath = join(projectName, relativePath);\n      const content = await readFile(file);\n      let newContent = content;\n      for (const [varName, varValue] of Object.entries({...vars, ...defaultVars})) {\n        newContent = newContent.replaceAll(varName, varValue);\n      }\n      if (file.endsWith('.ts') || file.endsWith('.tsx')) {\n        newContent = await prettierFormat(newContent, 'typescript');\n      }\n      if (file.endsWith('.json')) {\n        if (file.endsWith('package.json')) {\n          const packageJson = JSON.parse(await readFile(file));\n          packageJson['name'] = projectName;\n          newContent = await prettyJson(packageJson);\n        } else {\n          newContent = await prettierFormat(newContent, 'json');\n        }\n      }\n      written.push(await writeFile(dstPath, newContent));\n    })\n  );\n\n  return written;\n}\n","import {randomBytes} from 'node:crypto';\n\nconst ALPHANUM = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\nexport function randomStringSafe(length: number, set?: string): string {\n  let result = '';\n  const characters = set ?? ALPHANUM;\n  const bytes = randomBytes(length);\n  for (const byte of bytes) {\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    result += characters[Math.floor((byte / 255) * (characters.length - 1))];\n  }\n  return result;\n}\n\nconst UID_LENGTH = 16;\nexport function uidSafe(prefix?: string): string {\n  const id = randomStringSafe(UID_LENGTH);\n  return prefix === undefined ? id : `${prefix}${id}`;\n}\n\nconst NONCE_BYTE_SIZE = 16;\nexport function generateNonce(): string {\n  return randomBytes(NONCE_BYTE_SIZE).toString('base64');\n}\n","export function capitalize(value: string): string {\n  const [firstChar] = value;\n  return firstChar === undefined ? '' : firstChar.toUpperCase() + value.slice(1);\n}\n\nexport function uncapitalize(value: string): string {\n  const [firstChar] = value;\n  return firstChar === undefined ? '' : firstChar.toLowerCase() + value.slice(1);\n}\n\nexport function pascalCase(str: string): string {\n  return str\n    .toLowerCase()\n    .split(/[^a-z]+/u)\n    .map(s => capitalize(s))\n    .join('');\n}\n\nexport function upperCase(str: string): string {\n  return str\n    .toUpperCase()\n    .split(/[^A-Z]+/u)\n    .join('_');\n}\n\nexport function lowerCase(str: string): string {\n  return str\n    .toLowerCase()\n    .split(/[^a-z]+/u)\n    .join('_');\n}\n","export function generateGitIgnore(): string {\n  return `\n.DS_Store\nnode_modules\nbuild\ndist\ntmp\nyarn-error.log\n.yarn-warnings.log\nyarn.lock\nterraform/.terraform\nterraform/.terraform*\nterraform/*.tfstate.backup\nterraform/.aws-credentials\nterraform/archives\n*/log\n/shared/src/env.ts\n    `.trim();\n}\n","import {PROJECT_TYPE_TO_METADATA, WorkspaceName} from '@src/models';\nimport {WorkspaceProject} from '@src/project/generate_workspace';\nimport {PACKAGE_VERSIONS, TYPESCRIPT_VERSION} from '@src/versions';\n\nfunction uniq<T>(val: T[]): T[] {\n  return [...new Set(val).values()];\n}\n\nexport function generateWorkspacePackageJson(\n  workspaceName: WorkspaceName,\n  projects: WorkspaceProject[]\n): Record<string, unknown> {\n  const eslintRuntimes = uniq(projects.map(p => PROJECT_TYPE_TO_METADATA[p.type].eslint));\n  const tsconfigRuntimes = uniq(projects.map(p => PROJECT_TYPE_TO_METADATA[p.type].tsconfig));\n  const webpackRuntimes = uniq(projects.map(p => PROJECT_TYPE_TO_METADATA[p.type].webpack));\n\n  return {\n    name: workspaceName,\n    license: 'UNLICENSED',\n    type: 'module',\n    engines: {\n      node: '>=20.10',\n    },\n    scripts: {\n      setup: 'node ./setup.js',\n      deploy: 'node ./deploy.js',\n      build: 'NODE_ENV=production node ./build.js',\n      watch: 'NODE_ENV=development node ./build.js --watch',\n    },\n    eslintConfig: {\n      ignorePatterns: ['**/*.js'],\n    },\n    prettier: '@matthis/prettier-config',\n    devDependencies: Object.fromEntries(\n      (\n        [\n          ...eslintRuntimes.map(runtime => [\n            `@matthis/eslint-config-${runtime}`,\n            PACKAGE_VERSIONS.eslint,\n          ]),\n          ['@matthis/prettier-config', PACKAGE_VERSIONS.prettier],\n          ...tsconfigRuntimes.map(runtime => [\n            `@matthis/tsconfig-${runtime}`,\n            PACKAGE_VERSIONS.tsconfig,\n          ]),\n          ...webpackRuntimes.map(runtime => [\n            `@matthis/webpack-${runtime}`,\n            PACKAGE_VERSIONS.webpack,\n          ]),\n          ['@matthis/webpack-runner', PACKAGE_VERSIONS.runner],\n          ['typescript', TYPESCRIPT_VERSION],\n        ] as [string, string][]\n      ).sort((d1, d2) => d1[0].localeCompare(d2[0]))\n    ),\n  };\n}\n","export const PACKAGE_VERSIONS = {\n  project: '1.9.31',\n  eslint: '1.5.6',\n  prettier: '1.3.0',\n  tsconfig: '1.6.1',\n  webpack: '1.6.33',\n  runner: '1.5.20',\n  lambdaServerRuntime: '1.0.6',\n};\n\nexport const ESLINT_VERSION = '8.56.x';\nexport const PRETTIER_VERSION = '3.1.x';\nexport const TYPESCRIPT_VERSION = '5.3.x';\n\nexport const LIB_VERSIONS = {\n  '@types/react': '18.2.x',\n  '@types/react-dom': '18.2.x',\n  react: '18.2.x',\n  'react-dom': '18.2.x',\n  'styled-components': '6.1.x',\n};\n","import {ProjectType, WorkspaceName} from '@src/models';\nimport {WorkspaceProject} from '@src/project/generate_workspace';\nimport {generateFrontendTerraform} from '@src/project/terraform/frontend';\nimport {generateLambdaTerraform, LambdaDomain} from '@src/project/terraform/lambda';\nimport {generateAwsProviderTerraform} from '@src/project/terraform/provider';\nimport {generateS3BucketTerraform} from '@src/project/terraform/s3';\nimport {neverHappens} from '@src/type_utils';\n\nexport function generateCommonTerraform(\n  workspaceName: WorkspaceName,\n  projects: WorkspaceProject[]\n): string {\n  return [\n    generateAwsProviderTerraform(workspaceName),\n    generateS3BucketTerraform(\n      workspaceName,\n      projects.filter(p => p.type === ProjectType.Web).map(p => p.projectName)\n    ),\n  ].join('\\n\\n');\n}\n\nexport function generateWorkspaceProjectTerraform(\n  workspaceName: WorkspaceName,\n  project: WorkspaceProject\n): string | undefined {\n  const {projectName, type, fromFragment} = project;\n  const cloudwatchTriggerMinutes =\n    'cloudwatchTriggerMinutes' in fromFragment ? fromFragment.cloudwatchTriggerMinutes : undefined;\n  const alarmEmail = 'alarmEmail' in fromFragment ? fromFragment.alarmEmail : undefined;\n  const domainStr = 'domain' in fromFragment ? fromFragment.domain : undefined;\n  let domain: LambdaDomain | undefined;\n  if (domainStr !== undefined) {\n    const [subDomain = '', ...rest] = domainStr.split('.');\n    const rootDomain = rest.join('.');\n    domain = {subDomain, rootDomain};\n  }\n  if (type === ProjectType.Web) {\n    return generateFrontendTerraform(projectName);\n  } else if (type === ProjectType.LambdaFunction) {\n    return generateLambdaTerraform(workspaceName, projectName, {\n      api: false,\n      web: false,\n      alarmEmail,\n      cloudwatchTriggerMinutes,\n      domain,\n    });\n  } else if (type === ProjectType.LambdaApi) {\n    return generateLambdaTerraform(workspaceName, projectName, {\n      api: true,\n      web: false,\n      alarmEmail,\n      cloudwatchTriggerMinutes,\n      domain,\n    });\n  } else if (type === ProjectType.LambdaWebApi) {\n    return generateLambdaTerraform(workspaceName, projectName, {\n      api: true,\n      web: true,\n      alarmEmail,\n      cloudwatchTriggerMinutes,\n      domain,\n    });\n  } else if (type === ProjectType.NodeScript) {\n    return undefined;\n  } else if (type === ProjectType.SharedNode) {\n    return undefined;\n  } else if (type === ProjectType.SharedWeb) {\n    return undefined;\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  } else if (type === ProjectType.Shared) {\n    return undefined;\n  }\n  neverHappens(type, 'ProjectType');\n}\n\nexport function generateDummyTerraformCredentials(): string {\n  return `\n[default]\naws_access_key_id=\naws_secret_access_key=\n`.trim();\n}\n","import {ProjectName} from '@src/models';\n\nexport function generateFrontendTerraform(projectName: ProjectName): string {\n  const bucketName = projectName.toLowerCase().replace(/[^\\d.a-z-]+/gu, '-');\n  const originId = `${bucketName}-origin-id`;\n  return `\noutput \"${projectName}_cloudfront_domain_name\" {\n  value       = aws_cloudfront_distribution.${projectName}.domain_name\n  description = \"Domain (from cloudfront) where the \\\\\"${projectName}\\\\\" is available.\"\n}\n\nresource \"aws_cloudfront_origin_access_identity\" \"${projectName}\" {}\n  \nresource \"aws_cloudfront_distribution\" \"${projectName}\" {\n  origin {\n    domain_name = aws_s3_bucket.code.bucket_regional_domain_name\n    origin_id   = \"${originId}\"\n    origin_path = \"/${projectName}\"\n\n    s3_origin_config {\n      origin_access_identity = aws_cloudfront_origin_access_identity.${projectName}.cloudfront_access_identity_path\n    }\n  }\n  \n  enabled             = true\n  wait_for_deployment = false\n  is_ipv6_enabled     = true\n  price_class         = \"PriceClass_100\"\n  \n  default_root_object = \"/index.html\"\n  custom_error_response {\n    error_code         = 400\n    response_code      = 200\n    response_page_path = \"/index.html\"\n  }\n  custom_error_response {\n    error_code         = 403\n    response_code      = 200\n    response_page_path = \"/index.html\"\n  }\n  custom_error_response {\n    error_code         = 404\n    response_code      = 200\n    response_page_path = \"/index.html\"\n  }\n\n  default_cache_behavior {\n    allowed_methods        = [\"HEAD\", \"GET\"]\n    cached_methods         = [\"HEAD\", \"GET\"]\n    compress               = true\n    target_origin_id       = \"${originId}\"\n    viewer_protocol_policy = \"redirect-to-https\"\n    \n    forwarded_values {\n      query_string = false\n      cookies {\n        forward = \"none\"\n      }\n    }\n  }\n\n  restrictions {\n    geo_restriction {\n      restriction_type = \"none\"\n    }\n  }\n\n  viewer_certificate {\n    cloudfront_default_certificate = true\n  }\n}\n  `.trim();\n}\n","import {ProjectName, WorkspaceName} from '@src/models';\nimport {lowerCase} from '@src/string_utils';\n\nexport interface LambdaDomain {\n  rootDomain: string;\n  subDomain: string;\n}\n\nexport function generateLambdaTerraform(\n  workspaceName: WorkspaceName,\n  projectName: ProjectName,\n  opts: {\n    api: boolean;\n    web: boolean;\n    alarmEmail: string | undefined;\n    cloudwatchTriggerMinutes: number | undefined;\n    domain: LambdaDomain | undefined;\n  }\n): string {\n  const {api, web, alarmEmail, cloudwatchTriggerMinutes, domain} = opts;\n  const prefixLower = lowerCase(workspaceName);\n  return `\n# Define any extra role for the lambda here\ndata \"aws_iam_policy_document\" \"${projectName}_extra_policy\" {\n  statement {\n    actions = [\n      \"dynamodb:GetItem\",\n      \"dynamodb:BatchGetItem\",\n      \"dynamodb:Query\",\n      \"dynamodb:Scan\",\n      \"dynamodb:PutItem\",\n      \"dynamodb:UpdateItem\",\n      \"dynamodb:DeleteItem\",\n    ]\n    resources = [\n      \"\\${aws_dynamodb_table.${prefixLower}_user_table.arn}\",\n      \"\\${aws_dynamodb_table.${prefixLower}_user_table.arn}/index/*\",\n      \"\\${aws_dynamodb_table.${prefixLower}_user_session_table.arn}\",\n      \"\\${aws_dynamodb_table.${prefixLower}_user_session_table.arn}/index/*\",\n    ]\n  }${\n    web\n      ? `\n\n  statement {\n    actions = [\n      \"s3:GetObject\",\n      \"s3:GetObjectTagging\"\n    ]\n    resources = [\n      \"\\${aws_s3_bucket.code.arn}/*\"\n    ]\n  }`\n      : ''\n  }\n}\n\nresource \"aws_lambda_function\" \"${projectName}\" {\n  function_name = \"${workspaceName}-${projectName}\"\n  s3_bucket     = aws_s3_object.${projectName}_archive.bucket\n  s3_key        = aws_s3_object.${projectName}_archive.key\n  handler       = \"index.handler\"\n  runtime       = \"nodejs20.x\"\n  role          = aws_iam_role.${projectName}_role.arn\n  timeout       = 900 // 15 minutes\n  memory_size   = 128 // Mo\n  environment {\n    variables = {${\n      api\n        ? `\n      NODE_OPTIONS            = \"--enable-source-maps\"\n      CLOUDFRONT_HEADER_NAME  = random_string.${projectName}_cloudfront_header_name.result\n      CLOUDFRONT_HEADER_VALUE = random_string.${projectName}_cloudfront_header_value.result`\n        : `\n      NODE_OPTIONS = \"--enable-source-maps\"`\n    }\n    }\n  }\n}\n\noutput \"${projectName}_function_name\" {\n  value       = aws_lambda_function.${projectName}.function_name\n  description = \"Function name of the \\\\\"${workspaceName}-${projectName}\\\\\" lambda\"\n}\n${\n  api\n    ? `\n# Lambda URL\n\nresource \"aws_lambda_function_url\" \"${projectName}\" {\n  function_name      = aws_lambda_function.${projectName}.function_name\n  authorization_type = \"NONE\"\n}\n\noutput \"${projectName}_url\" {\n  value       = \"https://\\${aws_cloudfront_distribution.${projectName}.domain_name}/\"\n  description = \"Cloudfront URL of \\\\\"${projectName}\\\\\"\"\n}${\n        domain !== undefined\n          ? `\n\n# Domain\n\ndata \"aws_route53_zone\" \"${projectName}\" {\n  name = \"${domain.rootDomain}\"\n}\n\nresource \"aws_route53_record\" \"${projectName}_a\" {\n  zone_id = data.aws_route53_zone.${projectName}.zone_id\n  name    = \"${domain.subDomain}.${domain.rootDomain}\"\n  type    = \"A\"\n\n  alias {\n    name                   = aws_cloudfront_distribution.${projectName}.domain_name\n    zone_id                = aws_cloudfront_distribution.${projectName}.hosted_zone_id\n    evaluate_target_health = false\n  }\n}\n\nresource \"aws_route53_record\" \"${projectName}_aaaa\" {\n  zone_id = data.aws_route53_zone.${projectName}.zone_id\n  name    = \"${domain.subDomain}.${domain.rootDomain}\"\n  type    = \"AAAA\"\n\n  alias {\n    name                   = aws_cloudfront_distribution.${projectName}.domain_name\n    zone_id                = aws_cloudfront_distribution.${projectName}.hosted_zone_id\n    evaluate_target_health = false\n  }\n}\n\nresource \"aws_acm_certificate\" \"${projectName}\" {\n  domain_name               = \"*.${domain.subDomain}.${domain.rootDomain}\"\n  subject_alternative_names = [\"${domain.subDomain}.${domain.rootDomain}\"]\n  validation_method         = \"DNS\"\n  provider                  = aws.us-east-1\n}\n\nresource \"aws_route53_record\" \"${projectName}_certificate_validation\" {\n  for_each = {\n    for dvo in aws_acm_certificate.${projectName}.domain_validation_options : dvo.domain_name => {\n      name   = dvo.resource_record_name\n      record = dvo.resource_record_value\n      type   = dvo.resource_record_type\n    }\n  }\n  provider        = aws.us-east-1\n  allow_overwrite = true\n  name            = each.value.name\n  records         = [each.value.record]\n  ttl             = 60\n  type            = each.value.type\n  zone_id         = data.aws_route53_zone.${projectName}.zone_id\n}\n\nresource \"aws_acm_certificate_validation\" \"${projectName}\" {\n  provider                = aws.us-east-1\n  certificate_arn         = aws_acm_certificate.${projectName}.arn\n  validation_record_fqdns = [for record in aws_route53_record.backend_certificate_validation : record.fqdn]\n}\n`\n          : ''\n      }\n\n# Cloudfront Distribution\n\nresource \"random_string\" \"${projectName}_cloudfront_header_name\" {\n  length  = 16\n  upper   = false\n  numeric = false\n  special = false\n}\n\nresource \"random_string\" \"${projectName}_cloudfront_header_value\" {\n  length  = 32\n  special = false\n}\n\nresource \"aws_cloudfront_distribution\" \"${projectName}\" {\n  origin {\n    # Remove \"https://\" prefix and \"/\" suffix\n    domain_name = replace(replace(aws_lambda_function_url.${projectName}.function_url, \"https://\", \"\"), \"/\", \"\")\n    origin_id   = aws_lambda_function.${projectName}.function_name\n\n    custom_origin_config {\n      https_port             = 443\n      http_port              = 80\n      origin_protocol_policy = \"https-only\"\n      origin_ssl_protocols   = [\"TLSv1.2\"]\n    }\n\n    custom_header {\n      name  = random_string.${projectName}_cloudfront_header_name.result\n      value = random_string.${projectName}_cloudfront_header_value.result\n    }\n  }\n\n  enabled             = true\n  wait_for_deployment = false\n  is_ipv6_enabled     = true\n  price_class         = \"PriceClass_100\"${\n    domain\n      ? `\n  aliases             = [\"${domain.subDomain}.${domain.rootDomain}\"]`\n      : ''\n  }\n\n  default_cache_behavior {\n    allowed_methods        = [\"DELETE\", \"GET\", \"HEAD\", \"OPTIONS\", \"PATCH\", \"POST\", \"PUT\"]\n    cached_methods         = [\"HEAD\", \"GET\"]\n    compress               = true\n    target_origin_id       = aws_lambda_function.${projectName}.function_name\n    viewer_protocol_policy = \"redirect-to-https\"\n    # Managed-CachingDisabled\n    cache_policy_id = \"4135ea2d-6df8-44a3-9df3-4b5a84be39ad\"\n    # Managed-AllViewerExceptHostHeader\n    origin_request_policy_id = \"b689b0a8-53d0-40ab-baf2-68738e2966ac\"\n  }\n\n  restrictions {\n    geo_restriction {\n      restriction_type = \"none\"\n    }\n  }\n\n  viewer_certificate {${\n    domain\n      ? `\n    acm_certificate_arn      = aws_acm_certificate.${projectName}.arn\n    ssl_support_method       = \"sni-only\"\n    minimum_protocol_version = \"TLSv1.2_2021\"`\n      : `\n    cloudfront_default_certificate = true`\n  }\n  }\n}`\n    : ''\n}\n${\n  cloudwatchTriggerMinutes !== undefined\n    ? `# Cloudwatch trigger\n\nresource \"aws_lambda_permission\" \"cloudwatch_invoke_${projectName}\" {\n  statement_id  = \"AllowExecutionFromCloudWatch\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.${projectName}.arn\n  principal     = \"events.amazonaws.com\"\n  source_arn    = aws_cloudwatch_event_rule.${projectName}_trigger_rate.arn\n}\n\nresource \"aws_cloudwatch_event_rule\" \"${projectName}_trigger_rate\" {\n  name_prefix         = \"${projectName}.rate-${cloudwatchTriggerMinutes}-minutes.\"\n  schedule_expression = \"rate(${cloudwatchTriggerMinutes} minute${\n    cloudwatchTriggerMinutes > 1 ? 's' : ''\n  })\"\n}\n\nresource \"aws_cloudwatch_event_target\" \"${projectName}_trigger_target\" {\n  rule = aws_cloudwatch_event_rule.${projectName}_trigger_rate.name\n  arn  = aws_lambda_function.${projectName}.arn\n}\n`\n    : ''\n}\n# IAM role\n\nresource \"aws_iam_role\" \"${projectName}_role\" {\n  name = \"${workspaceName}-${projectName}-role\"\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [\n      {\n        Action = \"sts:AssumeRole\"\n        Principal = {\n          Service = \"lambda.amazonaws.com\"\n        }\n        Effect = \"Allow\"\n      },\n    ]\n  })\n  \n  inline_policy {\n    name   = \"${workspaceName}-${projectName}-extra-policy\"\n    policy = data.aws_iam_policy_document.${projectName}_extra_policy.json\n  }\n}\n\n# Cloudwatch logging\n\nresource \"aws_cloudwatch_log_group\" \"${projectName}\" {\n  name = \"/aws/lambda/${workspaceName}-${projectName}\"\n}\n\nresource \"aws_iam_policy\" \"${projectName}_cloudwatch\" {\n  name = \"${workspaceName}-${projectName}-cloudwatch-policy\"\n  policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [\n      {\n        Action = [\n          \"logs:CreateLogStream\",\n          \"logs:PutLogEvents\",\n        ]\n        Effect = \"Allow\"\n        Resource = [\n          \"\\${aws_cloudwatch_log_group.${projectName}.arn}\",\n          \"\\${aws_cloudwatch_log_group.${projectName}.arn}:*\",\n        ]\n      }\n    ]\n  })\n}\n\nresource \"aws_iam_role_policy_attachment\" \"${projectName}_cloudwatch\" {\n  role       = aws_iam_role.${projectName}_role.name\n  policy_arn = aws_iam_policy.${projectName}_cloudwatch.arn\n}\n${\n  alarmEmail !== undefined\n    ? `\n# Cloudwatch error monitoring\n\nresource \"aws_cloudwatch_log_metric_filter\" \"${projectName}_log_errors\" {\n  name           = \"${workspaceName}-${projectName}-log-error-metric-filter\"\n  pattern        = \"[ts, id, level = \\\\\"ERROR\\\\\", msg]\"\n  log_group_name = aws_cloudwatch_log_group.${projectName}.name\n\n  metric_transformation {\n    name          = \"${workspaceName}-${projectName}-errors\"\n    namespace     = \"${workspaceName}\"\n    value         = \"1\"\n    default_value = \"0\"\n    unit          = \"Count\"\n  }\n}\n\nresource \"aws_cloudwatch_metric_alarm\" \"${projectName}_log_errors\" {\n  alarm_name          = \"${workspaceName}-${projectName}-log-error-metric-alarm\"\n  metric_name         = aws_cloudwatch_log_metric_filter.${projectName}_log_errors.metric_transformation[0].name\n  namespace           = aws_cloudwatch_log_metric_filter.${projectName}_log_errors.metric_transformation[0].namespace\n  evaluation_periods  = 1\n  period              = 3600\n  statistic           = \"Sum\"\n  comparison_operator = \"GreaterThanOrEqualToThreshold\"\n  threshold           = 1\n  actions_enabled     = true\n  alarm_actions       = [aws_sns_topic.${projectName}_log_errors.arn]\n  ok_actions          = [aws_sns_topic.${projectName}_log_errors.arn]\n}\n\nresource \"aws_sns_topic\" \"${projectName}_log_errors\" {\n  name = \"${workspaceName}-${projectName}-log-error-sns-topic\"\n}\n\nresource \"aws_sns_topic_subscription\" \"${projectName}_log_errors\" {\n  endpoint  = \"${alarmEmail}\"\n  protocol  = \"email\"\n  topic_arn = aws_sns_topic.${projectName}_log_errors.arn\n}\n`\n    : ''\n}\n# Dummy source code useful only during the initial setup\nresource \"aws_s3_object\" \"${projectName}_archive\" {\n  bucket         = aws_s3_bucket.code.id\n  key            = \"${projectName}/dist.zip\"\n  content_base64 = \"UEsDBBQACAAIAGaKwlYAAAAAAAAAADYAAAAIACAAaW5kZXguanNVVA0AB3AIemRyCHpkcAh6ZHV4CwABBPUBAAAEFAAAAEutKMgvKinWy0jMS8lJLVKwVUgsrsxLVkgrzUsuyczPU9DQVKjmUlAoSi0pLcpTUFe35qq15gIAUEsHCP0ak1o4AAAANgAAAFBLAQIUAxQACAAIAGaKwlb9GpNaOAAAADYAAAAIACAAAAAAAAAAAACkgQAAAABpbmRleC5qc1VUDQAHcAh6ZHIIemRwCHpkdXgLAAEE9QEAAAQUAAAAUEsFBgAAAAABAAEAVgAAAI4AAAAAAA==\"\n}\n\n`.trim();\n}\n","import {WorkspaceName} from '@src/models';\n\nexport function generateAwsProviderTerraform(workspaceName: WorkspaceName): string {\n  return `\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.1\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region                   = \"eu-west-3\"\n  shared_credentials_files = [\"./.aws-credentials\"]\n  default_tags {\n    tags = {\n      Project = \"${workspaceName}\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  alias                    = \"us-east-1\"\n  region                   = \"us-east-1\"\n  shared_credentials_files = [\"./.aws-credentials\"]\n  default_tags {\n    tags = {\n      Project = \"homeassistant\"\n    }\n  }\n}\n\ndata \"aws_region\" \"current\" {}\noutput \"region\" {\n  value = data.aws_region.current.id\n}\n\ndata \"aws_caller_identity\" \"current\" {}\noutput \"account_id\" {\n  value = data.aws_caller_identity.current.account_id\n}\n`.trim();\n}\n","import {ProjectName, WorkspaceName} from '@src/models';\n\nexport function generateS3BucketTerraform(\n  workspaceName: WorkspaceName,\n  webProjectNames: ProjectName[]\n): string {\n  const bucketName = workspaceName.toLowerCase().replace(/[^a-z0-9.-]+/gu, '-');\n\n  const CODE_BUCKET = `\nresource \"aws_s3_bucket\" \"code\" {\n  bucket_prefix = \"${bucketName}-code-\"\n}\n\noutput \"code_bucket\" {\n  value = aws_s3_bucket.code.id\n}\n`.trim();\n\n  const CLOUDFRONT_ACCESS = `\ndata \"aws_iam_policy_document\" \"cloudfront_access_to_code_policy\" {\n  ${webProjectNames\n    .map(p =>\n      `\n  statement {\n    actions = [\"s3:GetObject\"]\n    resources = [\n      \"\\${aws_s3_bucket.code.arn}/${p}/*\",\n    ]\n    principals {\n      type        = \"AWS\"\n      identifiers = [aws_cloudfront_origin_access_identity.${p}.iam_arn]\n    }\n  }\n`.trim()\n    )\n    .join('\\n\\n')}\n}\n\nresource \"aws_s3_bucket_policy\" \"cloudfront_access_to_code\" {\n  bucket = aws_s3_bucket.code.id\n  policy = data.aws_iam_policy_document.cloudfront_access_to_code_policy.json\n}\n`.trim();\n\n  const out = [CODE_BUCKET];\n  if (webProjectNames.length > 0) {\n    out.push(CLOUDFRONT_ACCESS);\n  }\n  return out.join('\\n\\n');\n}\n","function notUndefined<T>(val: T | undefined): val is T {\n  return val !== undefined;\n}\n\nexport function isString(val: unknown): val is string {\n  return typeof val === 'string';\n}\n\nexport function isNumber(val: unknown): val is number {\n  return typeof val === 'number';\n}\n\nexport function iterNumberEnum<T extends Record<string, string | number>>(e: T): T[keyof T][] {\n  return Object.values(e).filter(isNumber) as unknown as T[keyof T][];\n}\n\nexport function iterStringEnum<T extends Record<string, string>>(e: T): T[keyof T][] {\n  return Object.values(e).filter(isString) as unknown as T[keyof T][];\n}\n\nexport function removeUndefined<T>(arr: (T | undefined)[]): T[] {\n  return arr.filter(notUndefined);\n}\n\nexport function removeUndefinedOrNullProps<T extends Record<string, unknown>>(obj: T): {} {\n  return Object.fromEntries(\n    Object.entries(obj).filter(e => e[1] !== undefined && e[1] !== null)\n  ) as T;\n}\n\nexport function neverHappens(value: never, errorMessage?: string): never {\n  throw new Error(errorMessage);\n}\n\nexport type AnyInterface<T> = {[K in keyof T]: unknown};\n\nexport function asMap(value: unknown): Record<string, unknown> | undefined;\nexport function asMap(\n  value: unknown,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asMap(\n  value: unknown,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  return typeof value === 'object' && value !== null\n    ? (value as Record<string, unknown>)\n    : defaultValue;\n}\nexport function asMapOrThrow(value: unknown): Record<string, unknown> {\n  const valueAsMap = asMap(value);\n  if (valueAsMap === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a map`);\n  }\n  return valueAsMap;\n}\n\nexport function asJson(value: string): Record<string, unknown> | undefined;\nexport function asJson(\n  value: string,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asJson(\n  value: string,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  try {\n    const json = JSON.parse(value);\n    const res = asMap(json);\n    return res ?? defaultValue;\n  } catch {\n    return defaultValue;\n  }\n}\nexport function asJsonOrThrow(value: string): Record<string, unknown> {\n  const valueAsJson = asJson(value);\n  if (valueAsJson === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a valid JSON string of a map`);\n  }\n  return valueAsJson;\n}\n\nexport function asJsonString(value: unknown): Record<string, unknown> | undefined;\nexport function asJsonString(\n  value: unknown,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asJsonString(\n  value: unknown,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  const str = asString(value);\n  return str === undefined\n    ? defaultValue\n    : defaultValue === undefined\n      ? asJson(str)\n      : asJson(str, defaultValue);\n}\nexport function asJsonStringOrThrow(value: unknown): Record<string, unknown> {\n  return asJsonOrThrow(asStringOrThrow(value));\n}\n\nexport function asString<T extends string = string>(value: unknown): T | undefined;\nexport function asString<T extends string = string>(value: unknown, defaultValue: string): T;\nexport function asString<T extends string = string>(\n  value: unknown,\n  defaultValue?: string\n): T | undefined {\n  return (typeof value === 'string' ? value : defaultValue) as T;\n}\nexport function asStringOrThrow<T extends string = string>(value: unknown): T {\n  const valueAsString = asString<T>(value);\n  if (valueAsString === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a string`);\n  }\n  return valueAsString;\n}\n\nexport function asStringEnum<T extends Record<string, string>>(\n  value: unknown,\n  enu: T\n): T[keyof T] | undefined;\nexport function asStringEnum<T extends Record<string, string>>(\n  value: unknown,\n  enu: T,\n  defaultValue: T[keyof T]\n): T[keyof T];\nexport function asStringEnum<T extends Record<string, string>>(\n  value: unknown,\n  enu: T,\n  defaultValue?: T[keyof T]\n): T[keyof T] | undefined {\n  return (\n    typeof value === 'string' && Object.values(enu).includes(value as T[keyof T])\n      ? value\n      : defaultValue\n  ) as T[keyof T];\n}\nexport function asStringEnumOrThrow<T extends Record<string, string>>(\n  value: unknown,\n  enu: T\n): T[keyof T] {\n  const valueAsString = asStringEnum<T>(value, enu);\n  if (valueAsString === undefined) {\n    throw new Error(\n      `Invalid value: \\`${value}\\` is not a string or not one of ${JSON.stringify(\n        Object.values(enu)\n      )}`\n    );\n  }\n  return valueAsString;\n}\n\nexport function asArray<T = unknown>(value: unknown): T[] | undefined;\nexport function asArray<T = unknown>(value: unknown, defaultValue: unknown[]): T[];\nexport function asArray<T = unknown>(value: unknown, defaultValue?: unknown[]): T[] | undefined {\n  return (Array.isArray(value) ? value : defaultValue) as T[];\n}\nexport function asArrayOrThrow<T = unknown>(value: unknown): T[] {\n  if (!Array.isArray(value)) {\n    throw new Error(`Invalid value: \\`${value}\\` is not an array`);\n  }\n  return value as T[];\n}\n\nexport function asStringArray<T extends string = string>(value: unknown): T[] | undefined;\nexport function asStringArray<T extends string = string>(\n  value: unknown,\n  defaultValue: string[]\n): T[];\nexport function asStringArray<T extends string = string>(\n  value: unknown,\n  defaultValue?: string[]\n): T[] | undefined {\n  const arr = asArray(value);\n  if (arr === undefined) {\n    return defaultValue as T[];\n  }\n  return removeUndefined(arr.map(s => asString<T>(s)));\n}\n\nexport function asStringArrayOrThrow<T extends string = string>(value: unknown): T[] {\n  const arr = asArrayOrThrow(value);\n  return arr.map(s => asStringOrThrow<T>(s));\n}\n\nexport function asMapArray(value: unknown): Record<string, unknown>[] | undefined;\nexport function asMapArray(\n  value: unknown,\n  defaultValue: Record<string, unknown>[]\n): Record<string, unknown>[];\nexport function asMapArray(\n  value: unknown,\n  defaultValue?: Record<string, unknown>[]\n): Record<string, unknown>[] | undefined {\n  const arr = asArray(value);\n  if (arr === undefined) {\n    return defaultValue;\n  }\n  return removeUndefined(arr.map(s => asMap(s)));\n}\nexport function asMapArrayOrThrow(value: unknown): Record<string, unknown>[] {\n  const arr = asArrayOrThrow(value);\n  return arr.map(s => asMapOrThrow(s));\n}\n\nexport function asNumber<T extends number = number>(value: unknown): T | undefined;\nexport function asNumber<T extends number = number>(value: unknown, defaultValue: number): T;\nexport function asNumber<T extends number = number>(\n  value: unknown,\n  defaultValue?: number\n): T | undefined {\n  if (typeof value === 'number') {\n    return (!isNaN(value) ? value : defaultValue) as T;\n  }\n  if (typeof value === 'string') {\n    try {\n      const parsedValue = parseFloat(value);\n      return (!isNaN(parsedValue) ? parsedValue : defaultValue) as T;\n    } catch {\n      return defaultValue as T;\n    }\n  }\n  return defaultValue as T;\n}\nexport function asNumberOrThrow<T extends number = number>(value: unknown): T {\n  const valueAsNumber = asNumber(value);\n  if (valueAsNumber === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a number`);\n  }\n  return valueAsNumber as T;\n}\n\nexport function asBoolean(value: unknown): boolean | undefined;\nexport function asBoolean(value: unknown, defaultValue: boolean): boolean;\nexport function asBoolean(value: unknown, defaultValue?: boolean): boolean | undefined {\n  if (typeof value === 'boolean') {\n    return value;\n  }\n  if (typeof value === 'number') {\n    return !isNaN(value) ? value !== 0 : false;\n  }\n  if (typeof value === 'string') {\n    if (value === '0' || value === 'false') {\n      return false;\n    } else if (value === '1' || value === 'true') {\n      return true;\n    }\n    return defaultValue;\n  }\n  return defaultValue;\n}\n\nexport function asBooleanOrThrow(value: unknown): boolean {\n  const valueAsBoolean = asBoolean(value);\n  if (valueAsBoolean === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a boolean`);\n  }\n  return valueAsBoolean;\n}\n\nconst TIMESTAMP_REGEX = /^[0-9]{1,15}$/u;\nexport function asDate(value: unknown): Date | undefined;\nexport function asDate(value: unknown, defaultValue: Date): Date;\nexport function asDate(value: unknown, defaultValue?: Date): Date | undefined {\n  const date =\n    value instanceof Date\n      ? value\n      : new Date(\n          typeof value === 'string' && TIMESTAMP_REGEX.test(value)\n            ? parseFloat(value)\n            : String(value)\n        );\n  return isNaN(date.getTime()) ? defaultValue : date;\n}\n\nexport function asDateOrThrow(value: unknown): Date {\n  const valueAsDate = asDate(value);\n  if (valueAsDate === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` cannot be parsed as a Date`);\n  }\n  return valueAsDate;\n}\n\n// export function asDate(value: unknown): Date | undefined;\n// export function asDate(value: unknown, defaultValue: Date): Date;\n// export function asDate(value: unknown, defaultValue?: Date): Date | undefined {\n//   if (typeof value === 'number') {\n//     return new Date(value);\n//   }\n//   return value instanceof Date ? value : defaultValue;\n// }\n\nexport function isNull<T>(val: T | null): val is null {\n  return val === null;\n}\n\nexport function asError(err: unknown): Error {\n  return err instanceof Error ? err : new Error(typeof err === 'string' ? err : String(err));\n}\n\nexport function errorAsString(err: unknown): string {\n  const errorMap = asMap(err);\n  if (errorMap === undefined) {\n    return asString(err) ?? String(err);\n  }\n\n  const errorMessage = asString(errorMap['message']);\n  if (errorMessage === undefined) {\n    return String(err);\n  }\n  return errorMessage;\n}\n\nexport function errorAndStackAsString(err: unknown): string {\n  const errorMap = asMap(err);\n  if (errorMap === undefined) {\n    return asString(err) ?? String(err);\n  }\n\n  const stack = asString(errorMap['stack']);\n  if (stack === undefined) {\n    return String(err);\n  }\n  return stack;\n}\n\nexport function asConstantOrThrow<T>(value: unknown, expected: T): T {\n  if (value !== expected) {\n    throw new Error(`Invalid value: \\`${value}\\`, expected \\`${expected}\\``);\n  }\n  return value as T;\n}\n\n// export function asParsedJson<T>(json: string): T {\n//   try {\n//     return JSON.parse(json) as T;\n//   } catch {\n//     const defaultValue = {};\n//     return defaultValue as T;\n//   }\n// }\nexport function parseJson(\n  json: string\n): {res: unknown; err: undefined} | {res: undefined; err: unknown} {\n  try {\n    return {res: JSON.parse(json), err: undefined};\n  } catch (err: unknown) {\n    return {err, res: undefined};\n  }\n}\nexport type Brand<Type, Name> = Type & {__brand: Name};\nexport type StringBrand = string & {__brand: string};\nexport type NumberBrand = number & {__brand: number};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type AnyBrand = (string | number) & {__brand: any};\n\nexport type Untrusted<T> = T extends\n  | Function\n  | Date\n  | boolean\n  | number\n  | string\n  | undefined\n  | null\n  | unknown[]\n  ? unknown\n  : {[P in keyof T]?: Untrusted<T[P]>};\n\nexport type DeepPartial<T> = T extends\n  | Function\n  | Date\n  | boolean\n  | number\n  | string\n  | undefined\n  | null\n  | unknown[]\n  ? T\n  : {[P in keyof T]?: DeepPartial<T[P]>};\n\nexport type MapInterface<I, Type> = {[Key in keyof I]: Type};\n// Get all the keys of a type including the optional attributes\ntype NonHomomorphicKeys<T> = ({[P in keyof T]: P} & None)[keyof T];\nexport type MapInterfaceStrict<I, Type> = {[Key in NonHomomorphicKeys<I>]: Type};\n\ntype KeysOfType<T, Type> = {[Key in keyof T]: T[Key] extends Type ? Key : never}[keyof T];\nexport type RestrictInterface<T, Type> = Pick<T, KeysOfType<T, Type>>;\n\ninterface RecursiveArray<T> extends Array<T | RecursiveArray<T>> {}\nexport type NestedArray<T> = (T | RecursiveArray<T>)[];\n\n// Type for an empty object (ie: {})\nexport type None = Record<string, never>;\n\nexport type NonEmptyArray<T> = [T, ...T[]];\nexport function isNonEmptyArray<T>(val: T[]): val is NonEmptyArray<T> {\n  return val.length > 0;\n}\nexport function nonEmptyArray<T>(val: T[]): NonEmptyArray<T> | undefined {\n  return val.length === 0 ? undefined : (val as NonEmptyArray<T>);\n}\n\nexport type AddPrefix<T, P extends string> = {\n  [K in keyof T as K extends string ? `${P}${K}` : never]: T[K];\n};\nexport function addPrefix<T extends Record<string, unknown>, Prefix extends string>(\n  attr: T,\n  prefix: Prefix\n): AddPrefix<T, Prefix> {\n  return Object.fromEntries(\n    Object.entries(attr).map(([key, value]) => [`${prefix}${key}`, value])\n  ) as AddPrefix<T, Prefix>;\n}\n\nexport type WithNull<T> = {\n  [Key in keyof T]: T[Key] extends Exclude<T[Key], undefined> ? T[Key] : T[Key] | null;\n};\ntype Id<T> = T;\nexport type Flatten<T> = Id<{[k in keyof T]: T[k]}>;\n\nexport type Defined<T> = Exclude<T, undefined>;\n","import {WorkspaceName} from '@src/models';\nimport {lowerCase, pascalCase} from '@src/string_utils';\n\nexport function generateDynamoUserTerraform(workspaceName: WorkspaceName): string {\n  const prefixLower = lowerCase(workspaceName);\n  const prefixPascal = pascalCase(workspaceName);\n  return `output \"${prefixLower}_user_table_name\" {\n    value       = aws_dynamodb_table.${prefixLower}_user_table.name\n  }\n  \n  output \"${prefixLower}_user_index_name\" {\n    value = {\n      for obj in aws_dynamodb_table.${prefixLower}_user_table.global_secondary_index : \"\\${aws_dynamodb_table.${prefixLower}_user_table.name }_By_\\${obj.hash_key}\\${ length(obj.range_key) > 0 ? \"_Sorted_By_\\${obj.range_key}\" : \"\" }\" => obj.name\n    }\n  }\n  \n  resource \"aws_dynamodb_table\" \"${prefixLower}_user_table\" {\n    name           = \"${prefixPascal}User\"\n    billing_mode   = \"PAY_PER_REQUEST\"\n    hash_key       = \"id\"\n  \n    attribute {\n      name = \"id\"\n      type = \"S\"\n    }\n  }`.trim();\n}\n","import {WorkspaceName} from '@src/models';\nimport {lowerCase, pascalCase} from '@src/string_utils';\n\nexport function generateDynamoUserSessionTerraform(workspaceName: WorkspaceName): string {\n  const prefixLower = lowerCase(workspaceName);\n  const prefixPascal = pascalCase(workspaceName);\n  return `output \"${prefixLower}_user_session_table_name\" {\n  value       = aws_dynamodb_table.${prefixLower}_user_session_table.name\n}\n\noutput \"${prefixLower}_user_session_index_name\" {\n  value = {\n    for obj in aws_dynamodb_table.${prefixLower}_user_session_table.global_secondary_index : \"\\${aws_dynamodb_table.${prefixLower}_user_session_table.name }_By_\\${obj.hash_key}\\${ length(obj.range_key) > 0 ? \"_Sorted_By_\\${obj.range_key}\" : \"\" }\" => obj.name\n  }\n}\n\nresource \"aws_dynamodb_table\" \"${prefixLower}_user_session_table\" {\n  name           = \"${prefixPascal}UserSession\"\n  billing_mode   = \"PAY_PER_REQUEST\"\n  hash_key       = \"token\"\n\n  attribute {\n    name = \"token\"\n    type = \"S\"\n  }\n\n  ttl {\n    attribute_name = \"expiresAt\"\n    enabled = true\n  }\n\n}`.trim();\n}\n","import {join} from 'node:path';\n\nimport {maybeReadFile, prettyJson, writeRawFile} from '@src/fs';\nimport {WorkspaceFragment} from '@src/models';\nimport {getProjectsFromWorkspaceFragment} from '@src/project/generate_workspace';\nimport {asMap} from '@src/type_utils';\n\nexport function generateCodeWorkspace(\n  workspaceName: string,\n  workspaceFragments: WorkspaceFragment[]\n): Record<string, unknown> {\n  const projects = workspaceFragments.flatMap(f =>\n    getProjectsFromWorkspaceFragment(f, workspaceFragments)\n  );\n  const projectNames = projects.map(p => p.projectName);\n  return {\n    folders: [\n      ...projectNames.map(p => ({path: p})),\n      {path: 'terraform'},\n      {path: '.', name: 'root'},\n    ],\n    settings: {\n      'window.title': `${workspaceName}\\${separator}\\${activeEditorShort}`,\n      'files.exclude': Object.fromEntries([\n        ...projectNames.map(p => [p, true]),\n        ['terraform', true],\n      ]),\n      'editor.acceptSuggestionOnCommitCharacter': false,\n      'editor.suggestSelection': 'first',\n      'vsintellicode.modify.editor.suggestSelection': 'automaticallyOverrodeDefaultValue',\n      'explorer.confirmDelete': false,\n      'git.autofetch': true,\n      'git.confirmSync': false,\n      'typescript.preferences.importModuleSpecifier': 'non-relative',\n      'eslint.lintTask.enable': true,\n      'eslint.useESLintClass': true,\n      'eslint.options': {\n        reportUnusedDisableDirectives: 'warn',\n      },\n      'editor.formatOnSave': true,\n      'editor.codeActionsOnSave': {\n        'source.fixAll': 'never',\n        'source.fixAll.eslint': 'explicit',\n      },\n      'editor.defaultFormatter': 'esbenp.prettier-vscode',\n      'editor.linkedEditing': true,\n      'emmet.showExpandedAbbreviation': 'never',\n      'files.associations': {\n        '*.tf': 'terraform',\n      },\n      '[typescript]': {\n        'editor.defaultFormatter': 'esbenp.prettier-vscode',\n      },\n      '[typescriptreact]': {\n        'editor.defaultFormatter': 'esbenp.prettier-vscode',\n      },\n      '[terraform]': {\n        'editor.defaultFormatter': 'hashicorp.terraform',\n      },\n    },\n    extensions: {\n      recommendations: [\n        'dbaeumer.vscode-eslint',\n        'esbenp.prettier-vscode',\n        'VisualStudioExptTeam.vscodeintellicode',\n        'styled-components.vscode-styled-components',\n        'naumovs.color-highlight',\n        'eamodio.gitlens',\n        'hashicorp.terraform',\n      ],\n    },\n  };\n}\n\nexport interface FileHash {\n  path: string;\n  hash: string;\n}\nexport interface Workspace {\n  fragments: WorkspaceFragment[];\n  version: string;\n  files: FileHash[];\n}\n\nexport async function readWorkspace(workspacePath: string): Promise<Workspace | undefined> {\n  const workspaceContent = await maybeReadFile(join(workspacePath, '.workspace'));\n  if (workspaceContent === undefined) {\n    return undefined;\n  }\n  const workspaceData = asMap(JSON.parse(workspaceContent), {});\n  const {fragments = [], version = '', files = []} = workspaceData;\n  return {fragments, version, files} as Workspace;\n}\n\nexport async function writeWorkspace(workspacePath: string, workspace: Workspace): Promise<void> {\n  workspace.files.sort((f1, f2) => f1.path.localeCompare(f2.path));\n  await writeRawFile(join(workspacePath, '.workspace'), await prettyJson(workspace));\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {mkdir} from 'node:fs/promises';\nimport {basename, join} from 'node:path';\n\nimport {prompt} from 'prompts';\n\nimport {rmDir} from '@src/fs';\nimport {error, log} from '@src/logger';\nimport {ProjectName, WorkspaceFragment, WorkspaceFragmentType, WorkspaceName} from '@src/models';\nimport {generateWorkspace, getProjectsFromWorkspaceFragment} from '@src/project/generate_workspace';\nimport {readWorkspace} from '@src/project/vscode_workspace';\nimport {neverHappens} from '@src/type_utils';\n\nasync function cancel(workspacePath?: string): Promise<never> {\n  log('Cancelling...');\n  if (workspacePath !== undefined) {\n    await rmDir(workspacePath);\n  }\n  // eslint-disable-next-line node/no-process-exit\n  process.exit(0);\n}\n\nconst BASE_FRAGMENTS = [\n  {type: WorkspaceFragmentType.Shared},\n  {type: WorkspaceFragmentType.SharedNode},\n  {type: WorkspaceFragmentType.SharedWeb},\n] as const;\n\nasync function initProject(): Promise<void> {\n  let workspaceName: string;\n  let workspacePath = process.cwd();\n  const frags: WorkspaceFragment[] = [];\n  const takenNames = ['terraform'];\n\n  // Check if we are already in a workspace\n  const workspace = await readWorkspace(workspacePath);\n  if (workspace !== undefined) {\n    for (const baseFrag of BASE_FRAGMENTS) {\n      if (!workspace.fragments.find(f => f.type === baseFrag.type)) {\n        frags.push(baseFrag);\n      }\n    }\n    workspaceName = basename(workspacePath);\n    for (const fragment of workspace.fragments) {\n      frags.push(fragment);\n      const projectNames = getProjectsFromWorkspaceFragment(fragment, workspace.fragments).map(\n        p => p.projectName\n      );\n      takenNames.push(...projectNames);\n    }\n  } else {\n    frags.push(...BASE_FRAGMENTS);\n    // Ask for workspace name\n    const {workspaceName: newWorkspaceName} = await prompt({\n      type: 'text',\n      name: 'workspaceName',\n      message: 'Workspace name',\n      validate: (v: string) => v.length > 0,\n    });\n    workspaceName = newWorkspaceName;\n\n    if (typeof workspaceName !== 'string') {\n      return cancel();\n    }\n\n    workspacePath = join(workspacePath, workspaceName);\n    await mkdir(workspacePath);\n  }\n\n  try {\n    while (true) {\n      let frag;\n      try {\n        frag = await askForWorkspaceFragment(takenNames);\n      } catch (err: unknown) {\n        error(String(err));\n        continue;\n      }\n      if (frag) {\n        frags.push(frag);\n        takenNames.push(...getProjectsFromWorkspaceFragment(frag, frags).map(p => p.projectName));\n      } else {\n        break;\n      }\n    }\n\n    const name = workspaceName as WorkspaceName;\n\n    await generateWorkspace(workspacePath, name, frags, workspace);\n  } catch (err: unknown) {\n    error(String(err));\n    await cancel(workspaceName);\n  }\n}\n\ntype SelectableWorkspaceFragmentType = Exclude<\n  WorkspaceFragmentType,\n  WorkspaceFragmentType.Shared | WorkspaceFragmentType.SharedNode | WorkspaceFragmentType.SharedWeb\n>;\n\nconst WorkspaceFragmentTypeToString: Record<SelectableWorkspaceFragmentType, string> = {\n  [WorkspaceFragmentType.WebApp]: 'Web App',\n  [WorkspaceFragmentType.StaticWebsite]: 'Static Website',\n  [WorkspaceFragmentType.StandaloneLambda]: 'Standalone Lambda',\n  [WorkspaceFragmentType.ApiLambda]: 'API Lambda',\n  [WorkspaceFragmentType.NodeScript]: 'Node Script',\n};\n\nasync function askForWorkspaceFragment(\n  takenNames: string[]\n): Promise<WorkspaceFragment | undefined> {\n  const DONE_GENERATING = 'done_generating';\n  const {workspaceFragmentType} = await prompt({\n    type: 'select',\n    name: 'workspaceFragmentType',\n    message: 'Choose a type of project to add to the workspace',\n    choices: [\n      ...Object.entries(WorkspaceFragmentTypeToString).map(([value, title]) => ({value, title})),\n      {title: `I'm done`, value: DONE_GENERATING},\n    ],\n  });\n  if (workspaceFragmentType === undefined || workspaceFragmentType === DONE_GENERATING) {\n    return undefined;\n  }\n  const type = workspaceFragmentType as SelectableWorkspaceFragmentType;\n\n  if (type === WorkspaceFragmentType.StaticWebsite) {\n    const websiteName = await askForProjectName('Website project name', 'website', takenNames);\n    return {type, websiteName};\n  } else if (type === WorkspaceFragmentType.StandaloneLambda) {\n    const lambdaName = await askForProjectName('Lambda project name', 'lambda', takenNames);\n    const alarmEmail = await askForAlarmEmail(true);\n    const cloudwatchTriggerMinutes = await askForCloudwatchTrigger();\n    return {type, lambdaName, alarmEmail, cloudwatchTriggerMinutes};\n  } else if (type === WorkspaceFragmentType.ApiLambda) {\n    const lambdaName = await askForProjectName('Lambda project name', 'lambda', takenNames);\n    const alarmEmail = await askForAlarmEmail(false);\n    const domain = await askForDomainName();\n    return {type, lambdaName, alarmEmail, domain};\n  } else if (type === WorkspaceFragmentType.WebApp) {\n    const websiteName = await askForProjectName('Frontend project name', 'frontend', takenNames);\n    const lambdaName = await askForProjectName('Backend project name', 'backend', takenNames);\n    const alarmEmail = await askForAlarmEmail(false);\n    const domain = await askForDomainName();\n    return {type, websiteName, lambdaName, alarmEmail, domain};\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  } else if (type === WorkspaceFragmentType.NodeScript) {\n    const scriptName = await askForProjectName('Script project name', 'script', takenNames);\n    return {type, scriptName};\n  }\n  neverHappens(type, `Unknown WorkspaceFragmentType \"${type}\"`);\n}\n\nconst VALID_PROJECT_NAME = /^[a-zA-Z0-9_]+$/u;\n\nasync function askForProjectName(\n  question: string,\n  defaultValue: string,\n  takenNames: string[]\n): Promise<ProjectName> {\n  let initial = defaultValue;\n  if (takenNames.includes(initial)) {\n    let index = 2;\n    while (takenNames.includes(initial)) {\n      initial = `${defaultValue}_${index}`;\n      index++;\n    }\n  }\n\n  const {value} = await prompt({\n    type: 'text',\n    name: 'value',\n    message: question,\n    initial,\n    validate: (v: string) => v.length > 0,\n  });\n  if (typeof value !== 'string') {\n    throw new Error(`${question} is required`);\n  }\n  if (!VALID_PROJECT_NAME.test(value)) {\n    throw new Error(`Invalid project name \"${value}\". Allowed characters are a-z, A-Z, 0-9 and _`);\n  }\n  if (takenNames.includes(value)) {\n    throw new Error(`${value} is taken`);\n  }\n  return value as ProjectName;\n}\n\nlet alarmEmailDefault: string | undefined;\n\nasync function askForAlarmEmail(defaultVal: boolean): Promise<string | undefined> {\n  const alarm = await prompt({\n    type: 'confirm',\n    name: 'value',\n    message: 'Add an alarm when an error is logged?',\n    initial: defaultVal,\n  });\n  if (alarm.value !== true) {\n    return undefined;\n  }\n  const email = await prompt({\n    type: 'text',\n    name: 'value',\n    message: 'Which email to send the alarm to?',\n    initial: alarmEmailDefault,\n    validate: (v: string) => v.length > 0,\n  });\n  if (typeof alarm.value !== 'string') {\n    return undefined;\n  }\n  return email.value;\n}\n\nasync function askForDomainName(): Promise<string | undefined> {\n  const useDomain = await prompt({\n    type: 'confirm',\n    name: 'value',\n    message: 'Use a custom domain?',\n  });\n  if (useDomain.value !== true) {\n    return undefined;\n  }\n  const domain = await prompt({\n    type: 'text',\n    name: 'value',\n    message: 'Enter the domain name.',\n    validate: (v: string) => v.length > 0,\n  });\n  if (typeof domain.value !== 'string') {\n    return undefined;\n  }\n  return domain.value;\n}\n\nasync function askForCloudwatchTrigger(): Promise<number | undefined> {\n  const trigger = await prompt({\n    type: 'confirm',\n    name: 'value',\n    message: 'Add a Cloudwatch trigger?',\n    initial: true,\n  });\n  if (trigger.value !== true) {\n    return undefined;\n  }\n  const minutes = await prompt({\n    type: 'text',\n    name: 'value',\n    message: 'Trigger period (in minutes)?',\n    initial: 1,\n    validate: (v: number) => v >= 1 && Math.round(v) === v,\n  });\n  if (typeof minutes.value !== 'number') {\n    return undefined;\n  }\n  return minutes.value;\n}\n\ninitProject().catch(error);\n"],"names":["exec","promises","readFileSync","dirname","join","format","access","readFile","readFileInternal","readdir","stat","writeFile","mkdir","rm","path","buffer","toString","prettierConfig","parser","printWidth","singleQuote","trailingComma","bracketSpacing","arrowParens","endOfLine","prettierFormat","str","writeRawFile","content","recursive","prettyJson","json","opts","compact","JSON","stringify","undefined","writeJsonFile","prettyJs","js","writeJsFile","prettyTs","ts","writeTsFile","writeRawFileIfNotExists","exists","rmDir","dirPath","force","cleanDir","cp","from","to","Promise","resolve","reject","err","maybeReadFile","fileContent","maybeReadFileSync","listFiles","files","ents","withFileTypes","ent","entPath","name","isDirectory","push","then","subFiles","isFile","all","log","error","console","ProjectType","EslintType","TsConfigType","WebpackType","PROJECT_TYPE_TO_METADATA","Web","eslint","tsconfig","webpack","LambdaFunction","Node","Lambda","LambdaApi","LambdaWebApi","NodeScript","Shared","Lib","SharedNode","SharedWeb","WorkspaceFragmentType","validateRegistry","execSync","relative","fileURLToPath","md5","generateProject","generateGitIgnore","generateWorkspacePackageJson","generateCommonTerraform","generateDummyTerraformCredentials","generateWorkspaceProjectTerraform","generateDynamoUserTerraform","generateDynamoUserSessionTerraform","generateCodeWorkspace","writeWorkspace","lowerCase","neverHappens","removeUndefined","PACKAGE_VERSIONS","TEMPLATES_PATH","import","meta","url","getProjectsFromWorkspaceFragment","fragment","allFragments","type","StaticWebsite","projectName","websiteName","fromFragment","vars","__PROJECT_NAME__","StandaloneLambda","lambdaName","ApiLambda","__BACKEND_NAME__","__BACKEND_NAME_UPPERCASE__","toUpperCase","WebApp","__FRONTEND_NAME__","__FRONTEND_NAME_UPPERCASE__","scriptName","otherVars","bestBackend","map","frag","prio","sort","a","b","generateWorkspace","dst","workspaceName","workspaceFragments","workspace","projects","flatMap","f","projectFiles","project","SCRIPTS_PATH","file","writeWorkspaceFile","workspaceFiles","vscodePath","vscodeFileList","vscodeFiles","relativePath","dstPath","tablePrefix","terraformFiles","p","flat","fragments","version","commands","stdio","process","cwd","root","_workspace$files$find","newHash","oldHash","find","hash","createHash","data","update","digest","hashPassword","password","salt","randomStringSafe","upperCase","written","defaultVars","__WORKSPACE_NAME__","__WORKSPACE_NAME_UPPERCASE__","__COOKIE_ENCRYPTION_KEY__","templatePath","newContent","varName","varValue","Object","entries","replaceAll","endsWith","packageJson","parse","randomBytes","ALPHANUM","length","set","result","characters","bytes","byte","Math","floor","UID_LENGTH","uidSafe","prefix","id","NONCE_BYTE_SIZE","generateNonce","capitalize","value","firstChar","slice","uncapitalize","toLowerCase","pascalCase","split","s","trim","TYPESCRIPT_VERSION","uniq","val","Set","values","eslintRuntimes","tsconfigRuntimes","webpackRuntimes","license","engines","node","scripts","setup","deploy","build","watch","eslintConfig","ignorePatterns","prettier","devDependencies","fromEntries","runtime","runner","d1","d2","localeCompare","lambdaServerRuntime","ESLINT_VERSION","PRETTIER_VERSION","LIB_VERSIONS","react","generateFrontendTerraform","generateLambdaTerraform","generateAwsProviderTerraform","generateS3BucketTerraform","filter","cloudwatchTriggerMinutes","alarmEmail","domainStr","domain","subDomain","rest","rootDomain","api","web","bucketName","replace","originId","prefixLower","webProjectNames","CODE_BUCKET","CLOUDFRONT_ACCESS","out","notUndefined","isString","isNumber","iterNumberEnum","e","iterStringEnum","arr","removeUndefinedOrNullProps","obj","errorMessage","Error","asMap","defaultValue","asMapOrThrow","valueAsMap","asJson","res","asJsonOrThrow","valueAsJson","asJsonString","asString","asJsonStringOrThrow","asStringOrThrow","valueAsString","asStringEnum","enu","includes","asStringEnumOrThrow","asArray","Array","isArray","asArrayOrThrow","asStringArray","asStringArrayOrThrow","asMapArray","asMapArrayOrThrow","asNumber","isNaN","parsedValue","parseFloat","asNumberOrThrow","valueAsNumber","asBoolean","asBooleanOrThrow","valueAsBoolean","TIMESTAMP_REGEX","asDate","date","Date","test","String","getTime","asDateOrThrow","valueAsDate","isNull","asError","errorAsString","errorMap","errorAndStackAsString","stack","asConstantOrThrow","expected","parseJson","isNonEmptyArray","nonEmptyArray","addPrefix","attr","key","prefixPascal","projectNames","folders","settings","reportUnusedDisableDirectives","extensions","recommendations","readWorkspace","workspacePath","workspaceContent","workspaceData","f1","f2","basename","prompt","cancel","exit","BASE_FRAGMENTS","initProject","frags","takenNames","baseFrag","newWorkspaceName","message","validate","v","askForWorkspaceFragment","WorkspaceFragmentTypeToString","DONE_GENERATING","workspaceFragmentType","choices","title","askForProjectName","askForAlarmEmail","askForCloudwatchTrigger","askForDomainName","VALID_PROJECT_NAME","question","initial","index","alarmEmailDefault","defaultVal","alarm","email","useDomain","trigger","minutes","round","catch"],"sourceRoot":""}