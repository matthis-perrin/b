import{createRequire as e}from"node:module";var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},s={};t.r(s),t.d(s,{config:()=>D});const n=e(import.meta.url)("node:fs"),r=e(import.meta.url)("node:path"),i=e(import.meta.url)("webpack");var o=t.n(i);const a=e(import.meta.url)("chokidar"),c=e(import.meta.url)("eslint"),l=new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:[a-zA-Z\\d]*(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|"),"gu"),u=console.error;console.log;function p(...e){for(const t of e)try{const e="string"==typeof t?t:t instanceof Error?t.stack??String(t):JSON.stringify(t);u(e),(0,n.appendFileSync)("error.log",e)}catch{}}let d=!1;const h=[];function m(){if(!d){d=!0;for(const e of h)Promise.resolve(e()).catch((e=>p("Failure to run exit cleanup callback",e)))}}process.on("beforeExit",(()=>m())),process.on("exit",(()=>m())),process.on("SIGTERM",(()=>m())),process.on("SIGINT",(()=>m())),process.on("uncaughtException",(e=>{p("uncaughtException",e),m()}));class f{context=process.cwd();apply(e){var t;this.context=e.context,e.hooks.beforeRun.tapPromise(this.name,(async()=>await this.setupHandler(e))),e.hooks.watchRun.tapPromise(this.name,(async()=>await this.setupHandler(e))),e.hooks.shutdown.tapPromise(this.name,(async()=>await this.exitHandlerAsync(e))),t=()=>this.exitHandler(e),h.push(t)}hasStarted=!1;async setupHandler(e){this.hasStarted||(this.hasStarted=!0,await this.setup(e))}hasExited=!1;exitHandler(e){this.hasExited||(this.hasExited=!0,Promise.resolve(this.teardown(e)).catch((e=>{p(`Error during teardown of plugin ${this.name}`,e)})))}async exitHandlerAsync(e){this.hasExited||(this.hasExited=!0,await this.teardown(e))}}class g extends i.WebpackError{name="EslintWebpackError";constructor(e,t,s,n,r){super(t),this.eslintRunId=e,this.ruleId=r,void 0!==s&&(this.file=s),n&&(this.loc=n)}}class y extends f{name="EslintPlugin";fileStates=new Map;shouldRun=!1;async setup(e){return await new Promise((t=>{this.runEslintInterval=setInterval((()=>this.runEslint()),500);const s=this.context,i=(0,r.join)(s,".."),o=(0,n.readdirSync)(i,{withFileTypes:!0}).filter((e=>e.isDirectory()&&(0,n.existsSync)((0,r.join)(i,e.name,"package.json")))).map((e=>(0,r.join)(i,e.name))),c=["src/**/*.ts","src/**/*.tsx"].flatMap((e=>o.map((t=>(0,r.join)(t,e)))));this.watcher=(0,a.watch)(c),this.watcher.on("add",(e=>{this.shouldRun=!0,e.startsWith(`${s}/`)&&this.fileStates.set(e,{status:"queued"})})).on("change",(e=>{this.shouldRun=!0,e.startsWith(`${s}/`)&&this.fileStates.set(e,{status:"queued"})})).on("unlink",(e=>{this.shouldRun=!0,e.startsWith(`${s}/`)&&this.fileStates.delete(e)})).on("ready",(()=>{this.runEslint(),t()})),e.hooks.compilation.tap(this.name,(e=>{this.compilation=e,this.syncErrorsAndWarnings()})),e.hooks.afterCompile.tapAsync(this.name,((e,t)=>{setTimeout((()=>{this.awaitIdle().finally(t)}),500)}))}))}runEslint(){if(!this.shouldRun)return;this.shouldRun=!1;const e=[...this.fileStates.entries()];if(0===e.length)return;const t=Math.random();for(const[s]of e)this.fileStates.set(s,{status:"in-progress",eslintRunId:t});const s=s=>{for(const[n]of e){const e=this.fileStates.get(n);e&&"in-progress"===e.status&&e.eslintRunId===t&&this.fileStates.set(n,{status:"errored",eslintRunId:t,err:s})}};try{const n=(0,r.join)(this.context,"tsconfig.json");new c.ESLint({cwd:this.context,overrideConfig:{settings:{"import/resolver":{typescript:{project:n}}},languageOptions:{parserOptions:{project:n}}}}).lintFiles(e.map((e=>e[0]))).then((e=>{for(const s of e){const e=this.fileStates.get(s.filePath);e&&"in-progress"===e.status&&e.eslintRunId===t&&(s.messages.length>0?this.fileStates.set(s.filePath,{status:"failed",eslintRunId:t,messages:s.messages}):this.fileStates.set(s.filePath,{status:"success",eslintRunId:t}))}})).catch(s).finally((()=>{this.syncErrorsAndWarnings(),this.checkIdle()}))}catch(e){s(e),this.syncErrorsAndWarnings(),this.checkIdle()}}syncErrorsAndWarnings(){if(!this.compilation)return;let e;for(const t of this.fileStates.values())"errored"===t.status&&(e=new g(t.eslintRunId,`Failure to run ESLint:\n${t.err instanceof Error?t.err.stack:String(t.err)}`));this.compilation.errors=[...this.compilation.errors.filter((e=>!("eslintRunId"in e))),...e?[e]:[]],this.compilation.warnings=[...this.compilation.warnings.filter((e=>!("eslintRunId"in e))),...[...this.fileStates.entries()].sort(((e,t)=>e[0].localeCompare(t[0]))).flatMap((([e,t])=>"failed"!==t.status?[]:t.messages.map((s=>new g(t.eslintRunId,s.message.replace(l,""),e,{start:{line:s.line,column:s.column},end:void 0===s.endLine?void 0:{line:s.endLine,column:s.endColumn}},s.ruleId??void 0)))))]}checkIdle(){if(this.resolveAwaitIdlePromise){for(const e of this.fileStates.values())if("queued"===e.status||"in-progress"===e.status)return;this.resolveAwaitIdlePromise()}}async awaitIdle(){return await new Promise((e=>{this.resolveAwaitIdlePromise=e,this.checkIdle()}))}async teardown(){clearInterval(this.runEslintInterval),await(this.watcher?.close())}}const b=e(import.meta.url)("fork-ts-checker-webpack-plugin");var w=t.n(b);function x(e){return new(w())({typescript:{diagnosticOptions:{syntactic:!0,semantic:!0,declaration:!1,global:!0},mode:"readonly",configFile:(0,r.join)(e,"tsconfig.json")},formatter:"basic",logger:{log:()=>{},error:()=>{}}})}const v=e(import.meta.url)("terser-webpack-plugin");var S=t.n(v);const j=e(import.meta.url)("node:child_process");class k{apply(e){e.hooks.beforeRun.tapAsync("YarnPlugin",((e,t)=>{const s=["yarn","install","--audit","--check-files","--non-interactive","--production=false"].join(" ");(0,j.exec)(s,{cwd:e.context},((s,i,o)=>{if(s)return u(`Yarn failed in ${e.context}`),void t(s);o.split("\n").filter((e=>e.trim().length>0)).length>0&&(0,n.appendFileSync)((0,r.join)(e.context,".yarn-warnings.log"),o),t()}))}))}}e(import.meta.url)("@babel/core"),e(import.meta.url)("@babel/preset-env"),e(import.meta.url)("@babel/preset-typescript"),e(import.meta.url)("babel-loader"),e(import.meta.url)("@babel/preset-react"),e(import.meta.url)("babel-plugin-styled-components");const E="3.37";e(import.meta.url)("source-map-loader");const I=e(import.meta.url)("favicons-webpack-plugin");var R=t.n(I);e(import.meta.url)("prettier");const{access:P,readFile:_,readdir:A,stat:O}=n.promises,{writeFile:$,mkdir:N,rm:F}=n.promises;function M(e,t){return"object"!=typeof e||null===e||Array.isArray(e)?t:e}function C(e,t){return"string"==typeof e?e:t}function W(e){const t=M(JSON.parse(function(e){try{return(0,n.readFileSync)(e).toString()}catch{return}}((0,r.join)(e,"src/favicon.json"))??"{}"),{});return{appName:C(t.appName,""),locale:C(t.locale,"en_US"),background:C(t.background,"#ffffff")}}function T(e,t){const{appName:s,locale:i,background:o}=W(e),a=function(e){const t=["svg","png","jpg","jpeg"];for(const s of t){const t=(0,r.join)(e,`src/favicon.${s}`);if((0,n.existsSync)(t))return t}}(e);if(void 0===a)return;const c={rotate:!1,offset:10,transparent:!1,background:o};return new(R())({logo:a,logoMaskable:a,cache:!0,inject:!0,mode:"webapp",favicons:{appName:s,appleStatusBarStyle:"default",start_url:"/",lang:i.replace("_","-"),path:`${t}/assets`,background:o,theme_color:o,icons:{appleIcon:c,appleStartup:c}}})}const z=e(import.meta.url)("html-webpack-plugin");var H=t.n(z);function L(e,t){return new(H())({template:(0,r.join)(e,"src/index.html"),publicPath:t,minify:!0})}function q(e){const{context:t,watch:s}=e,i=function(e){const{context:t}=e;return{mode:"none",context:t,entry:{},devtool:"source-map",plugins:[new k,x(t),new y,new(o().DefinePlugin)({"process.env.NODE_ENV":'"production"'})],stats:!1,infrastructureLogging:{level:"error"},optimization:{minimize:!0,minimizer:[new(S())({terserOptions:{format:{comments:!1}},extractComments:!1})],concatenateModules:!0,sideEffects:!0},experiments:{backCompat:!0}}}({context:t,watch:s}),a=(0,r.join)(t,"../shared/src/env.ts"),c=`${(0,r.basename)(t).toUpperCase()}_CLOUDFRONT_DOMAIN_NAME`,l=new RegExp(`export const ${c} =\\s*'(?<domainName>[^']*)'`,"u").exec((0,n.readFileSync)(a).toString()),u=`https://${l?.[1]??"domain-not-found"}`;return{...i,target:"web",entry:{main:(0,r.join)(t,"src/index.tsx")},output:{path:(0,r.join)(t,"dist"),filename:"[name].[contenthash].js",clean:!0,publicPath:"/"},module:{rules:[{test:/\.tsx?$/u,exclude:/\/node_modules\//u,loader:"babel-loader",options:{presets:[["@babel/preset-env",{targets:"> 10%",bugfixes:!0,useBuiltIns:"usage",corejs:{version:E}}],["@babel/preset-react",{runtime:"automatic"}],["@babel/preset-typescript"]],plugins:[["babel-plugin-styled-components",{pure:!0}]]}},{test:/\.js$/u,use:["source-map-loader"],enforce:"pre"},{test:/\.(?:png|jpg|jpeg)$/iu,type:"asset/resource"}]},resolve:{extensions:[".js",".jsx",".ts",".tsx"],modules:["node_modules","../shared-web/node_modules","../shared/node_modules"],alias:{"@src":(0,r.join)(t,"src"),"@shared":(0,r.join)(t,"../shared/src"),"@shared-web":(0,r.join)(t,"../shared-web/src")}},plugins:[...i.plugins??[],L(t,u),T(t,u)],optimization:{...i.optimization,splitChunks:{cacheGroups:{vendor:{test:/[/\\]node_modules[/\\]/u,chunks:"initial",name:"vendor",enforce:!0}}}}}}function D(e){return q(e)}var B=s.config;export{B as config};
//# sourceMappingURL=index.js.map