{"version":3,"file":"index.js","mappings":";;;;;;AAAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;ACAA;;;;;;;;;;;ACA8C;AAE9C,IAAIC,MAAM,GAAG,KAAK;AAClB,MAAMC,SAAyC,GAAG,EAAE;AAEpD,SAASC,YAAYA,CAAA,EAAS;EAC5B,IAAIF,MAAM,EAAE;IACV;EACF;EACAA,MAAM,GAAG,IAAI;EACb,KAAK,MAAMG,EAAE,IAAIF,SAAS,EAAE;IAC1BG,OAAO,CAACC,OAAO,CAACF,EAAE,CAAC,CAAC,CAAC,CAACG,KAAK,CAACC,GAAG,IAAIR,8DAAW,CAAC,sCAAsC,EAAEQ,GAAG,CAAC,CAAC;EAC9F;AACF;AAEAC,OAAO,CAACC,EAAE,CAAC,YAAY,EAAE,MAAMP,YAAY,CAAC,CAAC,CAAC;AAC9CM,OAAO,CAACC,EAAE,CAAC,MAAM,EAAE,MAAMP,YAAY,CAAC,CAAC,CAAC;AACxCM,OAAO,CAACC,EAAE,CAAC,SAAS,EAAE,MAAMP,YAAY,CAAC,CAAC,CAAC;AAC3CM,OAAO,CAACC,EAAE,CAAC,QAAQ,EAAE,MAAMP,YAAY,CAAC,CAAC,CAAC;AAC1CM,OAAO,CAACC,EAAE,CAAC,mBAAmB,EAAEF,GAAG,IAAI;EACrCR,8DAAW,CAAC,mBAAmB,EAAEQ,GAAG,CAAC;EACrCL,YAAY,CAAC,CAAC;AAChB,CAAC,CAAC;AAEK,SAASQ,oBAAoBA,CAACC,EAA8B,EAAQ;EACzEV,SAAS,CAACW,IAAI,CAACD,EAAE,CAAC;AACpB;;;;;;;;;;;;;AC1BuC;AAEL;AAE3B,SAASZ,WAAWA,CAAC,GAAGgB,GAAc,EAAQ;EACnD,KAAK,MAAMC,IAAI,IAAID,GAAG,EAAE;IACtB,IAAI;MACF,MAAME,GAAG,GACP,OAAOD,IAAI,KAAK,QAAQ,GACpBA,IAAI,GACJA,IAAI,YAAYE,KAAK,GACnBF,IAAI,CAACG,KAAK,IAAIC,MAAM,CAACJ,IAAI,CAAC,GAC1BK,IAAI,CAACC,SAAS,CAACN,IAAI,CAAC;MAC5BF,kDAAK,CAACG,GAAG,CAAC;MACVJ,uDAAc,CAAC,WAAW,EAAEI,GAAG,CAAC;IAClC,CAAC,CAAC,MAAM;MACNH,kDAAK,CAACM,MAAM,CAACL,GAAG,CAAC,CAAC;MAClBF,uDAAc,CAAC,WAAW,EAAEO,MAAM,CAACL,GAAG,CAAC,CAAC;IAC1C;EACF;AACF;;;;;;ACpBA;;;;;;;;;;;ACAO,MAAM;EAACQ,GAAG;EAAET;AAAK,CAAC,GAAGU,OAAO;;;;;;;;;;;;;;;ACKnC;AACA;AACA;;AAEO,IAAKC,WAAW,0BAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAA,OAAXA,WAAW;AAAA;AAWhB,IAAKC,UAAU,0BAAVA,UAAU;EAAVA,UAAU;EAAVA,UAAU;EAAVA,UAAU;EAAA,OAAVA,UAAU;AAAA;AAMf,IAAKC,YAAY,0BAAZA,YAAY;EAAZA,YAAY;EAAZA,YAAY;EAAZA,YAAY;EAAA,OAAZA,YAAY;AAAA;AAKjB,IAAKC,WAAW,0BAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAXA,WAAW;EAAA,OAAXA,WAAW;AAAA;AAahB,MAAMC,wBAAwB,GAAG;EACtC,CAACJ,WAAW,CAACK,GAAG,GAAG;IACjBC,MAAM,EAAEL,UAAU,CAACI,GAAG;IACtBE,QAAQ,EAAEL,YAAY,CAACG,GAAG;IAC1BG,OAAO,EAAEL,WAAW,CAACE;EACvB,CAAC;EACD,CAACL,WAAW,CAACS,cAAc,GAAG;IAC5BH,MAAM,EAAEL,UAAU,CAACS,IAAI;IACvBH,QAAQ,EAAEL,YAAY,CAACQ,IAAI;IAC3BF,OAAO,EAAEL,WAAW,CAACQ;EACvB,CAAC;EACD,CAACX,WAAW,CAACY,SAAS,GAAG;IACvBN,MAAM,EAAEL,UAAU,CAACS,IAAI;IACvBH,QAAQ,EAAEL,YAAY,CAACQ,IAAI;IAC3BF,OAAO,EAAEL,WAAW,CAACQ;EACvB,CAAC;EACD,CAACX,WAAW,CAACa,YAAY,GAAG;IAC1BP,MAAM,EAAEL,UAAU,CAACS,IAAI;IACvBH,QAAQ,EAAEL,YAAY,CAACQ,IAAI;IAC3BF,OAAO,EAAEL,WAAW,CAACQ;EACvB,CAAC;EACD,CAACX,WAAW,CAACc,UAAU,GAAG;IACxBR,MAAM,EAAEL,UAAU,CAACS,IAAI;IACvBH,QAAQ,EAAEL,YAAY,CAACQ,IAAI;IAC3BF,OAAO,EAAEL,WAAW,CAACW;EACvB,CAAC;EACD,CAACd,WAAW,CAACe,MAAM,GAAG;IACpBT,MAAM,EAAEL,UAAU,CAACe,GAAG;IACtBT,QAAQ,EAAEL,YAAY,CAACc,GAAG;IAC1BR,OAAO,EAAEL,WAAW,CAACa;EACvB,CAAC;EACD,CAAChB,WAAW,CAACiB,UAAU,GAAG;IACxBX,MAAM,EAAEL,UAAU,CAACS,IAAI;IACvBH,QAAQ,EAAEL,YAAY,CAACQ,IAAI;IAC3BF,OAAO,EAAEL,WAAW,CAACa;EACvB,CAAC;EACD,CAAChB,WAAW,CAACkB,SAAS,GAAG;IACvBZ,MAAM,EAAEL,UAAU,CAACI,GAAG;IACtBE,QAAQ,EAAEL,YAAY,CAACG,GAAG;IAC1BG,OAAO,EAAEL,WAAW,CAACa;EACvB;AACF,CAAoD;;AAEpD;AACA;AACA;;AAEO,IAAKG,qBAAqB,0BAArBA,qBAAqB;EAArBA,qBAAqB;EAArBA,qBAAqB;EAArBA,qBAAqB;EAArBA,qBAAqB;EAArBA,qBAAqB;EAArBA,qBAAqB;EAArBA,qBAAqB;EAArBA,qBAAqB;EAAA,OAArBA,qBAAqB;AAAA;AA0DjC;AACA,SAASC,gBAAgBA,CAAA,EAAoB;EAC3C,OAAO,IAAI;AACb;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxJ4C;AACH;AACF;AAEyC;AAClD;AACE;AAOX;AACyC;AACL;AACc;AAKnC;AAC2C;AACe;AAMvD;AACK;AACkB;AACf;AAE/C,MAAMyB,cAAc,GAAGvB,+CAAI,CAACE,uDAAa,CAACsB,MAAM,CAACC,IAAI,CAACC,GAAG,CAAC,EAAE,cAAc,CAAC;AASpE,SAASC,gCAAgCA,CAC9CC,QAA2B,EAC3BC,YAAiC,EACb;EACpB,IAAID,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAACkC,aAAa,EAAE;IACzD,OAAO,CACL;MACEC,WAAW,EAAEJ,QAAQ,CAACK,WAAW;MACjCH,IAAI,EAAEpD,oDAAW,CAACK,GAAG;MACrBmD,YAAY,EAAEN,QAAQ;MACtBO,IAAI,EAAE;QACJC,gBAAgB,EAAER,QAAQ,CAACK;MAC7B;IACF,CAAC,CACF;EACH,CAAC,MAAM,IAAIL,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAACwC,gBAAgB,EAAE;IACnE,OAAO,CACL;MACEL,WAAW,EAAEJ,QAAQ,CAACU,UAAU;MAChCR,IAAI,EAAEpD,oDAAW,CAACS,cAAc;MAChC+C,YAAY,EAAEN,QAAQ;MACtBO,IAAI,EAAE;QACJC,gBAAgB,EAAER,QAAQ,CAACU;MAC7B;IACF,CAAC,CACF;EACH,CAAC,MAAM,IAAIV,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAAC0C,SAAS,EAAE;IAC5D,OAAO,CACL;MACEP,WAAW,EAAEJ,QAAQ,CAACU,UAAU;MAChCR,IAAI,EAAEpD,oDAAW,CAACY,SAAS;MAC3B4C,YAAY,EAAEN,QAAQ;MACtBO,IAAI,EAAE;QACJC,gBAAgB,EAAER,QAAQ,CAACU,UAAU;QACrCE,gBAAgB,EAAEZ,QAAQ,CAACU,UAAU;QACrCG,0BAA0B,EAAEb,QAAQ,CAACU,UAAU,CAACI,WAAW,CAAC;MAC9D;IACF,CAAC,CACF;EACH,CAAC,MAAM,IAAId,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAAC8C,MAAM,EAAE;IACzD,MAAMR,IAAI,GAAG;MACXC,gBAAgB,EAAER,QAAQ,CAACU,UAAU;MACrCE,gBAAgB,EAAEZ,QAAQ,CAACU,UAAU;MACrCG,0BAA0B,EAAEb,QAAQ,CAACU,UAAU,CAACI,WAAW,CAAC,CAAC;MAC7DE,iBAAiB,EAAEhB,QAAQ,CAACK,WAAW;MACvCY,2BAA2B,EAAEjB,QAAQ,CAACK,WAAW,CAACS,WAAW,CAAC;IAChE,CAAC;IACD,OAAO,CACL;MACEV,WAAW,EAAEJ,QAAQ,CAACK,WAAW;MACjCH,IAAI,EAAEpD,oDAAW,CAACK,GAAG;MACrBmD,YAAY,EAAEN,QAAQ;MACtBO;IACF,CAAC,EACD;MACEH,WAAW,EAAEJ,QAAQ,CAACU,UAAU;MAChCR,IAAI,EAAEpD,oDAAW,CAACa,YAAY;MAC9B2C,YAAY,EAAEN,QAAQ;MACtBO;IACF,CAAC,CACF;EACH,CAAC,MAAM,IAAIP,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAACL,UAAU,EAAE;IAC7D,OAAO,CACL;MACEwC,WAAW,EAAEJ,QAAQ,CAACkB,UAAU;MAChChB,IAAI,EAAEpD,oDAAW,CAACc,UAAU;MAC5B0C,YAAY,EAAEN,QAAQ;MACtBO,IAAI,EAAE;QACJC,gBAAgB,EAAER,QAAQ,CAACkB;MAC7B;IACF,CAAC,CACF;EACH,CAAC,MAAM,IAAIlB,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAACF,UAAU,EAAE;IAC7D,MAAMqC,WAAW,GAAG,aAA4B;IAChD,OAAO,CACL;MACEA,WAAW;MACXF,IAAI,EAAEpD,oDAAW,CAACiB,UAAU;MAC5BuC,YAAY,EAAEN,QAAQ;MACtBO,IAAI,EAAE;QACJC,gBAAgB,EAAEJ;MACpB;IACF,CAAC,CACF;EACH,CAAC,MAAM,IAAIJ,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAACD,SAAS,EAAE;IAC5D,MAAMoC,WAAW,GAAG,YAA2B;IAC/C,OAAO,CACL;MACEA,WAAW;MACXF,IAAI,EAAEpD,oDAAW,CAACkB,SAAS;MAC3BsC,YAAY,EAAEN,QAAQ;MACtBO,IAAI,EAAE;QACJC,gBAAgB,EAAEJ;MACpB;IACF,CAAC,CACF;IACD;EACF,CAAC,MAAM,IAAIJ,QAAQ,CAACE,IAAI,KAAKjC,8DAAqB,CAACJ,MAAM,EAAE;IACzD,MAAMuC,WAAW,GAAG,QAAuB;IAC3C,MAAMe,SAAiC,GAAG,CAAC,CAAC;IAC5C,MAAM,CAACC,WAAW,CAAC,GAAG3B,iEAAe,CACnCQ,YAAY,CAACoB,GAAG,CAACC,IAAI,IAAI;MACvB,IAAIA,IAAI,CAACpB,IAAI,KAAKjC,8DAAqB,CAAC8C,MAAM,EAAE;QAC9C,OAAO;UAACQ,IAAI,EAAED,IAAI,CAACZ,UAAU;UAAEc,IAAI,EAAE;QAAC,CAAC;MACzC,CAAC,MAAM,IAAIF,IAAI,CAACpB,IAAI,KAAKjC,8DAAqB,CAAC0C,SAAS,EAAE;QACxD,OAAO;UAACY,IAAI,EAAED,IAAI,CAACZ,UAAU;UAAEc,IAAI,EAAE;QAAC,CAAC;MACzC;MACA,OAAOC,SAAS;IAClB,CAAC,CACH,CAAC,CAACC,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKD,CAAC,CAACH,IAAI,GAAGI,CAAC,CAACJ,IAAI,CAAC;IACjC,IAAIJ,WAAW,EAAE;MACfD,SAAS,CAAC,kBAAkB,CAAC,GAAGC,WAAW,CAACG,IAAI;MAChDJ,SAAS,CAAC,4BAA4B,CAAC,GAAGC,WAAW,CAACG,IAAI,CAACT,WAAW,CAAC,CAAC;IAC1E;IACA,OAAO,CACL;MACEV,WAAW;MACXF,IAAI,EAAEpD,oDAAW,CAACe,MAAM;MACxByC,YAAY,EAAEN,QAAQ;MACtBO,IAAI,EAAE;QACJC,gBAAgB,EAAEJ,WAAW;QAC7B,GAAGe;MACL;IACF,CAAC,CACF;EACH;EACA3B,8DAAY,CAACQ,QAAQ,EAAG,uBAAuBA,QAAQ,CAAuBE,IAAK,EAAC,CAAC;AACvF;AAEO,eAAe2B,iBAAiBA,CACrCC,GAAW,EACXC,aAA4B,EAC5BC,kBAAuC,EACvCC,SAAgC,EACjB;EACf,MAAMC,QAAQ,GAAGF,kBAAkB,CAACG,OAAO,CAACC,CAAC,IAC3CrC,gCAAgC,CAACqC,CAAC,EAAEJ,kBAAkB,CACxD,CAAC;;EAED;EACA,MAAMK,YAAY,GAAG,MAAM5G,OAAO,CAAC6G,GAAG,CACpCJ,QAAQ,CAACb,GAAG,CAAC,MAAMkB,OAAO,IAAI1D,8EAAe,CAACiD,GAAG,EAAES,OAAO,EAAEN,SAAS,EAAEF,aAAa,CAAC,CACvF,CAAC;;EAED;EACA,MAAMS,YAAY,GAAGpE,+CAAI,CAACE,uDAAa,CAACsB,MAAM,CAACC,IAAI,CAACC,GAAG,CAAC,EAAE,YAAY,CAAC;EACvE,MAAM2C,SAAS,GAAG,MAAAA,CAAOC,IAAY,EAAEC,IAAY,KACjDC,kBAAkB,CAACX,SAAS,EAAEH,GAAG,EAAEY,IAAI,EAAEC,IAAI,CAAC;EAChD,MAAME,cAAc,GAAG,MAAMpH,OAAO,CAAC6G,GAAG,CAAC;EACvC;EACAG,SAAS,CACP,cAAc,EACd,MAAMhE,mDAAU,CAACM,uFAA4B,CAACgD,aAAa,EAAEG,QAAQ,CAAC,CACxE,CAAC;EACD;EACAO,SAAS,CACP,oBAAoB,EACpB,MAAMhE,mDAAU,CAACY,qFAAqB,CAAC0C,aAAa,EAAEC,kBAAkB,CAAC,CAC3E,CAAC;EACD;EACAS,SAAS,CAAC,YAAY,EAAE3D,yEAAiB,CAAC,CAAC,CAAC;EAC5C;EACA2D,SAAS,CAAC,UAAU,EAAE,MAAMjE,iDAAQ,CAAC,MAAME,iDAAQ,CAACN,+CAAI,CAACoE,YAAY,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC;EACrF;EACAC,SAAS,CAAC,WAAW,EAAE,MAAMjE,iDAAQ,CAAC,MAAME,iDAAQ,CAACN,+CAAI,CAACoE,YAAY,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC;EACvF;EACAC,SAAS,CAAC,UAAU,EAAE,MAAMjE,iDAAQ,CAAC,MAAME,iDAAQ,CAACN,+CAAI,CAACoE,YAAY,EAAE,UAAU,CAAC,CAAC,CAAC,CAAC,CACtF,CAAC;;EAEF;EACA,MAAMM,UAAU,GAAG1E,+CAAI,CAACuB,cAAc,EAAE,SAAS,CAAC;EAClD,MAAMoD,cAAc,GAAG,MAAMxE,kDAAS,CAACuE,UAAU,CAAC;EAClD,MAAME,WAAW,GAAG,MAAMvH,OAAO,CAAC6G,GAAG,CACnCS,cAAc,CAAC1B,GAAG,CAAC,MAAMsB,IAAI,IAAI;IAC/B,MAAMM,YAAY,GAAG5E,mDAAQ,CAACyE,UAAU,EAAEH,IAAI,CAAC;IAC/C,MAAMO,OAAO,GAAG9E,+CAAI,CAAC,SAAS,EAAE6E,YAAY,CAAC;IAC7C,MAAME,OAAO,GAAG,MAAMzE,iDAAQ,CAACiE,IAAI,CAAC;IACpC,OAAOF,SAAS,CAACS,OAAO,EAAEC,OAAO,CAAC;EACpC,CAAC,CACH,CAAC;;EAED;EACA,MAAMC,WAAW,GAAG7D,6DAAS,CAACwC,aAAa,CAAC;EAC5C,MAAMsB,cAAc,GAAG,MAAM5H,OAAO,CAAC6G,GAAG,CAAC,CACvCG,SAAS,CAACrE,+CAAI,CAAC,WAAW,EAAE,kBAAkB,CAAC,EAAEa,8FAAiC,CAAC,CAAC,CAAC,EACrFwD,SAAS,CACPrE,+CAAI,CAAC,WAAW,EAAG,gBAAegF,WAAY,UAAS,CAAC,EACxDjE,gGAA2B,CAAC4C,aAAa,CAC3C,CAAC,EACDU,SAAS,CACPrE,+CAAI,CAAC,WAAW,EAAG,gBAAegF,WAAY,kBAAiB,CAAC,EAChEhE,+GAAkC,CAAC2C,aAAa,CAClD,CAAC,EACDU,SAAS,CAACrE,+CAAI,CAAC,WAAW,EAAE,SAAS,CAAC,EAAEY,oFAAuB,CAAC+C,aAAa,EAAEG,QAAQ,CAAC,CAAC,EACzF,GAAGA,QAAQ,CAACb,GAAG,CAAC,MAAMiC,CAAC,IAAI;IACzB,MAAMH,OAAO,GAAGjE,8FAAiC,CAAC6C,aAAa,EAAEuB,CAAC,CAAC;IACnE,IAAIH,OAAO,KAAK1B,SAAS,EAAE;MACzB;IACF;IACA,MAAMF,IAAI,GAAI,GAAE+B,CAAC,CAAClD,WAAY,YAAW;IACzC,OAAOqC,SAAS,CAACrE,+CAAI,CAAC,WAAW,EAAG,GAAEmD,IAAK,KAAI,CAAC,EAAE4B,OAAO,CAAC;EAC5D,CAAC,CAAC,CACH,CAAC;EAEF,MAAM7D,8EAAc,CAACwC,GAAG,EAAE;IACxByB,KAAK,EAAE9D,iEAAe,CAAC,CACrB,GAAG4C,YAAY,CAACmB,IAAI,CAAC,CAAC,EACtB,GAAGX,cAAc,EACjB,GAAGQ,cAAc,EACjB,GAAGL,WAAW,CACf,CAAC;IACFS,SAAS,EAAEzB,kBAAkB;IAC7B0B,OAAO,EAAEhE,4DAAgB,CAAC6C;EAC5B,CAAC,CAAC;;EAEF;EACA3F,gDAAG,CAAC,6BAA6B,CAAC;EAClC,MAAM+G,QAAQ,GAAG,CAAE,MAAK7B,GAAI,EAAC,EAAG,eAAc,EAAG,UAAS,CAAC;EAC3D3D,4DAAQ,CAACwF,QAAQ,CAACvF,IAAI,CAAC,MAAM,CAAC,EAAE;IAACwF,KAAK,EAAE,CAAC,QAAQ,EAAE,SAAS,EAAE,SAAS;EAAC,CAAC,CAAC;;EAE1E;EACAhH,gDAAG,CAAE,mCAAkC,CAAC;EACxCA,gDAAG,CAAE,MAAKyB,mDAAQ,CAACxC,OAAO,CAACgI,GAAG,CAAC,CAAC,EAAE/B,GAAG,CAAE,uCAAsC,CAAC;AAChF;AAEO,eAAec,kBAAkBA,CACtCX,SAAgC,EAChC6B,IAAY,EACZpB,IAAY,EACZC,IAAY,EACO;EAAA,IAAAoB,qBAAA;EACnB,MAAMC,OAAO,GAAGpF,8CAAG,CAAC+D,IAAI,CAAC;EACzB,MAAMsB,OAAO,GAAGhC,SAAS,aAATA,SAAS,gBAAA8B,qBAAA,GAAT9B,SAAS,CAAEsB,KAAK,CAACW,IAAI,CAAC9B,CAAC,IAAIA,CAAC,CAACM,IAAI,KAAKA,IAAI,CAAC,cAAAqB,qBAAA,uBAA3CA,qBAAA,CAA6CI,IAAI;EACjE;EACA;EACA,IAAIH,OAAO,KAAKC,OAAO,EAAE;IACvB,MAAMtF,qDAAY,CAACP,+CAAI,CAAC0F,IAAI,EAAEpB,IAAI,CAAC,EAAEC,IAAI,CAAC;EAC5C;EACA,OAAO;IAACD,IAAI;IAAEyB,IAAI,EAAEH;EAAO,CAAC;AAC9B;;;;;;AC1RA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAwC;AACO;AACP;AAEW;AAE5C,MAAM;EAACS,MAAM;EAAE/F,QAAQ,EAAEgG,gBAAgB;EAAEC,OAAO;EAAEC;AAAI,CAAC,GAAGP,6CAAQ;AAC3E,MAAM;EAAC5B,SAAS;EAAEoC,KAAK;EAAEC;AAAE,CAAC,GAAGT,6CAAQ;AAEhC,eAAe3F,QAAQA,CAACgE,IAAY,EAAmB;EAC5D,MAAMqC,MAAM,GAAG,MAAML,gBAAgB,CAAChC,IAAI,CAAC;EAC3C,OAAOqC,MAAM,CAACC,QAAQ,CAAC,CAAC;AAC1B;AAEA,MAAMC,cAAc,GAAIC,MAAyB,KAC9C;EACCA,MAAM;EACNC,UAAU,EAAE,GAAG;EACfC,WAAW,EAAE,IAAI;EACjBC,aAAa,EAAE,KAAK;EACpBC,cAAc,EAAE,KAAK;EACrBC,WAAW,EAAE,OAAO;EACpBC,SAAS,EAAE;AACb,CAAC,CAAU;AAEN,eAAeC,cAAcA,CAACnJ,GAAW,EAAE4I,MAAyB,EAAmB;EAC5F,OAAOV,gDAAM,CAAClI,GAAG,EAAE2I,cAAc,CAACC,MAAM,CAAC,CAAC;AAC5C;AAEO,eAAevG,YAAYA,CAAC+D,IAAY,EAAES,OAAe,EAAiB;EAC/E,MAAM0B,KAAK,CAACN,kDAAO,CAAC7B,IAAI,CAAC,EAAE;IAACgD,SAAS,EAAE;EAAI,CAAC,CAAC;EAC7C,MAAMjD,SAAS,CAACC,IAAI,EAAES,OAAO,CAAC;AAChC;AAEO,eAAe1E,UAAUA,CAACkH,IAAa,EAAEC,IAA0B,EAAmB;EAC3F,MAAM;IAACC;EAAO,CAAC,GAAGD,IAAI,IAAI,CAAC,CAAC;EAC5B,OAAOpB,gDAAM,CACXqB,OAAO,GAAGnJ,IAAI,CAACC,SAAS,CAACgJ,IAAI,CAAC,GAAGjJ,IAAI,CAACC,SAAS,CAACgJ,IAAI,EAAElE,SAAS,EAAE,CAAC,CAAC,EACnEwD,cAAc,CAAC,MAAM,CACvB,CAAC;AACH;AACO,eAAea,aAAaA,CAACpD,IAAY,EAAEiD,IAAa,EAAiB;EAC9E,MAAMhH,YAAY,CAAC+D,IAAI,EAAE,MAAMjE,UAAU,CAACkH,IAAI,CAAC,CAAC;AAClD;AAEO,eAAenH,QAAQA,CAACuH,EAAU,EAAmB;EAC1D,OAAOvB,gDAAM,CAACuB,EAAE,EAAEd,cAAc,CAAC,OAAO,CAAC,CAAC;AAC5C;AACO,eAAee,WAAWA,CAACtD,IAAY,EAAEqD,EAAU,EAAiB;EACzE,MAAMpH,YAAY,CAAC+D,IAAI,EAAE,MAAMlE,QAAQ,CAACuH,EAAE,CAAC,CAAC;AAC9C;AAEO,eAAeE,QAAQA,CAACC,EAAU,EAAmB;EAC1D,OAAO1B,gDAAM,CAAC0B,EAAE,EAAEjB,cAAc,CAAC,YAAY,CAAC,CAAC;AACjD;AACO,eAAekB,WAAWA,CAACzD,IAAY,EAAEwD,EAAU,EAAiB;EACzE,MAAMvH,YAAY,CAAC+D,IAAI,EAAE,MAAMuD,QAAQ,CAACC,EAAE,CAAC,CAAC;AAC9C;AAEO,eAAeE,uBAAuBA,CAAC1D,IAAY,EAAES,OAAe,EAAiB;EAC1F,IAAI,MAAMkD,MAAM,CAAC3D,IAAI,CAAC,EAAE;IACtB;EACF;EACA,MAAM/D,YAAY,CAAC+D,IAAI,EAAES,OAAO,CAAC;AACnC;AAEO,eAAemD,KAAKA,CAACC,OAAe,EAAiB;EAC1D,MAAMzB,EAAE,CAACyB,OAAO,EAAE;IAACb,SAAS,EAAE,IAAI;IAAEc,KAAK,EAAE;EAAI,CAAC,CAAC;AACnD;AAEO,eAAeC,QAAQA,CAACF,OAAe,EAAiB;EAC7D,IAAI;IACF,MAAMD,KAAK,CAACC,OAAO,CAAC;EACtB,CAAC,SAAS;IACR,MAAM1B,KAAK,CAAC0B,OAAO,EAAE;MAACb,SAAS,EAAE;IAAI,CAAC,CAAC;EACzC;AACF;AAEO,eAAegB,EAAEA,CAACC,IAAY,EAAEC,EAAU,EAAiB;EAChE,OAAO,IAAInL,OAAO,CAAC,CAACC,OAAO,EAAEmL,MAAM,KAAK;IACtCzC,wDAAI,CAAE,SAAQuC,IAAK,IAAGC,EAAG,EAAC,EAAEhL,GAAG,IAAKA,GAAG,GAAGiL,MAAM,CAACjL,GAAG,CAAC,GAAGF,OAAO,CAAC,CAAE,CAAC;EACrE,CAAC,CAAC;AACJ;AAEO,eAAe2K,MAAMA,CAAC3D,IAAY,EAAoB;EAC3D,IAAI;IACF,MAAM+B,MAAM,CAAC/B,IAAI,CAAC;IAClB,OAAO,IAAI;EACb,CAAC,CAAC,MAAM;IACN,OAAO,KAAK;EACd;AACF;AAEO,eAAeoE,aAAaA,CAACpE,IAAY,EAA+B;EAC7E,IAAI;IACF,MAAMqE,WAAW,GAAG,MAAMrI,QAAQ,CAACgE,IAAI,CAAC;IACxC,OAAOqE,WAAW,CAAC/B,QAAQ,CAAC,CAAC;EAC/B,CAAC,CAAC,MAAM;IACN,OAAOvD,SAAS;EAClB;AACF;AAEO,SAASuF,iBAAiBA,CAACtE,IAAY,EAAsB;EAClE,IAAI;IACF,MAAMqE,WAAW,GAAGzC,qDAAY,CAAC5B,IAAI,CAAC;IACtC,OAAOqE,WAAW,CAAC/B,QAAQ,CAAC,CAAC;EAC/B,CAAC,CAAC,MAAM;IACN,OAAOvD,SAAS;EAClB;AACF;AAEO,eAAelD,SAASA,CAACmE,IAAY,EAAqB;EAC/D,MAAMa,KAAe,GAAG,EAAE;EAC1B,MAAM0D,IAAI,GAAG,MAAMtC,OAAO,CAACjC,IAAI,EAAE;IAACwE,aAAa,EAAE;EAAI,CAAC,CAAC;EACvD,MAAM7C,QAAyB,GAAG,EAAE;EACpC,KAAK,MAAM8C,GAAG,IAAIF,IAAI,EAAE;IACtB,MAAMG,OAAO,GAAGhJ,+CAAI,CAACsE,IAAI,EAAEyE,GAAG,CAAC5F,IAAI,CAAC;IACpC,IAAI4F,GAAG,CAACE,WAAW,CAAC,CAAC,EAAE;MACrBhD,QAAQ,CAACpI,IAAI,CACXsC,SAAS,CAAC6I,OAAO,CAAC,CAACE,IAAI,CAACC,QAAQ,IAAI;QAClChE,KAAK,CAACtH,IAAI,CAAC,GAAGsL,QAAQ,CAAC;MACzB,CAAC,CACH,CAAC;IACH,CAAC,MAAM,IAAIJ,GAAG,CAACK,MAAM,CAAC,CAAC,EAAE;MACvBjE,KAAK,CAACtH,IAAI,CAACmL,OAAO,CAAC;IACrB;EACF;EACA,MAAM3L,OAAO,CAAC6G,GAAG,CAAC+B,QAAQ,CAAC;EAC3B,OAAOd,KAAK;AACd;;;;;;ACjIA;;;;;;;;;;;;;ACAuC;AAEhC,SAAS3E,GAAGA,CAACvC,IAAqB,EAAU;EACjD,MAAM8G,OAAO,GAAG,OAAO9G,IAAI,KAAK,QAAQ,GAAGA,IAAI,GAAGA,IAAI,CAAC2I,QAAQ,CAAC,CAAC;EACjE,OAAOyC,uDAAU,CAAC,KAAK,CAAC,CAACC,MAAM,CAACvE,OAAO,CAAC,CAACwE,MAAM,CAAC,KAAK,CAAC;AACxD;AAEO,SAASC,YAAYA,CAACC,QAAgB,EAAEC,IAAY,EAAU;EACnE,OAAOL,uDAAU,CAAC,QAAQ,CAAC,CAACC,MAAM,CAAE,GAAEG,QAAS,GAAEC,IAAK,EAAC,CAAC,CAACH,MAAM,CAAC,QAAQ,CAAC;AAC3E;;;;;;ACTA;;;;;;;;;;;;;;;;;;ACAyC;AACF;AAEiC;AACa;AAErC;AACJ;AAE5C,MAAMhI,cAAc,GAAGvB,+CAAI,CAACE,uDAAa,CAACsB,MAAM,CAACC,IAAI,CAACC,GAAG,CAAC,EAAE,cAAc,CAAC;AAEpE,eAAejB,eAAeA,CACnCiD,GAAW,EACXS,OAAyB,EACzBN,SAAgC,EAChCF,aAAqB,EACA;EACrB,MAAMkG,OAAmB,GAAG,EAAE;EAC9B,MAAMxF,SAAS,GAAG,MAAAA,CAAOC,IAAY,EAAEC,IAAY,KACjDC,mFAAkB,CAACX,SAAS,EAAEH,GAAG,EAAEY,IAAI,EAAEC,IAAI,CAAC;EAChD,MAAM;IAACvC,WAAW;IAAEF,IAAI;IAAEK;EAAI,CAAC,GAAGgC,OAAO;EACzC,MAAM2F,WAAW,GAAG;IAClBC,kBAAkB,EAAEpG,aAAa;IACjCqG,4BAA4B,EAAEJ,4DAAS,CAACjG,aAAa,CAAC;IACtD;IACAsG,yBAAyB,EAAEN,gEAAgB,CAAC,EAAE;EAChD,CAAC;;EAED;EACA,MAAMO,YAAY,GAAGlK,+CAAI,CAACuB,cAAc,EAAEO,IAAI,CAAC;EAC/C,MAAMqD,KAAK,GAAG,MAAMhF,kDAAS,CAAC+J,YAAY,CAAC;EAC3C,MAAM7M,OAAO,CAAC6G,GAAG,CACfiB,KAAK,CAAClC,GAAG,CAAC,MAAMsB,IAAI,IAAI;IACtB,MAAMM,YAAY,GAAG5E,mDAAQ,CAACiK,YAAY,EAAE3F,IAAI,CAAC;IACjD,MAAMO,OAAO,GAAG9E,+CAAI,CAACgC,WAAW,EAAE6C,YAAY,CAAC;IAC/C,MAAME,OAAO,GAAG,MAAMzE,iDAAQ,CAACiE,IAAI,CAAC;IACpC,IAAI4F,UAAU,GAAGpF,OAAO;IACxB,KAAK,MAAM,CAACqF,OAAO,EAAEC,QAAQ,CAAC,IAAIC,MAAM,CAACC,OAAO,CAAC;MAAC,GAAGpI,IAAI;MAAE,GAAG2H;IAAW,CAAC,CAAC,EAAE;MAC3EK,UAAU,GAAGA,UAAU,CAACK,UAAU,CAACJ,OAAO,EAAEC,QAAQ,CAAC;IACvD;IACA,IAAI9F,IAAI,CAACkG,QAAQ,CAAC,KAAK,CAAC,IAAIlG,IAAI,CAACkG,QAAQ,CAAC,MAAM,CAAC,EAAE;MACjDN,UAAU,GAAG,MAAM9C,uDAAc,CAAC8C,UAAU,EAAE,YAAY,CAAC;IAC7D;IACA,IAAI5F,IAAI,CAACkG,QAAQ,CAAC,OAAO,CAAC,EAAE;MAC1B,IAAIlG,IAAI,CAACkG,QAAQ,CAAC,cAAc,CAAC,EAAE;QACjC,MAAMC,WAAW,GAAGpM,IAAI,CAACqM,KAAK,CAAC,MAAMrK,iDAAQ,CAACiE,IAAI,CAAC,CAAC;QACpDmG,WAAW,CAAC,MAAM,CAAC,GAAG1I,WAAW;QACjCmI,UAAU,GAAG,MAAM9J,mDAAU,CAACqK,WAAW,CAAC;MAC5C,CAAC,MAAM;QACLP,UAAU,GAAG,MAAM9C,uDAAc,CAAC8C,UAAU,EAAE,MAAM,CAAC;MACvD;IACF;IACAN,OAAO,CAAChM,IAAI,CAAC,MAAMwG,SAAS,CAACS,OAAO,EAAEqF,UAAU,CAAC,CAAC;EACpD,CAAC,CACH,CAAC;EAED,OAAON,OAAO;AAChB;;;;;;;;;;;;;;ACzDwC;AAExC,MAAMgB,QAAQ,GAAG,gEAAgE;AAC1E,SAASlB,gBAAgBA,CAACmB,MAAc,EAAEC,GAAY,EAAU;EACrE,IAAIC,MAAM,GAAG,EAAE;EACf,MAAMC,UAAU,GAAGF,GAAG,IAAIF,QAAQ;EAClC,MAAMK,KAAK,GAAGN,wDAAW,CAACE,MAAM,CAAC;EACjC,KAAK,MAAMK,IAAI,IAAID,KAAK,EAAE;IACxB;IACAF,MAAM,IAAIC,UAAU,CAACG,IAAI,CAACC,KAAK,CAAEF,IAAI,GAAG,GAAG,IAAKF,UAAU,CAACH,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC;EAC1E;EACA,OAAOE,MAAM;AACf;AAEA,MAAMM,UAAU,GAAG,EAAE;AACd,SAASC,OAAOA,CAACC,MAAe,EAAU;EAC/C,MAAMC,EAAE,GAAG9B,gBAAgB,CAAC2B,UAAU,CAAC;EACvC,OAAOE,MAAM,KAAKnI,SAAS,GAAGoI,EAAE,GAAI,GAAED,MAAO,GAAEC,EAAG,EAAC;AACrD;AAEA,MAAMC,eAAe,GAAG,EAAE;AACnB,SAASC,aAAaA,CAAA,EAAW;EACtC,OAAOf,wDAAW,CAACc,eAAe,CAAC,CAAC9E,QAAQ,CAAC,QAAQ,CAAC;AACxD;;;;;;;;;;;;;;ACvBO,SAASgF,UAAUA,CAACC,KAAa,EAAU;EAChD,MAAM,CAACC,SAAS,CAAC,GAAGD,KAAK;EACzB,OAAOC,SAAS,KAAKzI,SAAS,GAAG,EAAE,GAAGyI,SAAS,CAACpJ,WAAW,CAAC,CAAC,GAAGmJ,KAAK,CAACE,KAAK,CAAC,CAAC,CAAC;AAChF;AAEO,SAASC,YAAYA,CAACH,KAAa,EAAU;EAClD,MAAM,CAACC,SAAS,CAAC,GAAGD,KAAK;EACzB,OAAOC,SAAS,KAAKzI,SAAS,GAAG,EAAE,GAAGyI,SAAS,CAACG,WAAW,CAAC,CAAC,GAAGJ,KAAK,CAACE,KAAK,CAAC,CAAC,CAAC;AAChF;AAEO,SAASG,UAAUA,CAAChO,GAAW,EAAU;EAC9C,OAAOA,GAAG,CACP+N,WAAW,CAAC,CAAC,CACbE,KAAK,CAAC,UAAU,CAAC,CACjBlJ,GAAG,CAACmJ,CAAC,IAAIR,UAAU,CAACQ,CAAC,CAAC,CAAC,CACvBpM,IAAI,CAAC,EAAE,CAAC;AACb;AAEO,SAAS4J,SAASA,CAAC1L,GAAW,EAAU;EAC7C,OAAOA,GAAG,CACPwE,WAAW,CAAC,CAAC,CACbyJ,KAAK,CAAC,UAAU,CAAC,CACjBnM,IAAI,CAAC,GAAG,CAAC;AACd;AAEO,SAASmB,SAASA,CAACjD,GAAW,EAAU;EAC7C,OAAOA,GAAG,CACP+N,WAAW,CAAC,CAAC,CACbE,KAAK,CAAC,UAAU,CAAC,CACjBnM,IAAI,CAAC,GAAG,CAAC;AACd;;;;;;;;;;AC9BO,SAASU,iBAAiBA,CAAA,EAAW;EAC1C,OAAQ;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK,CAAC2L,IAAI,CAAC,CAAC;AACZ;;;;;;;;;;;;AClBoE;AAED;AAEnE,SAASE,IAAIA,CAAIvO,GAAQ,EAAO;EAC9B,OAAO,CAAC,GAAG,IAAIwO,GAAG,CAACxO,GAAG,CAAC,CAACyO,MAAM,CAAC,CAAC,CAAC;AACnC;AAEO,SAAS9L,4BAA4BA,CAC1CgD,aAA4B,EAC5BG,QAA4B,EACH;EACzB,MAAM4I,cAAc,GAAGH,IAAI,CAACzI,QAAQ,CAACb,GAAG,CAACiC,CAAC,IAAIpG,iEAAwB,CAACoG,CAAC,CAACpD,IAAI,CAAC,CAAC9C,MAAM,CAAC,CAAC;EACvF,MAAM2N,gBAAgB,GAAGJ,IAAI,CAACzI,QAAQ,CAACb,GAAG,CAACiC,CAAC,IAAIpG,iEAAwB,CAACoG,CAAC,CAACpD,IAAI,CAAC,CAAC7C,QAAQ,CAAC,CAAC;EAC3F,MAAM2N,eAAe,GAAGL,IAAI,CAACzI,QAAQ,CAACb,GAAG,CAACiC,CAAC,IAAIpG,iEAAwB,CAACoG,CAAC,CAACpD,IAAI,CAAC,CAAC5C,OAAO,CAAC,CAAC;EAEzF,OAAO;IACLiE,IAAI,EAAEQ,aAAa;IACnBkJ,OAAO,EAAE,YAAY;IACrB/K,IAAI,EAAE,QAAQ;IACdgL,OAAO,EAAE;MACPC,IAAI,EAAE;IACR,CAAC;IACDC,OAAO,EAAE;MACPC,KAAK,EAAE,iBAAiB;MACxBC,MAAM,EAAE,kBAAkB;MAC1BC,KAAK,EAAE,qCAAqC;MAC5CC,KAAK,EAAE;IACT,CAAC;IACDC,YAAY,EAAE;MACZC,cAAc,EAAE,CAAC,SAAS;IAC5B,CAAC;IACDC,QAAQ,EAAE,0BAA0B;IACpCC,eAAe,EAAElD,MAAM,CAACmD,WAAW,CAE/B,CACE,GAAGf,cAAc,CAACzJ,GAAG,CAACyK,OAAO,IAAI,CAC9B,0BAAyBA,OAAQ,EAAC,EACnCpM,2DAAgB,CAACtC,MAAM,CACxB,CAAC,EACF,CAAC,0BAA0B,EAAEsC,2DAAgB,CAACiM,QAAQ,CAAC,EACvD,GAAGZ,gBAAgB,CAAC1J,GAAG,CAACyK,OAAO,IAAI,CAChC,qBAAoBA,OAAQ,EAAC,EAC9BpM,2DAAgB,CAACrC,QAAQ,CAC1B,CAAC,EACF,GAAG2N,eAAe,CAAC3J,GAAG,CAACyK,OAAO,IAAI,CAC/B,oBAAmBA,OAAQ,EAAC,EAC7BpM,2DAAgB,CAACpC,OAAO,CACzB,CAAC,EACF,CAAC,yBAAyB,EAAEoC,2DAAgB,CAACqM,MAAM,CAAC,EACpD,CAAC,YAAY,EAAErB,6DAAkB,CAAC,CACnC,CACDhJ,IAAI,CAAC,CAACsK,EAAE,EAAEC,EAAE,KAAKD,EAAE,CAAC,CAAC,CAAC,CAACE,aAAa,CAACD,EAAE,CAAC,CAAC,CAAC,CAAC,CAC/C;EACF,CAAC;AACH;;;;;;;;;;;;;;ACvDO,MAAMvM,gBAAgB,GAAG;EAC9B6C,OAAO,EAAE,QAAQ;EACjBnF,MAAM,EAAE,OAAO;EACfuO,QAAQ,EAAE,OAAO;EACjBtO,QAAQ,EAAE,OAAO;EACjBC,OAAO,EAAE,QAAQ;EACjByO,MAAM,EAAE,QAAQ;EAChBI,mBAAmB,EAAE;AACvB,CAAC;AAEM,MAAMC,cAAc,GAAG,QAAQ;AAC/B,MAAMC,gBAAgB,GAAG,OAAO;AAChC,MAAM3B,kBAAkB,GAAG,OAAO;AAElC,MAAM4B,YAAY,GAAG;EAC1B,cAAc,EAAE,QAAQ;EACxB,kBAAkB,EAAE,QAAQ;EAC5BC,KAAK,EAAE,QAAQ;EACf,WAAW,EAAE,QAAQ;EACrB,mBAAmB,EAAE;AACvB,CAAC;;;;;;;;;;;;;;;;;;ACpBsD;AAEmC;AACpB;AACO;AACT;AACvB;AAEtC,SAASvN,uBAAuBA,CACrC+C,aAA4B,EAC5BG,QAA4B,EACpB;EACR,OAAO,CACLwK,6FAA4B,CAAC3K,aAAa,CAAC,EAC3C4K,oFAAyB,CACvB5K,aAAa,EACbG,QAAQ,CAAC0K,MAAM,CAACtJ,CAAC,IAAIA,CAAC,CAACpD,IAAI,KAAKpD,oDAAW,CAACK,GAAG,CAAC,CAACkE,GAAG,CAACiC,CAAC,IAAIA,CAAC,CAAClD,WAAW,CACzE,CAAC,CACF,CAAChC,IAAI,CAAC,MAAM,CAAC;AAChB;AAEO,SAASc,iCAAiCA,CAC/C6C,aAA4B,EAC5BQ,OAAyB,EACL;EACpB,MAAM;IAACnC,WAAW;IAAEF,IAAI;IAAEI;EAAY,CAAC,GAAGiC,OAAO;EACjD,MAAMsK,wBAAwB,GAC5B,0BAA0B,IAAIvM,YAAY,GAAGA,YAAY,CAACuM,wBAAwB,GAAGpL,SAAS;EAChG,MAAMqL,UAAU,GAAG,YAAY,IAAIxM,YAAY,GAAGA,YAAY,CAACwM,UAAU,GAAGrL,SAAS;EACrF,IAAIvB,IAAI,KAAKpD,oDAAW,CAACK,GAAG,EAAE;IAC5B,OAAOqP,0GAAuC,CAACzK,aAAa,EAAE3B,WAAW,CAAC;EAC5E,CAAC,MAAM,IAAIF,IAAI,KAAKpD,oDAAW,CAACS,cAAc,EAAE;IAC9C,OAAOkP,sFAAuB,CAAC1K,aAAa,EAAE3B,WAAW,EAAE;MACzD2M,GAAG,EAAE,KAAK;MACVC,GAAG,EAAE,KAAK;MACVF,UAAU;MACVD;IACF,CAAC,CAAC;EACJ,CAAC,MAAM,IAAI3M,IAAI,KAAKpD,oDAAW,CAACY,SAAS,EAAE;IACzC,OAAO+O,sFAAuB,CAAC1K,aAAa,EAAE3B,WAAW,EAAE;MACzD2M,GAAG,EAAE,IAAI;MACTC,GAAG,EAAE,KAAK;MACVF,UAAU;MACVD;IACF,CAAC,CAAC;EACJ,CAAC,MAAM,IAAI3M,IAAI,KAAKpD,oDAAW,CAACa,YAAY,EAAE;IAC5C,OAAO8O,sFAAuB,CAAC1K,aAAa,EAAE3B,WAAW,EAAE;MACzD2M,GAAG,EAAE,IAAI;MACTC,GAAG,EAAE,IAAI;MACTF,UAAU;MACVD;IACF,CAAC,CAAC;EACJ,CAAC,MAAM,IAAI3M,IAAI,KAAKpD,oDAAW,CAACc,UAAU,EAAE;IAC1C,OAAO6D,SAAS;EAClB,CAAC,MAAM,IAAIvB,IAAI,KAAKpD,oDAAW,CAACiB,UAAU,EAAE;IAC1C,OAAO0D,SAAS;EAClB,CAAC,MAAM,IAAIvB,IAAI,KAAKpD,oDAAW,CAACkB,SAAS,EAAE;IACzC,OAAOyD,SAAS;IAChB;EACF,CAAC,MAAM,IAAIvB,IAAI,KAAKpD,oDAAW,CAACe,MAAM,EAAE;IACtC,OAAO4D,SAAS;EAClB;EACAjC,6DAAY,CAACU,IAAI,EAAE,aAAa,CAAC;AACnC;AAEO,SAASjB,iCAAiCA,CAAA,EAAW;EAC1D,OAAQ;AACV;AACA;AACA;AACA,CAAC,CAACwL,IAAI,CAAC,CAAC;AACR;;;;;;;;;;ACrEO,SAAS+B,uCAAuCA,CACrDzK,aAA4B,EAC5B3B,WAAwB,EAChB;EACR,MAAM6M,UAAU,GAAG7M,WAAW,CAACiK,WAAW,CAAC,CAAC,CAAC6C,OAAO,CAAC,eAAe,EAAE,GAAG,CAAC;EAC1E,MAAMC,QAAQ,GAAI,GAAEF,UAAW,YAAW;EAC1C,OAAQ;AACV,UAAU7M,WAAY;AACtB,8CAA8CA,WAAY;AAC1D,yDAAyD2B,aAAc,IAAG3B,WAAY;AACtF;AACA;AACA,0CAA0CA,WAAY;AACtD;AACA;AACA,qBAAqB+M,QAAS;AAC9B,sBAAsB/M,WAAY;AAClC;AACA;AACA,uEAAuEA,WAAY;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B+M,QAAS;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oDAAoD/M,WAAY;AAChE,GAAG,CAACqK,IAAI,CAAC,CAAC;AACV;;;;;;;;;;;AC1E4C;AAErC,SAASgC,uBAAuBA,CACrC1K,aAA4B,EAC5B3B,WAAwB,EACxBwF,IAKC,EACO;EACR,MAAM;IAACmH,GAAG;IAAEC,GAAG;IAAEF,UAAU;IAAED;EAAwB,CAAC,GAAGjH,IAAI;EAC7D,MAAMwH,WAAW,GAAG7N,4DAAS,CAACwC,aAAa,CAAC;EAC5C,OAAQ;AACV;AACA,kCAAkC3B,WAAY;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+BAA+BgN,WAAY;AAC3C,+BAA+BA,WAAY;AAC3C,+BAA+BA,WAAY;AAC3C,+BAA+BA,WAAY;AAC3C;AACA,KACIJ,GAAG,GACE;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,GACI,EACL;AACH;AACA;AACA,kCAAkC5M,WAAY;AAC9C,yBAAyB2B,aAAc,IAAG3B,WAAY;AACtD,sCAAsCA,WAAY;AAClD,sCAAsCA,WAAY;AAClD;AACA;AACA,qCAAqCA,WAAY;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAUA,WAAY;AACtB,sCAAsCA,WAAY;AAClD,2CAA2C2B,aAAc,IAAG3B,WAAY;AACxE;AACA,EACE2M,GAAG,GACE;AACP;AACA;AACA,sCAAsC3M,WAAY;AAClD,6CAA6CA,WAAY;AACzD;AACA;AACA;AACA,UAAUA,WAAY;AACtB,0CAA0CA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","sources":["webpack://b/external node-commonjs \"node:child_process\"","webpack://b/external node-commonjs \"node:path\"","webpack://b/external node-commonjs \"ansi-colors\"","webpack://b/external node-commonjs \"webpack\"","webpack://b/external node-commonjs \"webpack-dev-server\"","webpack://b/./src/exit_handler.ts","webpack://b/./src/global_error.ts","webpack://b/external node-commonjs \"node:fs\"","webpack://b/./src/logger.ts","webpack://b/./src/models.ts","webpack://b/./src/project/generate_workspace.ts","webpack://b/external node-commonjs \"node:url\"","webpack://b/./src/fs.ts","webpack://b/external node-commonjs \"prettier\"","webpack://b/./src/hash.ts","webpack://b/external node-commonjs \"node:crypto\"","webpack://b/./src/project/generate_project.ts","webpack://b/./src/rand_safe.ts","webpack://b/./src/string_utils.ts","webpack://b/./src/project/gitignore.ts","webpack://b/./src/project/package_json.ts","webpack://b/./src/versions.ts","webpack://b/./src/project/terraform/all.ts","webpack://b/./src/project/terraform/cloudfront.ts","webpack://b/./src/project/terraform/lambda.ts","webpack://b/./src/project/terraform/provider.ts","webpack://b/./src/project/terraform/s3.ts","webpack://b/./src/type_utils.ts","webpack://b/./src/project/terraform/dynamo_user.ts","webpack://b/./src/project/terraform/dynamo_user_session.ts","webpack://b/./src/project/vscode_workspace.ts","webpack://b/./src/webpack/utils.ts","webpack://b/external node-commonjs \"node:fs/promises\"","webpack://b/./src/webpack-runner/env_definition_file.ts","webpack://b/./src/webpack-runner/error_grouper.ts","webpack://b/./src/webpack-runner/error_parser.ts","webpack://b/./src/webpack-runner/ip.ts","webpack://b/external node-commonjs \"node:os\"","webpack://b/./src/webpack-runner/line_reader.ts","webpack://b/./src/webpack-runner/renderer.ts","webpack://b/./src/webpack-runner/error_formatter.ts","webpack://b/./src/webpack-runner/text_table.ts","webpack://b/webpack/bootstrap","webpack://b/webpack/runtime/compat get default export","webpack://b/webpack/runtime/define property getters","webpack://b/webpack/runtime/hasOwnProperty shorthand","webpack://b/webpack/runtime/make namespace object","webpack://b/./src/webpack-runner/runner.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:child_process\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:path\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"ansi-colors\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"webpack\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"webpack-dev-server\");","import {globalError} from '@src/global_error';\n\nlet called = false;\nconst callbacks: (() => void | Promise<void>)[] = [];\n\nfunction runCallbacks(): void {\n  if (called) {\n    return;\n  }\n  called = true;\n  for (const fn of callbacks) {\n    Promise.resolve(fn()).catch(err => globalError('Failure to run exit cleanup callback', err));\n  }\n}\n\nprocess.on('beforeExit', () => runCallbacks());\nprocess.on('exit', () => runCallbacks());\nprocess.on('SIGTERM', () => runCallbacks());\nprocess.on('SIGINT', () => runCallbacks());\nprocess.on('uncaughtException', err => {\n  globalError('uncaughtException', err);\n  runCallbacks();\n});\n\nexport function registerExitCallback(cb: () => void | Promise<void>): void {\n  callbacks.push(cb);\n}\n","import {appendFileSync} from 'node:fs';\n\nimport {error} from '@src/logger';\n\nexport function globalError(...val: unknown[]): void {\n  for (const data of val) {\n    try {\n      const str =\n        typeof data === 'string'\n          ? data\n          : data instanceof Error\n            ? data.stack ?? String(data)\n            : JSON.stringify(data);\n      error(str);\n      appendFileSync('error.log', str);\n    } catch {\n      error(String(val));\n      appendFileSync('error.log', String(val));\n    }\n  }\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:fs\");","export const {log, error} = console;\n","import {Brand} from '@src/type_utils';\n\nexport type WorkspaceName = Brand<string, 'WorkspaceName'>;\nexport type ProjectName = Brand<string, 'ProjectName'>;\n\n//\n// Project type\n//\n\nexport enum ProjectType {\n  Web = 'web',\n  LambdaFunction = 'lambda_function',\n  LambdaApi = 'lambda_api',\n  LambdaWebApi = 'lambda_web_api',\n  NodeScript = 'node_script',\n  Shared = 'shared',\n  SharedNode = 'shared-node',\n  SharedWeb = 'shared-web',\n}\n\nexport enum EslintType {\n  Web = 'web',\n  Node = 'node',\n  Lib = 'lib',\n}\n\nexport enum TsConfigType {\n  Web = 'web',\n  Node = 'node',\n  Lib = 'lib',\n}\nexport enum WebpackType {\n  Web = 'web',\n  Lib = 'lib', // shared\n  Lambda = 'lambda',\n  NodeScript = 'node-script',\n}\n\nexport interface ProjectTypeMetadata {\n  eslint: EslintType;\n  tsconfig: TsConfigType;\n  webpack?: WebpackType;\n}\n\nexport const PROJECT_TYPE_TO_METADATA = {\n  [ProjectType.Web]: {\n    eslint: EslintType.Web,\n    tsconfig: TsConfigType.Web,\n    webpack: WebpackType.Web,\n  },\n  [ProjectType.LambdaFunction]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lambda,\n  },\n  [ProjectType.LambdaApi]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lambda,\n  },\n  [ProjectType.LambdaWebApi]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lambda,\n  },\n  [ProjectType.NodeScript]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.NodeScript,\n  },\n  [ProjectType.Shared]: {\n    eslint: EslintType.Lib,\n    tsconfig: TsConfigType.Lib,\n    webpack: WebpackType.Lib,\n  },\n  [ProjectType.SharedNode]: {\n    eslint: EslintType.Node,\n    tsconfig: TsConfigType.Node,\n    webpack: WebpackType.Lib,\n  },\n  [ProjectType.SharedWeb]: {\n    eslint: EslintType.Web,\n    tsconfig: TsConfigType.Web,\n    webpack: WebpackType.Lib,\n  },\n} satisfies Record<ProjectType, ProjectTypeMetadata>;\n\n//\n// Workspace Fragment type\n//\n\nexport enum WorkspaceFragmentType {\n  StaticWebsite = 'static-website',\n  StandaloneLambda = 'standalone-lambda',\n  ApiLambda = 'api-lambda',\n  WebApp = 'web-app',\n  NodeScript = 'node-script',\n  Shared = 'shared',\n  SharedNode = 'shared-node',\n  SharedWeb = 'shared-web',\n}\n\ninterface WorkspaceFragmentBase {\n  type: WorkspaceFragmentType;\n}\n\nexport interface WorkspaceFragmentRegistry {\n  [WorkspaceFragmentType.StaticWebsite]: {\n    type: WorkspaceFragmentType.StaticWebsite;\n    websiteName: ProjectName;\n  };\n  [WorkspaceFragmentType.StandaloneLambda]: {\n    type: WorkspaceFragmentType.StandaloneLambda;\n    lambdaName: ProjectName;\n    alarmEmail: string | undefined;\n    cloudwatchTriggerMinutes: number | undefined;\n  };\n  [WorkspaceFragmentType.ApiLambda]: {\n    type: WorkspaceFragmentType.ApiLambda;\n    lambdaName: ProjectName;\n    alarmEmail: string | undefined;\n  };\n  [WorkspaceFragmentType.WebApp]: {\n    type: WorkspaceFragmentType.WebApp;\n    websiteName: ProjectName;\n    lambdaName: ProjectName;\n    alarmEmail: string | undefined;\n  };\n  [WorkspaceFragmentType.NodeScript]: {\n    type: WorkspaceFragmentType.NodeScript;\n    scriptName: ProjectName;\n  };\n  [WorkspaceFragmentType.Shared]: {\n    type: WorkspaceFragmentType.Shared;\n  };\n  [WorkspaceFragmentType.SharedNode]: {\n    type: WorkspaceFragmentType.SharedNode;\n  };\n  [WorkspaceFragmentType.SharedWeb]: {\n    type: WorkspaceFragmentType.SharedWeb;\n  };\n}\n\ntype RegistryIsValid = WorkspaceFragmentRegistry extends Record<\n  WorkspaceFragmentType,\n  WorkspaceFragmentBase\n>\n  ? boolean\n  : never;\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction validateRegistry(): RegistryIsValid {\n  return true;\n}\n\nexport type WorkspaceFragment = WorkspaceFragmentRegistry[keyof WorkspaceFragmentRegistry];\n","import {execSync} from 'node:child_process';\nimport {join, relative} from 'node:path';\nimport {fileURLToPath} from 'node:url';\n\nimport {listFiles, prettyJs, prettyJson, readFile, writeRawFile} from '@src/fs';\nimport {md5} from '@src/hash';\nimport {log} from '@src/logger';\nimport {\n  ProjectName,\n  ProjectType,\n  WorkspaceFragment,\n  WorkspaceFragmentType,\n  WorkspaceName,\n} from '@src/models';\nimport {generateProject} from '@src/project/generate_project';\nimport {generateGitIgnore} from '@src/project/gitignore';\nimport {generateWorkspacePackageJson} from '@src/project/package_json';\nimport {\n  generateCommonTerraform,\n  generateDummyTerraformCredentials,\n  generateWorkspaceProjectTerraform,\n} from '@src/project/terraform/all';\nimport {generateDynamoUserTerraform} from '@src/project/terraform/dynamo_user';\nimport {generateDynamoUserSessionTerraform} from '@src/project/terraform/dynamo_user_session';\nimport {\n  FileHash,\n  generateCodeWorkspace,\n  Workspace,\n  writeWorkspace,\n} from '@src/project/vscode_workspace';\nimport {lowerCase} from '@src/string_utils';\nimport {neverHappens, removeUndefined} from '@src/type_utils';\nimport {PACKAGE_VERSIONS} from '@src/versions';\n\nconst TEMPLATES_PATH = join(fileURLToPath(import.meta.url), '../templates');\n\nexport interface WorkspaceProject {\n  projectName: ProjectName;\n  type: ProjectType;\n  fromFragment: WorkspaceFragment;\n  vars: Record<string, string>;\n}\n\nexport function getProjectsFromWorkspaceFragment(\n  fragment: WorkspaceFragment,\n  allFragments: WorkspaceFragment[]\n): WorkspaceProject[] {\n  if (fragment.type === WorkspaceFragmentType.StaticWebsite) {\n    return [\n      {\n        projectName: fragment.websiteName,\n        type: ProjectType.Web,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.websiteName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.StandaloneLambda) {\n    return [\n      {\n        projectName: fragment.lambdaName,\n        type: ProjectType.LambdaFunction,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.lambdaName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.ApiLambda) {\n    return [\n      {\n        projectName: fragment.lambdaName,\n        type: ProjectType.LambdaApi,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.lambdaName,\n          __BACKEND_NAME__: fragment.lambdaName,\n          __BACKEND_NAME_UPPERCASE__: fragment.lambdaName.toUpperCase(),\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.WebApp) {\n    const vars = {\n      __PROJECT_NAME__: fragment.lambdaName,\n      __BACKEND_NAME__: fragment.lambdaName,\n      __BACKEND_NAME_UPPERCASE__: fragment.lambdaName.toUpperCase(),\n      __FRONTEND_NAME__: fragment.websiteName,\n      __FRONTEND_NAME_UPPERCASE__: fragment.websiteName.toUpperCase(),\n    };\n    return [\n      {\n        projectName: fragment.websiteName,\n        type: ProjectType.Web,\n        fromFragment: fragment,\n        vars,\n      },\n      {\n        projectName: fragment.lambdaName,\n        type: ProjectType.LambdaWebApi,\n        fromFragment: fragment,\n        vars,\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.NodeScript) {\n    return [\n      {\n        projectName: fragment.scriptName,\n        type: ProjectType.NodeScript,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: fragment.scriptName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.SharedNode) {\n    const projectName = 'shared-node' as ProjectName;\n    return [\n      {\n        projectName,\n        type: ProjectType.SharedNode,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: projectName,\n        },\n      },\n    ];\n  } else if (fragment.type === WorkspaceFragmentType.SharedWeb) {\n    const projectName = 'shared-web' as ProjectName;\n    return [\n      {\n        projectName,\n        type: ProjectType.SharedWeb,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: projectName,\n        },\n      },\n    ];\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  } else if (fragment.type === WorkspaceFragmentType.Shared) {\n    const projectName = 'shared' as ProjectName;\n    const otherVars: Record<string, string> = {};\n    const [bestBackend] = removeUndefined(\n      allFragments.map(frag => {\n        if (frag.type === WorkspaceFragmentType.WebApp) {\n          return {name: frag.lambdaName, prio: 1};\n        } else if (frag.type === WorkspaceFragmentType.ApiLambda) {\n          return {name: frag.lambdaName, prio: 2};\n        }\n        return undefined;\n      })\n    ).sort((a, b) => a.prio - b.prio);\n    if (bestBackend) {\n      otherVars['__BACKEND_NAME__'] = bestBackend.name;\n      otherVars['__BACKEND_NAME_UPPERCASE__'] = bestBackend.name.toUpperCase();\n    }\n    return [\n      {\n        projectName,\n        type: ProjectType.Shared,\n        fromFragment: fragment,\n        vars: {\n          __PROJECT_NAME__: projectName,\n          ...otherVars,\n        },\n      },\n    ];\n  }\n  neverHappens(fragment, `Unknown ProjectType ${(fragment as WorkspaceFragment).type}`);\n}\n\nexport async function generateWorkspace(\n  dst: string,\n  workspaceName: WorkspaceName,\n  workspaceFragments: WorkspaceFragment[],\n  workspace: Workspace | undefined\n): Promise<void> {\n  const projects = workspaceFragments.flatMap(f =>\n    getProjectsFromWorkspaceFragment(f, workspaceFragments)\n  );\n\n  // Create projects files from templates\n  const projectFiles = await Promise.all(\n    projects.map(async project => generateProject(dst, project, workspace, workspaceName))\n  );\n\n  // Generate workspace root files\n  const SCRIPTS_PATH = join(fileURLToPath(import.meta.url), '../scripts');\n  const writeFile = async (path: string, file: string): Promise<FileHash> =>\n    writeWorkspaceFile(workspace, dst, path, file);\n  const workspaceFiles = await Promise.all([\n    // package.json\n    writeFile(\n      'package.json',\n      await prettyJson(generateWorkspacePackageJson(workspaceName, projects))\n    ),\n    // app.code-workspace\n    writeFile(\n      'app.code-workspace',\n      await prettyJson(generateCodeWorkspace(workspaceName, workspaceFragments))\n    ),\n    // .gitignore\n    writeFile('.gitignore', generateGitIgnore()),\n    // setup.js\n    writeFile('setup.js', await prettyJs(await readFile(join(SCRIPTS_PATH, 'setup.js')))),\n    // deploy.js\n    writeFile('deploy.js', await prettyJs(await readFile(join(SCRIPTS_PATH, 'deploy.js')))),\n    // build.js\n    writeFile('build.js', await prettyJs(await readFile(join(SCRIPTS_PATH, 'build.js')))),\n  ]);\n\n  // Vscode folder\n  const vscodePath = join(TEMPLATES_PATH, '.vscode');\n  const vscodeFileList = await listFiles(vscodePath);\n  const vscodeFiles = await Promise.all(\n    vscodeFileList.map(async file => {\n      const relativePath = relative(vscodePath, file);\n      const dstPath = join('.vscode', relativePath);\n      const content = await readFile(file);\n      return writeFile(dstPath, content);\n    })\n  );\n\n  // Terraform folder generation\n  const tablePrefix = lowerCase(workspaceName);\n  const terraformFiles = await Promise.all([\n    writeFile(join('terraform', '.aws-credentials'), generateDummyTerraformCredentials()),\n    writeFile(\n      join('terraform', `dynamo_table_${tablePrefix}_user.tf`),\n      generateDynamoUserTerraform(workspaceName)\n    ),\n    writeFile(\n      join('terraform', `dynamo_table_${tablePrefix}_user_session.tf`),\n      generateDynamoUserSessionTerraform(workspaceName)\n    ),\n    writeFile(join('terraform', 'base.tf'), generateCommonTerraform(workspaceName, projects)),\n    ...projects.map(async p => {\n      const content = generateWorkspaceProjectTerraform(workspaceName, p);\n      if (content === undefined) {\n        return;\n      }\n      const name = `${p.projectName}_terraform`;\n      return writeFile(join('terraform', `${name}.tf`), content);\n    }),\n  ]);\n\n  await writeWorkspace(dst, {\n    files: removeUndefined([\n      ...projectFiles.flat(),\n      ...workspaceFiles,\n      ...terraformFiles,\n      ...vscodeFiles,\n    ]),\n    fragments: workspaceFragments,\n    version: PACKAGE_VERSIONS.project,\n  });\n\n  // Run setup.js\n  log('Running post install script');\n  const commands = [`cd ${dst}`, `node setup.js`, `git init`];\n  execSync(commands.join(' && '), {stdio: ['ignore', 'inherit', 'inherit']});\n\n  // Final instructions\n  log(`Run the following to get started:`);\n  log(`cd ${relative(process.cwd(), dst)}; code app.code-workspace; yarn watch`);\n}\n\nexport async function writeWorkspaceFile(\n  workspace: Workspace | undefined,\n  root: string,\n  path: string,\n  file: string\n): Promise<FileHash> {\n  const newHash = md5(file);\n  const oldHash = workspace?.files.find(f => f.path === path)?.hash;\n  // Only write the file if it is different since last time we've generated the project.\n  // Prevent needlessly overwriting changes made in the project in between.\n  if (newHash !== oldHash) {\n    await writeRawFile(join(root, path), file);\n  }\n  return {path, hash: newHash};\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:url\");","import {exec} from 'node:child_process';\nimport {promises, readFileSync} from 'node:fs';\nimport {dirname, join} from 'node:path';\n\nimport {BuiltInParserName, format} from 'prettier';\n\nexport const {access, readFile: readFileInternal, readdir, stat} = promises;\nconst {writeFile, mkdir, rm} = promises;\n\nexport async function readFile(path: string): Promise<string> {\n  const buffer = await readFileInternal(path);\n  return buffer.toString();\n}\n\nconst prettierConfig = (parser: BuiltInParserName) =>\n  ({\n    parser,\n    printWidth: 100,\n    singleQuote: true,\n    trailingComma: 'es5',\n    bracketSpacing: false,\n    arrowParens: 'avoid',\n    endOfLine: 'auto',\n  }) as const;\n\nexport async function prettierFormat(str: string, parser: BuiltInParserName): Promise<string> {\n  return format(str, prettierConfig(parser));\n}\n\nexport async function writeRawFile(path: string, content: string): Promise<void> {\n  await mkdir(dirname(path), {recursive: true});\n  await writeFile(path, content);\n}\n\nexport async function prettyJson(json: unknown, opts?: {compact?: boolean}): Promise<string> {\n  const {compact} = opts ?? {};\n  return format(\n    compact ? JSON.stringify(json) : JSON.stringify(json, undefined, 2),\n    prettierConfig('json')\n  );\n}\nexport async function writeJsonFile(path: string, json: unknown): Promise<void> {\n  await writeRawFile(path, await prettyJson(json));\n}\n\nexport async function prettyJs(js: string): Promise<string> {\n  return format(js, prettierConfig('babel'));\n}\nexport async function writeJsFile(path: string, js: string): Promise<void> {\n  await writeRawFile(path, await prettyJs(js));\n}\n\nexport async function prettyTs(ts: string): Promise<string> {\n  return format(ts, prettierConfig('typescript'));\n}\nexport async function writeTsFile(path: string, ts: string): Promise<void> {\n  await writeRawFile(path, await prettyTs(ts));\n}\n\nexport async function writeRawFileIfNotExists(path: string, content: string): Promise<void> {\n  if (await exists(path)) {\n    return;\n  }\n  await writeRawFile(path, content);\n}\n\nexport async function rmDir(dirPath: string): Promise<void> {\n  await rm(dirPath, {recursive: true, force: true});\n}\n\nexport async function cleanDir(dirPath: string): Promise<void> {\n  try {\n    await rmDir(dirPath);\n  } finally {\n    await mkdir(dirPath, {recursive: true});\n  }\n}\n\nexport async function cp(from: string, to: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    exec(`cp -R ${from} ${to}`, err => (err ? reject(err) : resolve()));\n  });\n}\n\nexport async function exists(path: string): Promise<boolean> {\n  try {\n    await access(path);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport async function maybeReadFile(path: string): Promise<string | undefined> {\n  try {\n    const fileContent = await readFile(path);\n    return fileContent.toString();\n  } catch {\n    return undefined;\n  }\n}\n\nexport function maybeReadFileSync(path: string): string | undefined {\n  try {\n    const fileContent = readFileSync(path);\n    return fileContent.toString();\n  } catch {\n    return undefined;\n  }\n}\n\nexport async function listFiles(path: string): Promise<string[]> {\n  const files: string[] = [];\n  const ents = await readdir(path, {withFileTypes: true});\n  const promises: Promise<void>[] = [];\n  for (const ent of ents) {\n    const entPath = join(path, ent.name);\n    if (ent.isDirectory()) {\n      promises.push(\n        listFiles(entPath).then(subFiles => {\n          files.push(...subFiles);\n        })\n      );\n    } else if (ent.isFile()) {\n      files.push(entPath);\n    }\n  }\n  await Promise.all(promises);\n  return files;\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"prettier\");","import {createHash} from 'node:crypto';\n\nexport function md5(data: string | Buffer): string {\n  const content = typeof data === 'string' ? data : data.toString();\n  return createHash('md5').update(content).digest('hex');\n}\n\nexport function hashPassword(password: string, salt: string): string {\n  return createHash('sha256').update(`${password}${salt}`).digest('base64');\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:crypto\");","import {join, relative} from 'node:path';\nimport {fileURLToPath} from 'node:url';\n\nimport {listFiles, prettierFormat, prettyJson, readFile} from '@src/fs';\nimport {WorkspaceProject, writeWorkspaceFile} from '@src/project/generate_workspace';\nimport {FileHash, Workspace} from '@src/project/vscode_workspace';\nimport {randomStringSafe} from '@src/rand_safe';\nimport {upperCase} from '@src/string_utils';\n\nconst TEMPLATES_PATH = join(fileURLToPath(import.meta.url), '../templates');\n\nexport async function generateProject(\n  dst: string,\n  project: WorkspaceProject,\n  workspace: Workspace | undefined,\n  workspaceName: string\n): Promise<FileHash[]> {\n  const written: FileHash[] = [];\n  const writeFile = async (path: string, file: string): Promise<FileHash> =>\n    writeWorkspaceFile(workspace, dst, path, file);\n  const {projectName, type, vars} = project;\n  const defaultVars = {\n    __WORKSPACE_NAME__: workspaceName,\n    __WORKSPACE_NAME_UPPERCASE__: upperCase(workspaceName),\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    __COOKIE_ENCRYPTION_KEY__: randomStringSafe(32),\n  };\n\n  // Copy template files\n  const templatePath = join(TEMPLATES_PATH, type);\n  const files = await listFiles(templatePath);\n  await Promise.all(\n    files.map(async file => {\n      const relativePath = relative(templatePath, file);\n      const dstPath = join(projectName, relativePath);\n      const content = await readFile(file);\n      let newContent = content;\n      for (const [varName, varValue] of Object.entries({...vars, ...defaultVars})) {\n        newContent = newContent.replaceAll(varName, varValue);\n      }\n      if (file.endsWith('.ts') || file.endsWith('.tsx')) {\n        newContent = await prettierFormat(newContent, 'typescript');\n      }\n      if (file.endsWith('.json')) {\n        if (file.endsWith('package.json')) {\n          const packageJson = JSON.parse(await readFile(file));\n          packageJson['name'] = projectName;\n          newContent = await prettyJson(packageJson);\n        } else {\n          newContent = await prettierFormat(newContent, 'json');\n        }\n      }\n      written.push(await writeFile(dstPath, newContent));\n    })\n  );\n\n  return written;\n}\n","import {randomBytes} from 'node:crypto';\n\nconst ALPHANUM = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\nexport function randomStringSafe(length: number, set?: string): string {\n  let result = '';\n  const characters = set ?? ALPHANUM;\n  const bytes = randomBytes(length);\n  for (const byte of bytes) {\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    result += characters[Math.floor((byte / 255) * (characters.length - 1))];\n  }\n  return result;\n}\n\nconst UID_LENGTH = 16;\nexport function uidSafe(prefix?: string): string {\n  const id = randomStringSafe(UID_LENGTH);\n  return prefix === undefined ? id : `${prefix}${id}`;\n}\n\nconst NONCE_BYTE_SIZE = 16;\nexport function generateNonce(): string {\n  return randomBytes(NONCE_BYTE_SIZE).toString('base64');\n}\n","export function capitalize(value: string): string {\n  const [firstChar] = value;\n  return firstChar === undefined ? '' : firstChar.toUpperCase() + value.slice(1);\n}\n\nexport function uncapitalize(value: string): string {\n  const [firstChar] = value;\n  return firstChar === undefined ? '' : firstChar.toLowerCase() + value.slice(1);\n}\n\nexport function pascalCase(str: string): string {\n  return str\n    .toLowerCase()\n    .split(/[^a-z]+/u)\n    .map(s => capitalize(s))\n    .join('');\n}\n\nexport function upperCase(str: string): string {\n  return str\n    .toUpperCase()\n    .split(/[^A-Z]+/u)\n    .join('_');\n}\n\nexport function lowerCase(str: string): string {\n  return str\n    .toLowerCase()\n    .split(/[^a-z]+/u)\n    .join('_');\n}\n","export function generateGitIgnore(): string {\n  return `\n.DS_Store\nnode_modules\nbuild\ndist\ntmp\nyarn-error.log\n.yarn-warnings.log\nyarn.lock\nterraform/.terraform\nterraform/.terraform*\nterraform/*.tfstate.backup\nterraform/.aws-credentials\nterraform/archives\n*/log\n/shared/src/env.ts\n    `.trim();\n}\n","import {PROJECT_TYPE_TO_METADATA, WorkspaceName} from '@src/models';\nimport {WorkspaceProject} from '@src/project/generate_workspace';\nimport {PACKAGE_VERSIONS, TYPESCRIPT_VERSION} from '@src/versions';\n\nfunction uniq<T>(val: T[]): T[] {\n  return [...new Set(val).values()];\n}\n\nexport function generateWorkspacePackageJson(\n  workspaceName: WorkspaceName,\n  projects: WorkspaceProject[]\n): Record<string, unknown> {\n  const eslintRuntimes = uniq(projects.map(p => PROJECT_TYPE_TO_METADATA[p.type].eslint));\n  const tsconfigRuntimes = uniq(projects.map(p => PROJECT_TYPE_TO_METADATA[p.type].tsconfig));\n  const webpackRuntimes = uniq(projects.map(p => PROJECT_TYPE_TO_METADATA[p.type].webpack));\n\n  return {\n    name: workspaceName,\n    license: 'UNLICENSED',\n    type: 'module',\n    engines: {\n      node: '>=20.10',\n    },\n    scripts: {\n      setup: 'node ./setup.js',\n      deploy: 'node ./deploy.js',\n      build: 'NODE_ENV=production node ./build.js',\n      watch: 'NODE_ENV=development node ./build.js --watch',\n    },\n    eslintConfig: {\n      ignorePatterns: ['**/*.js'],\n    },\n    prettier: '@matthis/prettier-config',\n    devDependencies: Object.fromEntries(\n      (\n        [\n          ...eslintRuntimes.map(runtime => [\n            `@matthis/eslint-config-${runtime}`,\n            PACKAGE_VERSIONS.eslint,\n          ]),\n          ['@matthis/prettier-config', PACKAGE_VERSIONS.prettier],\n          ...tsconfigRuntimes.map(runtime => [\n            `@matthis/tsconfig-${runtime}`,\n            PACKAGE_VERSIONS.tsconfig,\n          ]),\n          ...webpackRuntimes.map(runtime => [\n            `@matthis/webpack-${runtime}`,\n            PACKAGE_VERSIONS.webpack,\n          ]),\n          ['@matthis/webpack-runner', PACKAGE_VERSIONS.runner],\n          ['typescript', TYPESCRIPT_VERSION],\n        ] as [string, string][]\n      ).sort((d1, d2) => d1[0].localeCompare(d2[0]))\n    ),\n  };\n}\n","export const PACKAGE_VERSIONS = {\n  project: '1.9.11',\n  eslint: '1.5.6',\n  prettier: '1.3.0',\n  tsconfig: '1.6.1',\n  webpack: '1.6.32',\n  runner: '1.5.17',\n  lambdaServerRuntime: '1.0.6',\n};\n\nexport const ESLINT_VERSION = '8.56.x';\nexport const PRETTIER_VERSION = '3.1.x';\nexport const TYPESCRIPT_VERSION = '5.3.x';\n\nexport const LIB_VERSIONS = {\n  '@types/react': '18.2.x',\n  '@types/react-dom': '18.2.x',\n  react: '18.2.x',\n  'react-dom': '18.2.x',\n  'styled-components': '6.1.x',\n};\n","import {ProjectType, WorkspaceName} from '@src/models';\nimport {WorkspaceProject} from '@src/project/generate_workspace';\nimport {generateCloudfrontDistributionTerraform} from '@src/project/terraform/cloudfront';\nimport {generateLambdaTerraform} from '@src/project/terraform/lambda';\nimport {generateAwsProviderTerraform} from '@src/project/terraform/provider';\nimport {generateS3BucketTerraform} from '@src/project/terraform/s3';\nimport {neverHappens} from '@src/type_utils';\n\nexport function generateCommonTerraform(\n  workspaceName: WorkspaceName,\n  projects: WorkspaceProject[]\n): string {\n  return [\n    generateAwsProviderTerraform(workspaceName),\n    generateS3BucketTerraform(\n      workspaceName,\n      projects.filter(p => p.type === ProjectType.Web).map(p => p.projectName)\n    ),\n  ].join('\\n\\n');\n}\n\nexport function generateWorkspaceProjectTerraform(\n  workspaceName: WorkspaceName,\n  project: WorkspaceProject\n): string | undefined {\n  const {projectName, type, fromFragment} = project;\n  const cloudwatchTriggerMinutes =\n    'cloudwatchTriggerMinutes' in fromFragment ? fromFragment.cloudwatchTriggerMinutes : undefined;\n  const alarmEmail = 'alarmEmail' in fromFragment ? fromFragment.alarmEmail : undefined;\n  if (type === ProjectType.Web) {\n    return generateCloudfrontDistributionTerraform(workspaceName, projectName);\n  } else if (type === ProjectType.LambdaFunction) {\n    return generateLambdaTerraform(workspaceName, projectName, {\n      api: false,\n      web: false,\n      alarmEmail,\n      cloudwatchTriggerMinutes,\n    });\n  } else if (type === ProjectType.LambdaApi) {\n    return generateLambdaTerraform(workspaceName, projectName, {\n      api: true,\n      web: false,\n      alarmEmail,\n      cloudwatchTriggerMinutes,\n    });\n  } else if (type === ProjectType.LambdaWebApi) {\n    return generateLambdaTerraform(workspaceName, projectName, {\n      api: true,\n      web: true,\n      alarmEmail,\n      cloudwatchTriggerMinutes,\n    });\n  } else if (type === ProjectType.NodeScript) {\n    return undefined;\n  } else if (type === ProjectType.SharedNode) {\n    return undefined;\n  } else if (type === ProjectType.SharedWeb) {\n    return undefined;\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  } else if (type === ProjectType.Shared) {\n    return undefined;\n  }\n  neverHappens(type, 'ProjectType');\n}\n\nexport function generateDummyTerraformCredentials(): string {\n  return `\n[default]\naws_access_key_id=\naws_secret_access_key=\n`.trim();\n}\n","import {ProjectName, WorkspaceName} from '@src/models';\n\nexport function generateCloudfrontDistributionTerraform(\n  workspaceName: WorkspaceName,\n  projectName: ProjectName\n): string {\n  const bucketName = projectName.toLowerCase().replace(/[^\\d.a-z-]+/gu, '-');\n  const originId = `${bucketName}-origin-id`;\n  return `\noutput \"${projectName}_cloudfront_domain_name\" {\n  value       = aws_cloudfront_distribution.${projectName}.domain_name\n  description = \"Domain (from cloudfront) where the \\\\\"${workspaceName}-${projectName}\\\\\" frontend is available.\"\n}\n  \nresource \"aws_cloudfront_distribution\" \"${projectName}\" {\n  origin {\n    domain_name = aws_s3_bucket.code.bucket_regional_domain_name\n    origin_id   = \"${originId}\"\n    origin_path = \"/${projectName}\"\n\n    s3_origin_config {\n      origin_access_identity = aws_cloudfront_origin_access_identity.${projectName}.cloudfront_access_identity_path\n    }\n  }\n  \n  enabled             = true\n  wait_for_deployment = false\n  is_ipv6_enabled     = true\n  price_class         = \"PriceClass_100\"\n  \n  default_root_object   = \"/index.html\"\n  custom_error_response {\n    error_code         = 400\n    response_code      = 200\n    response_page_path = \"/index.html\"\n  }\n  custom_error_response {\n    error_code         = 403\n    response_code      = 200\n    response_page_path = \"/index.html\"\n  }\n  custom_error_response {\n    error_code         = 404\n    response_code      = 200\n    response_page_path = \"/index.html\"\n  }\n\n  default_cache_behavior {\n    allowed_methods  = [\"HEAD\", \"GET\"]\n    cached_methods   = [\"HEAD\", \"GET\"]\n    compress         = true\n    target_origin_id = \"${originId}\"\n    viewer_protocol_policy = \"redirect-to-https\"\n    \n    forwarded_values {\n      query_string = false\n      cookies {\n        forward = \"none\"\n      }\n    }\n  }\n\n  restrictions {\n    geo_restriction {\n      restriction_type = \"none\"\n    }\n  }\n\n  viewer_certificate {\n    cloudfront_default_certificate = true\n  }\n}\n\nresource \"aws_cloudfront_origin_access_identity\" \"${projectName}\" {}\n  `.trim();\n}\n","import {ProjectName, WorkspaceName} from '@src/models';\nimport {lowerCase} from '@src/string_utils';\n\nexport function generateLambdaTerraform(\n  workspaceName: WorkspaceName,\n  projectName: ProjectName,\n  opts: {\n    api: boolean;\n    web: boolean;\n    alarmEmail: string | undefined;\n    cloudwatchTriggerMinutes: number | undefined;\n  }\n): string {\n  const {api, web, alarmEmail, cloudwatchTriggerMinutes} = opts;\n  const prefixLower = lowerCase(workspaceName);\n  return `\n# Define any extra role for the lambda here\ndata \"aws_iam_policy_document\" \"${projectName}_extra_policy\" {\n  statement {\n    actions   = [\n      \"dynamodb:GetItem\",\n      \"dynamodb:BatchGetItem\",\n      \"dynamodb:Query\",\n      \"dynamodb:Scan\",\n      \"dynamodb:PutItem\",\n      \"dynamodb:UpdateItem\",\n      \"dynamodb:DeleteItem\",\n    ]\n    resources = [\n      \"\\${aws_dynamodb_table.${prefixLower}_user_table.arn}\",\n      \"\\${aws_dynamodb_table.${prefixLower}_user_table.arn}/index/*\",\n      \"\\${aws_dynamodb_table.${prefixLower}_user_session_table.arn}\",\n      \"\\${aws_dynamodb_table.${prefixLower}_user_session_table.arn}/index/*\",\n    ]\n  }${\n    web\n      ? `\n  statement {\n    actions   = [\n      \"s3:GetObject\",\n      \"s3:GetObjectTagging\"\n    ]\n    resources = [\n      \"\\${aws_s3_bucket.code.arn}/*\"\n    ]\n  }`\n      : ''\n  }\n}\n\nresource \"aws_lambda_function\" \"${projectName}\" {\n  function_name     = \"${workspaceName}-${projectName}\"\n  s3_bucket         = aws_s3_object.${projectName}_archive.bucket\n  s3_key            = aws_s3_object.${projectName}_archive.key\n  handler           = \"index.handler\"\n  runtime           = \"nodejs20.x\"\n  role              = aws_iam_role.${projectName}_role.arn\n  timeout           = 900 // 15 minutes\n  memory_size       = 128 // Mo\n  environment {\n    variables = {\n      NODE_OPTIONS = \"--enable-source-maps\"\n    }\n  }\n}\n\noutput \"${projectName}_function_name\" {\n  value       = aws_lambda_function.${projectName}.function_name\n  description = \"Function name of the \\\\\"${workspaceName}-${projectName}\\\\\" lambda\"\n}\n${\n  api\n    ? `\n# Lambda URL\n\nresource \"aws_lambda_function_url\" \"${projectName}\" {\n  function_name      = aws_lambda_function.${projectName}.function_name\n  authorization_type = \"NONE\"\n}\n\noutput \"${projectName}_function_url\" {\n  value       = aws_lambda_function_url.${projectName}.function_url\n  description = \"Function url of the \\\\\"${workspaceName}-${projectName}\\\\\" lambda\"\n}`\n    : ''\n}\n${\n  cloudwatchTriggerMinutes !== undefined\n    ? `\n# Cloudwatch trigger\n\nresource \"aws_lambda_permission\" \"cloudwatch_invoke_${projectName}\" {\n  statement_id  = \"AllowExecutionFromCloudWatch\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.${projectName}.arn\n  principal     = \"events.amazonaws.com\"\n  source_arn    = aws_cloudwatch_event_rule.${projectName}_trigger_rate.arn\n}\n\nresource \"aws_cloudwatch_event_rule\" \"${projectName}_trigger_rate\" {\n  name_prefix         = \"${projectName}.rate-${cloudwatchTriggerMinutes}-minutes.\"\n  schedule_expression = \"rate(${cloudwatchTriggerMinutes} minute${\n    cloudwatchTriggerMinutes > 1 ? 's' : ''\n  })\"\n}\n\nresource \"aws_cloudwatch_event_target\" \"${projectName}_trigger_target\" {\n  rule  = aws_cloudwatch_event_rule.${projectName}_trigger_rate.name\n  arn   = aws_lambda_function.${projectName}.arn\n}`\n    : ''\n}\n# IAM role\n\nresource \"aws_iam_role\" \"${projectName}_role\" {\n  name = \"${workspaceName}-${projectName}-role\"\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [\n      {\n        Action    = \"sts:AssumeRole\"\n        Principal = {\n          Service = \"lambda.amazonaws.com\"\n        }\n        Effect    = \"Allow\"\n      },\n    ]\n  })\n  \n  inline_policy {\n    name = \"${workspaceName}-${projectName}-extra-policy\"\n    policy = data.aws_iam_policy_document.${projectName}_extra_policy.json\n  }\n}\n\n# Cloudwatch logging\n\nresource \"aws_cloudwatch_log_group\" \"${projectName}\" {\n  name = \"/aws/lambda/${workspaceName}-${projectName}\"\n}\n\nresource \"aws_iam_policy\" \"${projectName}_cloudwatch\" {\n  name = \"${workspaceName}-${projectName}-cloudwatch-policy\"\n  policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [\n      {\n        Action   = [\n          \"logs:CreateLogGroup\",\n          \"logs:CreateLogStream\",\n          \"logs:PutLogEvents\",\n        ]\n        Effect   = \"Allow\"\n        Resource = [\n          \"\\${aws_cloudwatch_log_group.${projectName}.arn}\",\n        ]\n      }\n    ]\n  })\n}\n\nresource \"aws_iam_role_policy_attachment\" \"${projectName}_cloudwatch\" {\n  role       = aws_iam_role.${projectName}_role.name\n  policy_arn = aws_iam_policy.${projectName}_cloudwatch.arn\n}\n${\n  alarmEmail !== undefined\n    ? `\n# Cloudwatch error monitoring\n\nresource \"aws_cloudwatch_log_metric_filter\" \"${projectName}_log_errors\" {\n  name           = \"${workspaceName}-${projectName}-log-error-metric-filter\"\n  pattern        = \"{ $.level = \\\\\"ERROR\\\\\" }\"\n  log_group_name = aws_cloudwatch_log_group.${projectName}.name\n\n  metric_transformation {\n    name      = \"${workspaceName}-${projectName}-errors\"\n    namespace = \"${workspaceName}\"\n    value     = \"1\"\n    default_value = \"0\"\n    unit      = \"Count\"\n  }\n}\n\nresource \"aws_cloudwatch_metric_alarm\" \"${projectName}_log_errors\" {\n  alarm_name          = \"${workspaceName}-${projectName}-log-error-metric-alarm\"\n  metric_name         = aws_cloudwatch_log_metric_filter.${projectName}_log_errors.metric_transformation[0].name\n  namespace           = aws_cloudwatch_log_metric_filter.${projectName}_log_errors.metric_transformation[0].namespace\n  \n  evaluation_periods  = 1\n  period              = 3600\n  statistic           = \"Sum\"\n  comparison_operator = \"GreaterThanOrEqualToThreshold\"\n  threshold           = 1\n  actions_enabled     = true\n  alarm_actions       = [aws_sns_topic.${projectName}_log_errors.arn]\n  # ok_actions          = [aws_sns_topic.sns.arn]\n}\n\nresource \"aws_sns_topic\" \"${projectName}_log_errors\" {\n  name = \"${workspaceName}-${projectName}-log-error-sns-topic\"\n}\n\nresource \"aws_sns_topic_subscription\" \"${projectName}_log_errors\" {\n  endpoint = \"${alarmEmail}\"\n  protocol = \"email\"\n  topic_arn = aws_sns_topic.${projectName}_log_errors.arn\n}`.trim()\n    : ''\n}\n# Dummy source code useful only during the initial setup\nresource \"aws_s3_object\" \"${projectName}_archive\" {\n  bucket       = aws_s3_bucket.code.id\n  key          = \"${projectName}/dist.zip\"\n  content_base64 = \"UEsDBBQACAAIAGaKwlYAAAAAAAAAADYAAAAIACAAaW5kZXguanNVVA0AB3AIemRyCHpkcAh6ZHV4CwABBPUBAAAEFAAAAEutKMgvKinWy0jMS8lJLVKwVUgsrsxLVkgrzUsuyczPU9DQVKjmUlAoSi0pLcpTUFe35qq15gIAUEsHCP0ak1o4AAAANgAAAFBLAQIUAxQACAAIAGaKwlb9GpNaOAAAADYAAAAIACAAAAAAAAAAAACkgQAAAABpbmRleC5qc1VUDQAHcAh6ZHIIemRwCHpkdXgLAAEE9QEAAAQUAAAAUEsFBgAAAAABAAEAVgAAAI4AAAAAAA==\"\n}\n\n`.trim();\n}\n","import {WorkspaceName} from '@src/models';\n\nexport function generateAwsProviderTerraform(workspaceName: WorkspaceName): string {\n  return `\nterraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.1\"\n    }\n  }\n}\n\nprovider \"aws\" {\n  region  = \"eu-west-3\"\n  shared_credentials_files = [\"./.aws-credentials\"]\n  default_tags {\n    tags = {\n      Project = \"${workspaceName}\"\n    }\n  }\n}\n\ndata \"aws_region\" \"current\" {}\noutput \"region\" {\n  value = data.aws_region.current.id\n}\n`.trim();\n}\n","import {ProjectName, WorkspaceName} from '@src/models';\n\nexport function generateS3BucketTerraform(\n  workspaceName: WorkspaceName,\n  webProjectNames: ProjectName[]\n): string {\n  const bucketName = workspaceName.toLowerCase().replace(/[^a-z0-9.-]+/gu, '-');\n\n  const CODE_BUCKET = `\nresource \"aws_s3_bucket\" \"code\" {\n  bucket_prefix = \"${bucketName}-code-\"\n}\n\noutput \"code_bucket\" {\n  value = aws_s3_bucket.code.id\n}\n`.trim();\n\n  const CLOUDFRONT_ACCESS = `\ndata \"aws_iam_policy_document\" \"cloudfront_access_to_code\" {\n  ${webProjectNames\n    .map(p =>\n      `\n  statement {\n    actions   = [\"s3:GetObject\"]\n    resources = [\n      \"\\${aws_s3_bucket.code.arn}/${p}/*\",\n    ]\n    principals {\n      type        = \"AWS\"\n      identifiers = [aws_cloudfront_origin_access_identity.${p}.iam_arn]\n    }\n  }\n`.trim()\n    )\n    .join('\\n\\n')}\n}\n\nresource \"aws_s3_bucket_policy\" \"code\" {\n  bucket = aws_s3_bucket.code.id\n  policy = data.aws_iam_policy_document.cloudfront_access_to_code.json\n}\n`.trim();\n\n  const out = [CODE_BUCKET];\n  if (webProjectNames.length > 0) {\n    out.push(CLOUDFRONT_ACCESS);\n  }\n  return out.join('\\n\\n');\n}\n","function notUndefined<T>(val: T | undefined): val is T {\n  return val !== undefined;\n}\n\nexport function isString(val: unknown): val is string {\n  return typeof val === 'string';\n}\n\nexport function isNumber(val: unknown): val is number {\n  return typeof val === 'number';\n}\n\nexport function iterNumberEnum<T extends Record<string, string | number>>(e: T): T[keyof T][] {\n  return Object.values(e).filter(isNumber) as unknown as T[keyof T][];\n}\n\nexport function iterStringEnum<T extends Record<string, string>>(e: T): T[keyof T][] {\n  return Object.values(e).filter(isString) as unknown as T[keyof T][];\n}\n\nexport function removeUndefined<T>(arr: (T | undefined)[]): T[] {\n  return arr.filter(notUndefined);\n}\n\nexport function removeUndefinedOrNullProps<T extends Record<string, unknown>>(obj: T): {} {\n  return Object.fromEntries(\n    // eslint-disable-next-line no-null/no-null\n    Object.entries(obj).filter(e => e[1] !== undefined && e[1] !== null)\n  ) as T;\n}\n\nexport function neverHappens(value: never, errorMessage?: string): never {\n  throw new Error(errorMessage);\n}\n\nexport function asMap(value: unknown): Record<string, unknown> | undefined;\nexport function asMap(\n  value: unknown,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asMap(\n  value: unknown,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null\n    ? (value as Record<string, unknown>)\n    : defaultValue;\n}\nexport function asMapOrThrow(value: unknown): Record<string, unknown> {\n  const valueAsMap = asMap(value);\n  if (valueAsMap === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a map`);\n  }\n  return valueAsMap;\n}\n\nexport function asJson(value: string): Record<string, unknown> | undefined;\nexport function asJson(\n  value: string,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asJson(\n  value: string,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  try {\n    const json = JSON.parse(value);\n    const res = asMap(json);\n    return res ?? defaultValue;\n  } catch {\n    return defaultValue;\n  }\n}\nexport function asJsonOrThrow(value: string): Record<string, unknown> {\n  const valueAsJson = asJson(value);\n  if (valueAsJson === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a valid JSON string of a map`);\n  }\n  return valueAsJson;\n}\n\nexport function asJsonString(value: unknown): Record<string, unknown> | undefined;\nexport function asJsonString(\n  value: unknown,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asJsonString(\n  value: unknown,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  const str = asString(value);\n  return str === undefined\n    ? defaultValue\n    : defaultValue === undefined\n      ? asJson(str)\n      : asJson(str, defaultValue);\n}\nexport function asJsonStringOrThrow(value: unknown): Record<string, unknown> {\n  return asJsonOrThrow(asStringOrThrow(value));\n}\n\nexport function asString<T extends string = string>(value: unknown): T | undefined;\nexport function asString<T extends string = string>(value: unknown, defaultValue: string): T;\nexport function asString<T extends string = string>(\n  value: unknown,\n  defaultValue?: string\n): T | undefined {\n  return (typeof value === 'string' ? value : defaultValue) as T;\n}\nexport function asStringOrThrow<T extends string = string>(value: unknown): T {\n  const valueAsString = asString<T>(value);\n  if (valueAsString === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a string`);\n  }\n  return valueAsString;\n}\n\nexport function asArray<T = unknown>(value: unknown): T[] | undefined;\nexport function asArray<T = unknown>(value: unknown, defaultValue: unknown[]): T[];\nexport function asArray<T = unknown>(value: unknown, defaultValue?: unknown[]): T[] | undefined {\n  return (Array.isArray(value) ? value : defaultValue) as T[];\n}\nexport function asArrayOrThrow<T = unknown>(value: unknown): T[] {\n  if (!Array.isArray(value)) {\n    throw new Error(`Invalid value: \\`${value}\\` is not an array`);\n  }\n  return value as T[];\n}\n\nexport function asStringArray<T extends string = string>(value: unknown): T[] | undefined;\nexport function asStringArray<T extends string = string>(\n  value: unknown,\n  defaultValue: string[]\n): T[];\nexport function asStringArray<T extends string = string>(\n  value: unknown,\n  defaultValue?: string[]\n): T[] | undefined {\n  const arr = asArray(value);\n  if (arr === undefined) {\n    return defaultValue as T[];\n  }\n  return removeUndefined(arr.map(s => asString<T>(s)));\n}\n\nexport function asStringArrayOrThrow<T extends string = string>(value: unknown): T[] {\n  const arr = asArrayOrThrow(value);\n  return arr.map(s => asStringOrThrow<T>(s));\n}\n\nexport function asMapArray(value: unknown): Record<string, unknown>[] | undefined;\nexport function asMapArray(\n  value: unknown,\n  defaultValue: Record<string, unknown>[]\n): Record<string, unknown>[];\nexport function asMapArray(\n  value: unknown,\n  defaultValue?: Record<string, unknown>[]\n): Record<string, unknown>[] | undefined {\n  const arr = asArray(value);\n  if (arr === undefined) {\n    return defaultValue;\n  }\n  return removeUndefined(arr.map(s => asMap(s)));\n}\nexport function asMapArrayOrThrow(value: unknown): Record<string, unknown>[] {\n  const arr = asArrayOrThrow(value);\n  return arr.map(s => asMapOrThrow(s));\n}\n\nexport function asNumber<T extends number = number>(value: unknown): T | undefined;\nexport function asNumber<T extends number = number>(value: unknown, defaultValue: number): T;\nexport function asNumber<T extends number = number>(\n  value: unknown,\n  defaultValue?: number\n): T | undefined {\n  if (typeof value === 'number') {\n    return (!isNaN(value) ? value : defaultValue) as T;\n  }\n  if (typeof value === 'string') {\n    try {\n      const parsedValue = parseFloat(value);\n      return (!isNaN(parsedValue) ? parsedValue : defaultValue) as T;\n    } catch {\n      return defaultValue as T;\n    }\n  }\n  return defaultValue as T;\n}\nexport function asNumberOrThrow<T extends number = number>(value: unknown): T {\n  const valueAsNumber = asNumber(value);\n  if (valueAsNumber === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a number`);\n  }\n  return valueAsNumber as T;\n}\n\nexport function asBoolean(value: unknown): boolean | undefined;\nexport function asBoolean(value: unknown, defaultValue: boolean): boolean;\nexport function asBoolean(value: unknown, defaultValue?: boolean): boolean | undefined {\n  if (typeof value === 'boolean') {\n    return value;\n  }\n  if (typeof value === 'number') {\n    return !isNaN(value) ? value !== 0 : false;\n  }\n  if (typeof value === 'string') {\n    if (value === '0' || value === 'false') {\n      return false;\n    } else if (value === '1' || value === 'true') {\n      return true;\n    }\n    return defaultValue;\n  }\n  return defaultValue;\n}\n\nexport function asBooleanOrThrow(value: unknown): boolean {\n  const valueAsBoolean = asBoolean(value);\n  if (valueAsBoolean === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a boolean`);\n  }\n  return valueAsBoolean;\n}\n\nconst TIMESTAMP_REGEX = /^[0-9]{1,15}$/u;\nexport function asDate(value: unknown): Date | undefined;\nexport function asDate(value: unknown, defaultValue: Date): Date;\nexport function asDate(value: unknown, defaultValue?: Date): Date | undefined {\n  const date =\n    value instanceof Date\n      ? value\n      : new Date(\n          typeof value === 'string' && TIMESTAMP_REGEX.test(value)\n            ? parseFloat(value)\n            : String(value)\n        );\n  return isNaN(date.getTime()) ? defaultValue : date;\n}\n\nexport function asDateOrThrow(value: unknown): Date {\n  const valueAsDate = asDate(value);\n  if (valueAsDate === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` cannot be parsed as a Date`);\n  }\n  return valueAsDate;\n}\n\n// export function asDate(value: unknown): Date | undefined;\n// export function asDate(value: unknown, defaultValue: Date): Date;\n// export function asDate(value: unknown, defaultValue?: Date): Date | undefined {\n//   if (typeof value === 'number') {\n//     return new Date(value);\n//   }\n//   return value instanceof Date ? value : defaultValue;\n// }\n\nexport function isNull<T>(val: T | null): val is null {\n  // eslint-disable-next-line no-null/no-null\n  return val === null;\n}\n\nexport function asError(err: unknown): Error {\n  return err instanceof Error ? err : new Error(typeof err === 'string' ? err : String(err));\n}\n\nexport function errorAsString(err: unknown): string {\n  const errorMap = asMap(err);\n  if (errorMap === undefined) {\n    return asString(err) ?? String(err);\n  }\n\n  const errorMessage = asString(errorMap['message']);\n  if (errorMessage === undefined) {\n    return String(err);\n  }\n  return errorMessage;\n}\n\nexport function errorAndStackAsString(err: unknown): string {\n  const errorMap = asMap(err);\n  if (errorMap === undefined) {\n    return asString(err) ?? String(err);\n  }\n\n  const stack = asString(errorMap['stack']);\n  if (stack === undefined) {\n    return String(err);\n  }\n  return stack;\n}\n\nexport function asConstantOrThrow<T>(value: unknown, expected: T): T {\n  if (value !== expected) {\n    throw new Error(`Invalid value: \\`${value}\\`, expected \\`${expected}\\``);\n  }\n  return value as T;\n}\n\n// export function asParsedJson<T>(json: string): T {\n//   try {\n//     return JSON.parse(json) as T;\n//   } catch {\n//     const defaultValue = {};\n//     return defaultValue as T;\n//   }\n// }\nexport function parseJson(\n  json: string\n): {res: unknown; err: undefined} | {res: undefined; err: unknown} {\n  try {\n    return {res: JSON.parse(json), err: undefined};\n  } catch (err: unknown) {\n    return {err, res: undefined};\n  }\n}\nexport type Brand<Type, Name> = Type & {__brand: Name};\nexport type StringBrand = string & {__brand: string};\nexport type NumberBrand = number & {__brand: number};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type AnyBrand = (string | number) & {__brand: any};\n\nexport type Untrusted<T> = T extends\n  | Function\n  | Date\n  | boolean\n  | number\n  | string\n  | undefined\n  | null\n  | unknown[]\n  ? unknown\n  : {[P in keyof T]?: Untrusted<T[P]>};\n\nexport type DeepPartial<T> = T extends\n  | Function\n  | Date\n  | boolean\n  | number\n  | string\n  | undefined\n  | null\n  | unknown[]\n  ? T\n  : {[P in keyof T]?: DeepPartial<T[P]>};\n\nexport type MapInterface<I, Type> = {[Key in keyof I]: Type};\n// Get all the keys of a type including the optional attributes\ntype NonHomomorphicKeys<T> = ({[P in keyof T]: P} & None)[keyof T];\nexport type MapInterfaceStrict<I, Type> = {[Key in NonHomomorphicKeys<I>]: Type};\n\ntype KeysOfType<T, Type> = {[Key in keyof T]: T[Key] extends Type ? Key : never}[keyof T];\nexport type RestrictInterface<T, Type> = Pick<T, KeysOfType<T, Type>>;\n\ninterface RecursiveArray<T> extends Array<T | RecursiveArray<T>> {}\nexport type NestedArray<T> = (T | RecursiveArray<T>)[];\n\n// Type for an empty object (ie: {})\nexport type None = Record<string, never>;\n\nexport type NonEmptyArray<T> = [T, ...T[]];\n\nexport type AddPrefix<T, P extends string> = {\n  [K in keyof T as K extends string ? `${P}${K}` : never]: T[K];\n};\nexport function addPrefix<T extends Record<string, unknown>, Prefix extends string>(\n  attr: T,\n  prefix: Prefix\n): AddPrefix<T, Prefix> {\n  return Object.fromEntries(\n    Object.entries(attr).map(([key, value]) => [`${prefix}${key}`, value])\n  ) as AddPrefix<T, Prefix>;\n}\n\nexport type WithNull<T> = {\n  [Key in keyof T]: T[Key] extends Exclude<T[Key], undefined> ? T[Key] : T[Key] | null;\n};\ntype Id<T> = T;\nexport type Flatten<T> = Id<{[k in keyof T]: T[k]}>;\n\nexport type Defined<T> = Exclude<T, undefined>;\n","import {WorkspaceName} from '@src/models';\nimport {lowerCase, pascalCase} from '@src/string_utils';\n\nexport function generateDynamoUserTerraform(workspaceName: WorkspaceName): string {\n  const prefixLower = lowerCase(workspaceName);\n  const prefixPascal = pascalCase(workspaceName);\n  return `output \"${prefixLower}_user_table_name\" {\n    value       = aws_dynamodb_table.${prefixLower}_user_table.name\n  }\n  \n  output \"${prefixLower}_user_index_name\" {\n    value = {\n      for obj in aws_dynamodb_table.${prefixLower}_user_table.global_secondary_index : \"\\${aws_dynamodb_table.${prefixLower}_user_table.name }_By_\\${obj.hash_key}\\${ length(obj.range_key) > 0 ? \"_Sorted_By_\\${obj.range_key}\" : \"\" }\" => obj.name\n    }\n  }\n  \n  resource \"aws_dynamodb_table\" \"${prefixLower}_user_table\" {\n    name           = \"${prefixPascal}User\"\n    billing_mode   = \"PAY_PER_REQUEST\"\n    hash_key       = \"id\"\n  \n    attribute {\n      name = \"id\"\n      type = \"S\"\n    }\n  }`.trim();\n}\n","import {WorkspaceName} from '@src/models';\nimport {lowerCase, pascalCase} from '@src/string_utils';\n\nexport function generateDynamoUserSessionTerraform(workspaceName: WorkspaceName): string {\n  const prefixLower = lowerCase(workspaceName);\n  const prefixPascal = pascalCase(workspaceName);\n  return `output \"${prefixLower}_user_session_table_name\" {\n  value       = aws_dynamodb_table.${prefixLower}_user_session_table.name\n}\n\noutput \"${prefixLower}_user_session_index_name\" {\n  value = {\n    for obj in aws_dynamodb_table.${prefixLower}_user_session_table.global_secondary_index : \"\\${aws_dynamodb_table.${prefixLower}_user_session_table.name }_By_\\${obj.hash_key}\\${ length(obj.range_key) > 0 ? \"_Sorted_By_\\${obj.range_key}\" : \"\" }\" => obj.name\n  }\n}\n\nresource \"aws_dynamodb_table\" \"${prefixLower}_user_session_table\" {\n  name           = \"${prefixPascal}UserSession\"\n  billing_mode   = \"PAY_PER_REQUEST\"\n  hash_key       = \"token\"\n\n  attribute {\n    name = \"token\"\n    type = \"S\"\n  }\n\n  ttl {\n    attribute_name = \"expiresAt\"\n    enabled = true\n  }\n\n}`.trim();\n}\n","import {join} from 'node:path';\n\nimport {maybeReadFile, prettyJson, writeRawFile} from '@src/fs';\nimport {WorkspaceFragment} from '@src/models';\nimport {getProjectsFromWorkspaceFragment} from '@src/project/generate_workspace';\nimport {asMap} from '@src/type_utils';\n\nexport function generateCodeWorkspace(\n  workspaceName: string,\n  workspaceFragments: WorkspaceFragment[]\n): Record<string, unknown> {\n  const projects = workspaceFragments.flatMap(f =>\n    getProjectsFromWorkspaceFragment(f, workspaceFragments)\n  );\n  const projectNames = projects.map(p => p.projectName);\n  return {\n    folders: [\n      ...projectNames.map(p => ({path: p})),\n      {path: 'terraform'},\n      {path: '.', name: 'root'},\n    ],\n    settings: {\n      'window.title': `${workspaceName}\\${separator}\\${activeEditorShort}`,\n      'files.exclude': Object.fromEntries([\n        ...projectNames.map(p => [p, true]),\n        ['terraform', true],\n      ]),\n      'editor.acceptSuggestionOnCommitCharacter': false,\n      'editor.suggestSelection': 'first',\n      'vsintellicode.modify.editor.suggestSelection': 'automaticallyOverrodeDefaultValue',\n      'explorer.confirmDelete': false,\n      'git.autofetch': true,\n      'git.confirmSync': false,\n      'typescript.preferences.importModuleSpecifier': 'non-relative',\n      'eslint.lintTask.enable': true,\n      'eslint.useESLintClass': true,\n      'eslint.options': {\n        reportUnusedDisableDirectives: 'warn',\n      },\n      'editor.formatOnSave': true,\n      'editor.codeActionsOnSave': {\n        'source.fixAll': 'never',\n        'source.fixAll.eslint': 'explicit',\n      },\n      'editor.defaultFormatter': 'esbenp.prettier-vscode',\n      'editor.linkedEditing': true,\n      'emmet.showExpandedAbbreviation': 'never',\n      'files.associations': {\n        '*.tf': 'terraform',\n      },\n    },\n    extensions: {\n      recommendations: [\n        'dbaeumer.vscode-eslint',\n        'esbenp.prettier-vscode',\n        'VisualStudioExptTeam.vscodeintellicode',\n        'styled-components.vscode-styled-components',\n        'naumovs.color-highlight',\n        'eamodio.gitlens',\n      ],\n    },\n  };\n}\n\nexport interface FileHash {\n  path: string;\n  hash: string;\n}\nexport interface Workspace {\n  fragments: WorkspaceFragment[];\n  version: string;\n  files: FileHash[];\n}\n\nexport async function readWorkspace(workspacePath: string): Promise<Workspace | undefined> {\n  const workspaceContent = await maybeReadFile(join(workspacePath, '.workspace'));\n  if (workspaceContent === undefined) {\n    return undefined;\n  }\n  const workspaceData = asMap(JSON.parse(workspaceContent), {});\n  const {fragments = [], version = '', files = []} = workspaceData;\n  return {fragments, version, files} as Workspace;\n}\n\nexport async function writeWorkspace(workspacePath: string, workspace: Workspace): Promise<void> {\n  workspace.files.sort((f1, f2) => f1.path.localeCompare(f2.path));\n  await writeRawFile(join(workspacePath, '.workspace'), await prettyJson(workspace));\n}\n","import {createHash} from 'node:crypto';\nimport {mkdir, readdir, readFile, rm, stat} from 'node:fs/promises';\nimport {join, resolve} from 'node:path';\n\nimport {exists, rmDir} from '@src/fs';\nimport {log} from '@src/logger';\n\nexport interface WebpackConfigFragment {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  config: () => any;\n  dependencies: Record<string, string>;\n}\n\nexport function isProd(): boolean {\n  return process.env['NODE_ENV'] === 'production'; // eslint-disable-line node/no-process-env\n}\n\nexport function isSelenium(): boolean {\n  return process.env['IS_SELENIUM'] === '1'; // eslint-disable-line node/no-process-env\n}\n\nexport function getEnv(): 'production' | 'development' {\n  return isProd() ? 'production' : 'development';\n}\n\nconst packageJsonCache = new Map<string, Record<string, unknown> | undefined>();\n\nexport async function findPackageJson(p: string): Promise<Record<string, unknown> | undefined> {\n  if (packageJsonCache.has(p)) {\n    return packageJsonCache.get(p);\n  }\n  try {\n    const pStat = await stat(p);\n    if (pStat.isDirectory()) {\n      const dir = await readdir(p);\n      if (dir.includes('package.json')) {\n        const fileContent = await readFile(join(p, 'package.json'));\n        const json = JSON.parse(fileContent.toString()) as Record<string, unknown>;\n        packageJsonCache.set(p, json);\n        return json;\n      }\n      if (p === '/') {\n        return undefined;\n      }\n    }\n    const res = await findPackageJson(resolve(`${p}/..`));\n    packageJsonCache.set(p, res);\n    return res;\n  } catch (err: unknown) {\n    log('findPackageJson');\n    log(err);\n    packageJsonCache.set(p, undefined);\n    return undefined;\n  }\n}\n\nexport function getPort(context: string): number {\n  // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n  const hexHash = createHash('md5').update(context).digest('hex').slice(0, 4);\n  const port = 1024 + Math.floor(parseInt(hexHash, 16) / 2);\n  return port;\n}\n\nexport async function initLogFile(context: string, logFileName: string): Promise<string> {\n  // Find the root of the project and create the log dir there\n  try {\n    const root = await lookupRoot(context);\n    const logDir = join(root, 'log');\n    await rmDir(logDir);\n    await mkdir(logDir, {recursive: true});\n    const logFile = join(logDir, logFileName);\n    if (await exists(logFile)) {\n      await rm(logFile);\n    }\n    return logFile;\n  } catch {\n    throw new Error(`Failure to identify project root from ${context}`);\n  }\n}\n\nasync function lookupRoot(fromPath: string): Promise<string> {\n  if (await exists(join(fromPath, 'package.json'))) {\n    return fromPath;\n  }\n  const parent = join(fromPath, '..');\n  if (parent === fromPath) {\n    throw new Error('Failure to lookup root');\n  }\n  return lookupRoot(parent);\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:fs/promises\");","import {execSync} from 'node:child_process';\nimport {join} from 'node:path';\n\nimport {writeTsFile} from '@src/fs';\nimport {removeUndefined} from '@src/type_utils';\nimport {getEnv} from '@src/webpack/utils';\n\nexport async function generateEnvFile(overrides: Record<string, string>): Promise<void> {\n  const terraformPath = join(process.cwd(), 'terraform');\n  const res: Record<string, {type: unknown; value: unknown; sensitive: boolean}> = JSON.parse(\n    execSync(`terraform output -json`, {cwd: terraformPath}).toString()\n  );\n\n  const outputsEntries = removeUndefined(\n    Object.entries(res).map(([key, value]) => {\n      if (value.sensitive) {\n        return undefined;\n      }\n      if (\n        Array.isArray(value.type) &&\n        value.type[0] === 'object' &&\n        typeof value.value === 'object' &&\n        value.value !== null // eslint-disable-line no-null/no-null\n      ) {\n        return [\n          key.toUpperCase(),\n          Object.fromEntries(Object.entries(value.value).map(([k, v]) => [k.toUpperCase(), v])),\n        ];\n      }\n      if (value.type === 'string' && typeof value.value === 'string') {\n        return [key.toUpperCase(), value.value];\n      }\n      return undefined;\n    })\n  );\n  const envConstants: Record<string, unknown> = {\n    REGION: 'RUN_TERRAFORM_APPLY',\n    CODE_BUCKET: 'RUN_TERRAFORM_APPLY',\n    ...Object.fromEntries(outputsEntries),\n    ...overrides,\n    NODE_ENV: getEnv(),\n  };\n\n  await writeTsFile(\n    join(process.cwd(), 'shared', 'src', 'env.ts'),\n    Object.entries(envConstants)\n      .map(\n        ([key, value]) =>\n          `export const ${key} = ${JSON.stringify(value)}${\n            typeof value === 'string' ? ' as string' : ''\n          };`\n      )\n      .join('\\n')\n  );\n}\n","import {DetailedError, GlobalError, ParsedError} from '@src/webpack-runner/error_parser';\n\nexport interface GroupedErrors {\n  errorsByProjectByFile: Map<string, Map<string, DetailedError[]>>;\n  globalErrors: GlobalError[];\n}\n\nexport function groupAndSortErrors(errors: ParsedError[]): GroupedErrors {\n  const errorsByProjectByFile = new Map<string, Map<string, DetailedError[]>>();\n  const globalErrors: GlobalError[] = [];\n  for (const err of errors) {\n    if (!('type' in err)) {\n      globalErrors.push(err);\n    } else {\n      let projectErrors = errorsByProjectByFile.get(err.project);\n      if (!projectErrors) {\n        projectErrors = new Map<string, DetailedError[]>();\n        errorsByProjectByFile.set(err.project, projectErrors);\n      }\n      let fileErrors = projectErrors.get(err.loc.absolutePath);\n      if (!fileErrors) {\n        fileErrors = [];\n        projectErrors.set(err.loc.absolutePath, fileErrors);\n      }\n      fileErrors.push(err);\n    }\n  }\n  for (const byFile of errorsByProjectByFile.values()) {\n    for (const errors of byFile.values()) {\n      errors.sort((err1, err2) => {\n        if (!err1.loc.start) {\n          return -1;\n        } else if (!err2.loc.start) {\n          return 1;\n        }\n        const diffLine = err1.loc.start.line - err2.loc.start.line;\n        if (diffLine !== 0) {\n          return diffLine;\n        }\n        if (err1.loc.start.column === undefined) {\n          return -1;\n        } else if (err2.loc.start.column === undefined) {\n          return 1;\n        }\n        const diffColumn = err1.loc.start.column - err2.loc.start.column;\n        if (diffColumn !== 0) {\n          return diffColumn;\n        }\n        return err1.message.localeCompare(err2.message);\n      });\n    }\n  }\n  return {errorsByProjectByFile, globalErrors};\n}\n","import {relative, sep} from 'node:path';\n\nimport {Issue} from 'fork-ts-checker-webpack-plugin/lib/issue';\nimport {WebpackError} from 'webpack';\n\nimport {EslintWebpackError} from '@src/webpack/plugins/eslint_plugin';\n\nexport type ErrorSeverity = 'warning' | 'error';\nexport type ErrorType = 'eslint' | 'tsc' | 'module-not-found';\n\nexport interface DetailedError {\n  project: string;\n  type: 'eslint' | 'tsc' | 'module-not-found';\n  severity: ErrorSeverity;\n  message: string;\n  code: string;\n  loc: {\n    relativePath: string;\n    absolutePath: string;\n    start?: {\n      line: number;\n      column?: number;\n    };\n    end?: {\n      line: number;\n      column?: number;\n    };\n  };\n}\n\nexport interface GlobalError {\n  severity: ErrorSeverity;\n  message: string;\n}\n\nexport type ParsedError = DetailedError | GlobalError;\n\nfunction parseFilePath(root: string, path: string): {project: string; relativePath: string} {\n  const relativePath = relative(root, path);\n  const project = relativePath.split(sep)[0] ?? '';\n  return {project, relativePath};\n}\n\nexport function parseError(\n  err: WebpackError,\n  opts: {root: string; severity: ErrorSeverity}\n): ParsedError {\n  const {root, severity} = opts;\n  if (err.name === 'EslintWebpackError') {\n    const eslintError = err as EslintWebpackError;\n    const absolutePath = err.file;\n    if (absolutePath === undefined) {\n      return {severity, message: err.message};\n    }\n    const {relativePath, project} = parseFilePath(root, absolutePath);\n    return {\n      project,\n      type: 'eslint',\n      severity,\n      message: err.message,\n      code: eslintError.ruleId,\n      loc: {\n        relativePath,\n        absolutePath,\n        start: err.loc && 'start' in err.loc ? err.loc.start : undefined,\n        end: err.loc && 'end' in err.loc ? err.loc.end : undefined,\n      },\n    };\n  } else if ('issue' in err) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const issue = (err as any)['issue'] as Issue;\n    const absolutePath = issue.file;\n    if (absolutePath === undefined) {\n      return {severity, message: err.message};\n    }\n    const {relativePath, project} = parseFilePath(root, absolutePath);\n    return {\n      project,\n      type: 'tsc',\n      severity,\n      message: issue.message,\n      code: issue.code,\n      loc: {\n        relativePath,\n        absolutePath,\n        ...issue.location,\n      },\n    };\n  } else if (err.name === 'ModuleNotFoundError') {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const msg = (err as any).error.message as string;\n    const match = /(?<msg>Can't resolve '[^']+') in '(?<file>[^']+)'/u.exec(msg);\n\n    if (!match) {\n      return {severity, message: err.message};\n    }\n    const [_, message, absolutePath] = match;\n    if (absolutePath === undefined || message === undefined) {\n      return {severity, message: err.message};\n    }\n    const {relativePath, project} = parseFilePath(root, absolutePath);\n    return {\n      project,\n      type: 'tsc',\n      severity,\n      message,\n      loc: {\n        relativePath,\n        absolutePath,\n      },\n    };\n  }\n  return {severity, message: err.message};\n}\n","import {networkInterfaces} from 'node:os';\n\nexport function getLocalIp(): string {\n  return (\n    Object.values(networkInterfaces())\n      .flat()\n      .find(net => net !== undefined && net.family === 'IPv4' && net.address.startsWith('192.168.'))\n      ?.address ?? '127.0.0.1'\n  );\n}\n","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:os\");","import {spawn} from 'node:child_process';\n\nimport {registerExitCallback} from '@src/exit_handler';\nimport {log} from '@src/logger';\n\nexport function readLines(filePath: string, cb: (newLines: string[]) => void): () => void {\n  const p = spawn('tail', ['-F', filePath], {stdio: 'pipe'});\n  const cleanup = (): void => {\n    if (!p.killed) {\n      p.kill();\n    }\n  };\n  registerExitCallback(cleanup);\n  let data = '';\n  p.stdout.on('data', chunk => {\n    data += chunk;\n    const lines = data.split('\\n');\n    // eslint-disable-next-line node/callback-return\n    cb(lines.slice(0, -1));\n    data = lines.at(-1) ?? '';\n  });\n  p.on('error', err => {\n    log(err);\n  });\n  return cleanup;\n}\n","import {bgRed, bgYellow, cyan, gray, green, red} from 'ansi-colors';\n\nimport {WorkspaceProject} from '@src/project/generate_workspace';\nimport {neverHappens} from '@src/type_utils';\nimport {LambdaServerEvent} from '@src/webpack/plugins/lambda_server_plugin';\nimport {WebpackDevServerEvent} from '@src/webpack/plugins/webpack_dev_server';\nimport {formatError, formatFilePath, formatProject} from '@src/webpack-runner/error_formatter';\nimport {GroupedErrors} from '@src/webpack-runner/error_grouper';\nimport {ParsedError} from '@src/webpack-runner/error_parser';\nimport {getLocalIp} from '@src/webpack-runner/ip';\nimport {LambdaServerEvents, WebpackDevServerEvents} from '@src/webpack-runner/runner';\n\nexport function renderErrors(errors: GroupedErrors): string {\n  const {errorsByProjectByFile, globalErrors} = errors;\n  const blocks: string[] = [];\n\n  for (const globalError of globalErrors) {\n    blocks.push(formatError(globalError));\n  }\n\n  for (const [projectName, projectErrors] of errorsByProjectByFile.entries()) {\n    blocks.push(cyan(projectName));\n    for (const [file, errors] of projectErrors.entries()) {\n      blocks.push([formatFilePath(file), ...errors.map(err => formatError(err))].join('\\n'));\n    }\n  }\n\n  return blocks.join('\\n\\n');\n}\n\nexport function renderProjectStatus(\n  project: WorkspaceProject,\n  firstRun: boolean,\n  isRunning: boolean,\n  errors: GroupedErrors,\n  compilationFailure: string | undefined,\n  lambdaServerEvents: LambdaServerEvents,\n  webpackDevServerEvents: WebpackDevServerEvents\n): string[] {\n  // First column\n  const column1 = formatProject(project);\n\n  // Second column\n  let column2 = '';\n  const projectErrors = errors.errorsByProjectByFile.get(project.projectName);\n  if (projectErrors) {\n    column2 = renderErrorWarningCount([...projectErrors.values()].flat());\n  } else if (!firstRun) {\n    column2 = green('success');\n  } else if (isRunning) {\n    column2 = gray('in progress');\n  }\n\n  // Third column\n  const column3: string[] = [];\n  if (lambdaServerEvents.startEvent) {\n    column3.push(renderLambdaServerEvent(lambdaServerEvents.startEvent));\n  }\n  if (webpackDevServerEvents.startEvent) {\n    column3.push(renderWebpackDevServerEvent(webpackDevServerEvents.startEvent));\n  }\n  if (compilationFailure !== undefined) {\n    column3.push(red(compilationFailure));\n  }\n  if (lambdaServerEvents.lastEvent) {\n    column3.push(renderLambdaServerEvent(lambdaServerEvents.lastEvent));\n  }\n\n  return [column1, column2, column3.join(' ')];\n}\n\nexport function renderErrorWarningCount(errors: ParsedError[]): string {\n  const errorCount = errors.filter(err => err.severity === 'error').length;\n  const warnCount = errors.filter(err => err.severity === 'warning').length;\n  const diag: string[] = [];\n\n  if (errorCount > 0) {\n    const plural = errorCount > 1 ? 's' : '';\n    diag.push(bgRed.whiteBright(` ${errorCount} error${plural} `));\n  }\n  if (warnCount > 0) {\n    const plural = warnCount > 1 ? 's' : '';\n    diag.push(bgYellow.whiteBright(` ${warnCount} warning${plural} `));\n  }\n  return diag.join(' ');\n}\n\nexport function renderLambdaServerEvent(event: LambdaServerEvent): string {\n  const type = event.event;\n  if (type === 'start') {\n    return `http://${getLocalIp()}:${event.port}`;\n  }\n  const req = gray(`${event.method} ${event.path}`);\n  if (type === 'error') {\n    return `${req} ${red(event.err)}`;\n  } else if (type === 'request') {\n    return `${req} ${gray('running lambda...')}`;\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  } else if (type === 'response') {\n    const httpCode = `[HTTP ${event.statusCode}]`;\n    const size = `[${event.bodyLength.toLocaleString()}b]`;\n    const duration = `[${event.duration.toLocaleString()}ms]`;\n    // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n    const color = event.statusCode >= 400 ? red : green;\n    return `${req} ${color(`${httpCode} ${size} ${duration}`)}`;\n  }\n  neverHappens(type);\n}\n\nexport function renderWebpackDevServerEvent(event: WebpackDevServerEvent): string {\n  const type = event.event;\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (type === 'start') {\n    return `http://${getLocalIp()}:${event.port}`;\n  }\n  // const req = gray(`${event.method} ${event.path}`);\n  // if (type === 'error') {\n  //   return `${req} ${red(event.err)}`;\n  // } else if (type === 'request') {\n  //   return `${req} ${gray('running lambda...')}`;\n  //   // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  // } else if (type === 'response') {\n  //   const httpCode = `[HTTP ${event.statusCode}]`;\n  //   const size = `[${event.byteLength.toLocaleString()}b]`;\n  //   const duration = `[${event.duration.toLocaleString()}ms]`;\n  //   // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n  //   const color = event.statusCode >= 400 ? red : green;\n  //   return `${req} ${color(`${httpCode} ${size} ${duration}`)}`;\n  // }\n  neverHappens(type);\n}\n","import {cyan, gray, red, underline, yellow} from 'ansi-colors';\n\nimport {WorkspaceProject} from '@src/project/generate_workspace';\nimport {ErrorSeverity, ErrorType, ParsedError} from '@src/webpack-runner/error_parser';\n\nexport function formatProject(project: WorkspaceProject): string {\n  return `${cyan(project.projectName)} ${gray(project.type)}`;\n}\n\nexport function formatFilePath(filePath: string): string {\n  return underline(filePath);\n}\n\nfunction formatMessage(msg: string, severity: ErrorSeverity): string {\n  return severity === 'warning' ? yellow(msg) : red(msg);\n}\n\nconst padLeft = (value: string, size: number): string =>\n  value.length >= size ? value : padLeft(` ${value}`, size);\nconst padRight = (value: string, size: number): string =>\n  value.length >= size ? value : padRight(`${value} `, size);\n\nfunction formatLocation(loc?: {line: number; column?: number}): string {\n  const {line, column} = loc ?? {};\n  const padValue = 3;\n  const lineStr = String(line ?? '');\n  const columnStr = String(column ?? '');\n  if (lineStr.length === 0 && columnStr.length === 0) {\n    return padLeft('', 2 * padValue + 1);\n  }\n  return gray(`${padLeft(lineStr, padValue)}:${padRight(columnStr, padValue)}`);\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction formatLabel(code: string, type: ErrorType): string {\n  return gray(code);\n}\n\nexport function formatError(err: ParsedError): string {\n  if ('type' in err) {\n    return `${formatLocation(err.loc.start)} ${formatMessage(\n      err.message,\n      err.severity\n    )} ${formatLabel(err.code, err.type)}`;\n  }\n  return formatMessage(`[${err.severity}] ${err.message}`, err.severity);\n}\n","const ansiRegex = new RegExp(\n  [\n    '[\\\\u001B\\\\u009B][[\\\\]()#;?]*(?:(?:(?:[a-zA-Z\\\\d]*(?:;[-a-zA-Z\\\\d\\\\/#&.:=?%@~_]*)*)?\\\\u0007)',\n    '(?:(?:\\\\d{1,4}(?:;\\\\d{0,4})*)?[\\\\dA-PR-TZcf-ntqry=><~]))',\n  ].join('|'),\n  'gu'\n);\nconst stripAnsi = (s: string): string => s.replace(ansiRegex, '');\n\ntype AlignType = 'l' | 'r';\ntype Cell = string | number;\n\ninterface TextTableOptions {\n  align?: AlignType[];\n}\n\nfunction formatCell(cell: Cell): string {\n  return typeof cell === 'string' ? cell : cell.toLocaleString();\n}\n\nfunction padString(value: string, indent: number, right: boolean): string {\n  let valueStr = value;\n  for (let i = 0; i < indent; i++) {\n    valueStr = right ? `${valueStr} ` : ` ${valueStr}`;\n  }\n  return valueStr;\n}\n\nexport function table(data: Cell[][], options?: TextTableOptions): string {\n  if (data.length === 0) {\n    return '';\n  }\n  const {align = []} = options ?? {};\n  const maxWidths: number[] = [];\n  for (const line of data) {\n    for (const [columnIndex, cell] of line.entries()) {\n      maxWidths[columnIndex] = Math.max(\n        maxWidths[columnIndex] ?? 0,\n        stripAnsi(formatCell(cell)).length\n      );\n    }\n  }\n\n  return data\n    .map(line =>\n      line\n        .map((cell, colIndex, arr) => {\n          const content = formatCell(cell);\n          return colIndex === arr.length - 1 && align[colIndex] !== 'r'\n            ? content\n            : padString(\n                content,\n                (maxWidths[colIndex] ?? 0) - stripAnsi(content).length,\n                align[colIndex] !== 'r'\n              );\n        })\n        .join(' ')\n    )\n    .join('\\n');\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {execSync} from 'node:child_process';\nimport {join} from 'node:path';\n\nimport {underline} from 'ansi-colors';\nimport {Configuration, Stats, webpack} from 'webpack';\nimport WebpackDevServer from 'webpack-dev-server';\n\nimport {registerExitCallback} from '@src/exit_handler';\nimport {globalError} from '@src/global_error';\nimport {error, log} from '@src/logger';\nimport {ProjectName, ProjectType, WorkspaceFragment} from '@src/models';\nimport {getProjectsFromWorkspaceFragment, WorkspaceProject} from '@src/project/generate_workspace';\nimport {readWorkspace} from '@src/project/vscode_workspace';\nimport {neverHappens, removeUndefined} from '@src/type_utils';\nimport {\n  FullLambdaServerEvent,\n  LambdaServerEvent,\n  LambdaServerStartEvent,\n} from '@src/webpack/plugins/lambda_server_plugin';\nimport {\n  FullWebpackDevServerEvent,\n  WebpackDevServerStartEvent,\n} from '@src/webpack/plugins/webpack_dev_server';\nimport {getEnv, getPort} from '@src/webpack/utils';\nimport {generateEnvFile} from '@src/webpack-runner/env_definition_file';\nimport {groupAndSortErrors} from '@src/webpack-runner/error_grouper';\nimport {ParsedError, parseError} from '@src/webpack-runner/error_parser';\nimport {getLocalIp} from '@src/webpack-runner/ip';\nimport {readLines} from '@src/webpack-runner/line_reader';\nimport {\n  renderErrors,\n  renderErrorWarningCount,\n  renderProjectStatus,\n} from '@src/webpack-runner/renderer';\nimport {table} from '@src/webpack-runner/text_table';\n\ninterface RunWebpacksOptions {\n  root: string;\n  workspaceFragments: WorkspaceFragment[];\n  watch: boolean;\n}\n\nexport interface LambdaServerEvents {\n  startEvent?: LambdaServerStartEvent;\n  lastEvent?: Exclude<LambdaServerEvent, LambdaServerStartEvent>;\n}\n\nexport interface WebpackDevServerEvents {\n  startEvent?: WebpackDevServerStartEvent;\n  // lastEvent?: Exclude<WebpackDevServerEvent, WebpackDevServerStartEvent>;\n}\n\ninterface ProjectStatus {\n  project: WorkspaceProject;\n  firstRun: boolean;\n  isRunning: boolean;\n  errors: ParsedError[];\n  compilationFailure?: string;\n  lambdaServerEvents: LambdaServerEvents;\n  webpackDevServerEvents: WebpackDevServerEvents;\n}\n\nconst name = 'WebpackRunner';\n\nfunction exit(): void {\n  process.stdin.setRawMode(false);\n  log('See you soon!');\n  // eslint-disable-next-line node/no-process-exit\n  process.exit(0);\n}\n\nexport async function runWebpacks(opts: RunWebpacksOptions): Promise<void> {\n  const {root, workspaceFragments, watch} = opts;\n  const statuses = new Map<ProjectName, ProjectStatus>();\n  const projects = workspaceFragments.flatMap(f =>\n    getProjectsFromWorkspaceFragment(f, workspaceFragments)\n  );\n\n  async function regenerateEnvFile(): Promise<void> {\n    const overrides: Record<string, string> = {};\n    if (getEnv() === 'development') {\n      for (const {projectName, type} of projects) {\n        if (type === ProjectType.LambdaApi || type === ProjectType.LambdaWebApi) {\n          const status = statuses.get(projectName);\n          const port =\n            status?.lambdaServerEvents.startEvent?.port ?? getPort(join(root, projectName));\n          overrides[`${projectName.toUpperCase()}_FUNCTION_URL`] =\n            `http://${getLocalIp()}:${port}/`;\n        }\n        if (type === ProjectType.Web) {\n          const status = statuses.get(projectName);\n          const port =\n            status?.webpackDevServerEvents.startEvent?.port ?? getPort(join(root, projectName));\n          overrides[`${projectName.toUpperCase()}_CLOUDFRONT_DOMAIN_NAME`] =\n            `${getLocalIp()}:${port}`;\n        }\n      }\n    }\n    await generateEnvFile(overrides);\n  }\n  await regenerateEnvFile();\n\n  function handleStart(project: WorkspaceProject): void {\n    const {projectName} = project;\n    const current = statuses.get(projectName) ?? {\n      project,\n      firstRun: true,\n      isRunning: true,\n      errors: [],\n      lambdaServerEvents: {},\n      webpackDevServerEvents: {},\n    };\n    statuses.set(projectName, {...current, isRunning: true});\n    onChange({isCompleted: false, projectName});\n  }\n\n  function handleResults(project: WorkspaceProject, stats: Stats): void {\n    const {projectName} = project;\n    const errors = [\n      ...stats.compilation.errors.map(err => parseError(err, {root, severity: 'error'})),\n      ...stats.compilation.warnings.map(warn => parseError(warn, {root, severity: 'warning'})),\n    ];\n    const lambdaServerEvents = statuses.get(projectName)?.lambdaServerEvents ?? {};\n    const webpackDevServerEvents = statuses.get(projectName)?.webpackDevServerEvents ?? {};\n    const compilationFailure = statuses.get(projectName)?.compilationFailure;\n    statuses.set(projectName, {\n      project,\n      firstRun: false,\n      isRunning: false,\n      errors,\n      compilationFailure,\n      lambdaServerEvents,\n      webpackDevServerEvents,\n    });\n    onChange({isCompleted: false, projectName});\n  }\n\n  function redraw(): void {\n    const errors = [...statuses.values()].flatMap(v => v.errors);\n    const groupedErrors = groupAndSortErrors(errors);\n\n    const summary = [...statuses.values()].map(status => {\n      return renderProjectStatus(\n        status.project,\n        status.firstRun,\n        status.isRunning,\n        groupedErrors,\n        status.compilationFailure,\n        status.lambdaServerEvents,\n        status.webpackDevServerEvents\n      );\n    });\n    summary.unshift([\n      underline(`Projects (${projects.length})`),\n      underline('Status'),\n      underline('Run'),\n    ]);\n    const report = renderErrors(groupedErrors);\n\n    if (watch) {\n      process.stdout.write('\\u001B[2J\\u001B[3J\\u001B[H'); // clear terminal\n    }\n    log(table(summary));\n    if (report.length > 0) {\n      log(`\\nBuild completed with ${renderErrorWarningCount(errors)}\\n`);\n      log(report);\n    }\n  }\n\n  const completed = new Set<ProjectName>();\n  function onChange(opts: {projectName: ProjectName; isCompleted: boolean}): void {\n    if (watch) {\n      redraw();\n      return;\n    }\n\n    const {projectName, isCompleted} = opts;\n    if (isCompleted) {\n      completed.add(projectName);\n    }\n    const allDone = [...statuses.keys()].every(projectName => completed.has(projectName));\n    if (!allDone) {\n      return;\n    }\n\n    const errors = [...statuses.values()].flatMap(v => v.errors);\n    const {globalErrors} = groupAndSortErrors(errors);\n    const noGlobalErrors =\n      globalErrors.length === 0 &&\n      [...statuses.values()].every(status => status.compilationFailure === undefined);\n    if (noGlobalErrors) {\n      resolve();\n    } else {\n      reject();\n    }\n  }\n\n  const cleanupFunctions = await Promise.all(\n    projects.map(async project => {\n      const {projectName} = project;\n      const projectPath = join(root, projectName);\n      const intialStatus = {\n        project,\n        firstRun: true,\n        isRunning: true,\n        errors: [],\n        lambdaServerEvents: {},\n        webpackDevServerEvents: {},\n      };\n      statuses.set(projectName, intialStatus);\n      // eslint-disable-next-line import/dynamic-import-chunkname, node/no-unsupported-features/es-syntax\n      const config: Configuration = await import(\n        /*webpackIgnore: true*/ join(projectPath, 'webpack.config.js')\n      )\n        .then(({getConfig}) => getConfig({context: projectPath, watch}))\n        .catch((err: unknown) => {\n          reportCompilationFailure(String(err));\n        });\n\n      const reportCompilationFailure = (error: string): void => {\n        updateStatus(curr => {\n          curr.compilationFailure = error;\n        });\n      };\n\n      const updateLambdaServerEvents = (fn: (curr: LambdaServerEvents) => void): void => {\n        updateStatus(curr => fn(curr.lambdaServerEvents));\n      };\n\n      const updateWebpackDevServerEvents = (fn: (curr: WebpackDevServerEvents) => void): void => {\n        updateStatus(curr => fn(curr.webpackDevServerEvents));\n      };\n\n      const updateStatus = (fn: (curr: ProjectStatus) => void): void => {\n        let current = statuses.get(projectName);\n        if (!current) {\n          current = intialStatus;\n          statuses.set(projectName, current);\n        }\n        fn(current);\n      };\n\n      // Read events in the lambda server logs to update the globalInfo\n      let lastProcessedLambdaLog = Date.now();\n      const tailLambdaServerCleanup = watch\n        ? readLines(join(projectPath, 'log', 'lambda_server_runtime.txt'), lines => {\n            const logs = lines\n              .map(l => l.trim())\n              .filter(l => l.length > 0)\n              .map(l => JSON.parse(l) as FullLambdaServerEvent);\n            let shouldRedraw = false;\n            for (const log of logs) {\n              const date = new Date(log.t).getTime();\n              if (date < lastProcessedLambdaLog) {\n                continue;\n              }\n              lastProcessedLambdaLog = date;\n              shouldRedraw = true;\n              if (log.event === 'start') {\n                updateLambdaServerEvents(curr => {\n                  curr.startEvent = log;\n                });\n                // Send and forget\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                regenerateEnvFile();\n              } else {\n                updateLambdaServerEvents(curr => {\n                  curr.lastEvent = log;\n                });\n              }\n            }\n            if (shouldRedraw) {\n              redraw();\n            }\n          })\n        : undefined;\n\n      // Read events in the webpack dev server logs to update the globalInfo\n      let lastProcessedDevServerLog = Date.now();\n      const tailWebpackServerCleanup = watch\n        ? readLines(join(projectPath, 'log', 'webpack_dev_server.txt'), lines => {\n            const logs = lines\n              .map(l => l.trim())\n              .filter(l => l.length > 0)\n              .map(l => JSON.parse(l) as FullWebpackDevServerEvent);\n            let shouldRedraw = false;\n            for (const log of logs) {\n              const date = new Date(log.t).getTime();\n              if (date < lastProcessedDevServerLog) {\n                continue;\n              }\n              lastProcessedDevServerLog = date;\n              shouldRedraw = true;\n              // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n              if (log.event === 'start') {\n                updateWebpackDevServerEvents(curr => {\n                  curr.startEvent = log;\n                });\n              } else {\n                neverHappens(log.event);\n                //   updateWebpackDevServerEvents(curr => {\n                //     curr.lastEvent = log;\n                //   });\n              }\n            }\n            if (shouldRedraw) {\n              redraw();\n            }\n          })\n        : undefined;\n\n      const compiler = webpack({...config, watch}, (err?: Error, res?: Stats) => {\n        if (err || !res) {\n          reportCompilationFailure(err ? String(err) : 'No result after compilation');\n          if (!watch) {\n            onChange({isCompleted: true, projectName});\n            resolve();\n            return;\n          }\n        }\n        onChange({isCompleted: true, projectName});\n      });\n      compiler.hooks.beforeRun.tap(name, () => handleStart(project));\n      compiler.hooks.watchRun.tap(name, () => handleStart(project));\n      compiler.hooks.done.tap(name, stats => handleResults(project, stats));\n\n      let devServer: WebpackDevServer | undefined;\n      if (config.devServer) {\n        devServer = new WebpackDevServer(config.devServer, compiler);\n        await devServer.start();\n      }\n      return async (): Promise<void> => {\n        return new Promise<void>((resolve, reject) => {\n          const closeCompiler = (): void => {\n            tailLambdaServerCleanup?.();\n            tailWebpackServerCleanup?.();\n            compiler.close(err => (err ? reject(err) : resolve()));\n          };\n          if (devServer) {\n            devServer.stop().then(closeCompiler).catch(reject);\n          } else {\n            closeCompiler();\n          }\n        });\n      };\n    })\n  );\n\n  let resolvePromise: () => void;\n  let rejectPromise: (err?: unknown) => void;\n  const globalPromise = new Promise<void>((resolve, reject) => {\n    resolvePromise = resolve;\n    rejectPromise = reject;\n  });\n\n  let cleanupCalled = false;\n  const cleanup = async (): Promise<void> => {\n    if (cleanupCalled) {\n      return;\n    }\n    cleanupCalled = true;\n    await Promise.all(cleanupFunctions.map(async fn => fn()));\n    redraw();\n  };\n\n  const reject = (err?: unknown): void => {\n    cleanup()\n      .then(() => rejectPromise(err))\n      .catch(cleanupErr => {\n        globalError('webpack runner cleanup error', cleanupErr);\n        rejectPromise(err);\n      });\n  };\n  const resolve = (): void => {\n    cleanup()\n      .then(resolvePromise)\n      .catch(cleanupErr => {\n        globalError('webpack runner cleanup error', cleanupErr);\n        resolvePromise();\n      });\n  };\n\n  if (watch) {\n    process.stdin.setRawMode(true);\n    process.stdin.on('data', data => {\n      const str = data.toString();\n      // Handle ctrl+c\n      if (str === '\\u0003') {\n        process.emit('SIGINT', 'SIGINT');\n      } else if (str === 'o') {\n        const errorPaths = removeUndefined(\n          [...statuses.values()]\n            .flatMap(status => status.errors)\n            .map(err => ('loc' in err ? err.loc.absolutePath : undefined))\n        );\n        const files = [...new Set([...errorPaths]).values()];\n        const openCommand = `code ${files.join(' ')}`;\n        execSync(openCommand);\n      }\n    });\n\n    process.on('SIGINT', () => {\n      exit();\n    });\n    process.on('beforeExit', () => {\n      exit();\n    });\n\n    // Handle uncaught error and exceptions\n    process.on('uncaughtException', err => {\n      error('Uncaught Exception');\n      error(err);\n      exit();\n    });\n\n    // Handle unhandled failing promises\n    process.on('unhandledRejection', err => {\n      error('Unhandled Rejection');\n      error(err);\n      exit();\n    });\n  }\n\n  registerExitCallback(cleanup);\n  return globalPromise;\n}\n\nexport async function runAllWebpacks(\n  options: Omit<RunWebpacksOptions, 'projectPaths'>\n): Promise<void> {\n  const {root, watch} = options;\n\n  const {fragments} = (await readWorkspace(root)) ?? {};\n  if (!fragments) {\n    throw new Error(`No workspace projects at path ${root}`);\n  }\n  await runWebpacks({\n    root,\n    workspaceFragments: fragments,\n    watch,\n  });\n}\n"],"names":["globalError","called","callbacks","runCallbacks","fn","Promise","resolve","catch","err","process","on","registerExitCallback","cb","push","appendFileSync","error","val","data","str","Error","stack","String","JSON","stringify","log","console","ProjectType","EslintType","TsConfigType","WebpackType","PROJECT_TYPE_TO_METADATA","Web","eslint","tsconfig","webpack","LambdaFunction","Node","Lambda","LambdaApi","LambdaWebApi","NodeScript","Shared","Lib","SharedNode","SharedWeb","WorkspaceFragmentType","validateRegistry","execSync","join","relative","fileURLToPath","listFiles","prettyJs","prettyJson","readFile","writeRawFile","md5","generateProject","generateGitIgnore","generateWorkspacePackageJson","generateCommonTerraform","generateDummyTerraformCredentials","generateWorkspaceProjectTerraform","generateDynamoUserTerraform","generateDynamoUserSessionTerraform","generateCodeWorkspace","writeWorkspace","lowerCase","neverHappens","removeUndefined","PACKAGE_VERSIONS","TEMPLATES_PATH","import","meta","url","getProjectsFromWorkspaceFragment","fragment","allFragments","type","StaticWebsite","projectName","websiteName","fromFragment","vars","__PROJECT_NAME__","StandaloneLambda","lambdaName","ApiLambda","__BACKEND_NAME__","__BACKEND_NAME_UPPERCASE__","toUpperCase","WebApp","__FRONTEND_NAME__","__FRONTEND_NAME_UPPERCASE__","scriptName","otherVars","bestBackend","map","frag","name","prio","undefined","sort","a","b","generateWorkspace","dst","workspaceName","workspaceFragments","workspace","projects","flatMap","f","projectFiles","all","project","SCRIPTS_PATH","writeFile","path","file","writeWorkspaceFile","workspaceFiles","vscodePath","vscodeFileList","vscodeFiles","relativePath","dstPath","content","tablePrefix","terraformFiles","p","files","flat","fragments","version","commands","stdio","cwd","root","_workspace$files$find","newHash","oldHash","find","hash","exec","promises","readFileSync","dirname","format","access","readFileInternal","readdir","stat","mkdir","rm","buffer","toString","prettierConfig","parser","printWidth","singleQuote","trailingComma","bracketSpacing","arrowParens","endOfLine","prettierFormat","recursive","json","opts","compact","writeJsonFile","js","writeJsFile","prettyTs","ts","writeTsFile","writeRawFileIfNotExists","exists","rmDir","dirPath","force","cleanDir","cp","from","to","reject","maybeReadFile","fileContent","maybeReadFileSync","ents","withFileTypes","ent","entPath","isDirectory","then","subFiles","isFile","createHash","update","digest","hashPassword","password","salt","randomStringSafe","upperCase","written","defaultVars","__WORKSPACE_NAME__","__WORKSPACE_NAME_UPPERCASE__","__COOKIE_ENCRYPTION_KEY__","templatePath","newContent","varName","varValue","Object","entries","replaceAll","endsWith","packageJson","parse","randomBytes","ALPHANUM","length","set","result","characters","bytes","byte","Math","floor","UID_LENGTH","uidSafe","prefix","id","NONCE_BYTE_SIZE","generateNonce","capitalize","value","firstChar","slice","uncapitalize","toLowerCase","pascalCase","split","s","trim","TYPESCRIPT_VERSION","uniq","Set","values","eslintRuntimes","tsconfigRuntimes","webpackRuntimes","license","engines","node","scripts","setup","deploy","build","watch","eslintConfig","ignorePatterns","prettier","devDependencies","fromEntries","runtime","runner","d1","d2","localeCompare","lambdaServerRuntime","ESLINT_VERSION","PRETTIER_VERSION","LIB_VERSIONS","react","generateCloudfrontDistributionTerraform","generateLambdaTerraform","generateAwsProviderTerraform","generateS3BucketTerraform","filter","cloudwatchTriggerMinutes","alarmEmail","api","web","bucketName","replace","originId","prefixLower","webProjectNames","CODE_BUCKET","CLOUDFRONT_ACCESS","out","notUndefined","isString","isNumber","iterNumberEnum","e","iterStringEnum","arr","removeUndefinedOrNullProps","obj","errorMessage","asMap","defaultValue","asMapOrThrow","valueAsMap","asJson","res","asJsonOrThrow","valueAsJson","asJsonString","asString","asJsonStringOrThrow","asStringOrThrow","valueAsString","asArray","Array","isArray","asArrayOrThrow","asStringArray","asStringArrayOrThrow","asMapArray","asMapArrayOrThrow","asNumber","isNaN","parsedValue","parseFloat","asNumberOrThrow","valueAsNumber","asBoolean","asBooleanOrThrow","valueAsBoolean","TIMESTAMP_REGEX","asDate","date","Date","test","getTime","asDateOrThrow","valueAsDate","isNull","asError","errorAsString","errorMap","errorAndStackAsString","asConstantOrThrow","expected","parseJson","addPrefix","attr","key","prefixPascal","projectNames","folders","settings","reportUnusedDisableDirectives","extensions","recommendations","readWorkspace","workspacePath","workspaceContent","workspaceData","f1","f2","isProd","env","isSelenium","getEnv","packageJsonCache","Map","findPackageJson","has","get","pStat","dir","includes","getPort","context","hexHash","port","parseInt","initLogFile","logFileName","lookupRoot","logDir","logFile","fromPath","parent","generateEnvFile","overrides","terraformPath","outputsEntries","sensitive","k","v","envConstants","REGION","NODE_ENV","groupAndSortErrors","errors","errorsByProjectByFile","globalErrors","projectErrors","fileErrors","loc","absolutePath","byFile","err1","err2","start","diffLine","line","column","diffColumn","message","sep","parseFilePath","parseError","severity","eslintError","code","ruleId","end","issue","location","msg","match","_","networkInterfaces","getLocalIp","_Object$values$flat$f","net","family","address","startsWith","spawn","readLines","filePath","cleanup","killed","kill","stdout","chunk","lines","at","bgRed","bgYellow","cyan","gray","green","red","formatError","formatFilePath","formatProject","renderErrors","blocks","renderProjectStatus","firstRun","isRunning","compilationFailure","lambdaServerEvents","webpackDevServerEvents","column1","column2","renderErrorWarningCount","column3","startEvent","renderLambdaServerEvent","renderWebpackDevServerEvent","lastEvent","errorCount","warnCount","diag","plural","whiteBright","event","req","method","httpCode","statusCode","size","bodyLength","toLocaleString","duration","color","underline","yellow","formatMessage","padLeft","padRight","formatLocation","padValue","lineStr","columnStr","formatLabel","ansiRegex","RegExp","stripAnsi","formatCell","cell","padString","indent","right","valueStr","i","table","options","align","maxWidths","columnIndex","max","colIndex","WebpackDevServer","exit","stdin","setRawMode","runWebpacks","statuses","regenerateEnvFile","_status$lambdaServerE","status","_status$webpackDevSer","handleStart","current","onChange","isCompleted","handleResults","stats","_statuses$get","_statuses$get2","_statuses$get3","compilation","warnings","warn","redraw","groupedErrors","summary","unshift","report","write","completed","add","allDone","keys","every","noGlobalErrors","cleanupFunctions","projectPath","intialStatus","config","getConfig","reportCompilationFailure","updateStatus","curr","updateLambdaServerEvents","updateWebpackDevServerEvents","lastProcessedLambdaLog","now","tailLambdaServerCleanup","logs","l","shouldRedraw","t","lastProcessedDevServerLog","tailWebpackServerCleanup","compiler","hooks","beforeRun","tap","watchRun","done","devServer","closeCompiler","close","stop","resolvePromise","rejectPromise","globalPromise","cleanupCalled","cleanupErr","emit","errorPaths","openCommand","runAllWebpacks"],"sourceRoot":""}