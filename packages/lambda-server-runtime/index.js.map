{"version":3,"file":"index.js","mappings":";;;;;;AAAA;;;;;;ACAA;;;;;;ACAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAA,SAASA,YAAYA,CAAIC,GAAkB,EAAY;EACrD,OAAOA,GAAG,KAAKC,SAAS;AAC1B;AAEO,SAASC,QAAQA,CAACF,GAAY,EAAiB;EACpD,OAAO,OAAOA,GAAG,KAAK,QAAQ;AAChC;AAEO,SAASG,QAAQA,CAACH,GAAY,EAAiB;EACpD,OAAO,OAAOA,GAAG,KAAK,QAAQ;AAChC;AAEO,SAASI,cAAcA,CAA4CC,CAAI,EAAgB;EAC5F,OAAOC,MAAM,CAACC,MAAM,CAACF,CAAC,CAAC,CAACG,MAAM,CAACL,QAAQ,CAAC;AAC1C;AAEO,SAASM,cAAcA,CAAmCJ,CAAI,EAAgB;EACnF,OAAOC,MAAM,CAACC,MAAM,CAACF,CAAC,CAAC,CAACG,MAAM,CAACN,QAAQ,CAAC;AAC1C;AAEO,SAASQ,eAAeA,CAAIC,GAAsB,EAAO;EAC9D,OAAOA,GAAG,CAACH,MAAM,CAACT,YAAY,CAAC;AACjC;AAEO,SAASa,0BAA0BA,CAAoCC,GAAM,EAAM;EACxF,OAAOP,MAAM,CAACQ,WAAW;EACvB;EACAR,MAAM,CAACS,OAAO,CAACF,GAAG,CAAC,CAACL,MAAM,CAACH,CAAC,IAAIA,CAAC,CAAC,CAAC,CAAC,KAAKJ,SAAS,IAAII,CAAC,CAAC,CAAC,CAAC,KAAK,IAAI,CACrE,CAAC;AACH;AAEO,SAASW,YAAYA,CAACC,KAAY,EAAEC,YAAqB,EAAS;EACvE,MAAM,IAAIC,KAAK,CAACD,YAAY,CAAC;AAC/B;AAOO,SAASE,KAAKA,CACnBH,KAAc,EACdI,YAAsC,EACD;EACrC;EACA,OAAO,OAAOJ,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,GAC7CA,KAAK,GACNI,YAAY;AAClB;AACO,SAASC,YAAYA,CAACL,KAAc,EAA2B;EACpE,MAAMM,UAAU,GAAGH,KAAK,CAACH,KAAK,CAAC;EAC/B,IAAIM,UAAU,KAAKtB,SAAS,EAAE;IAC5B,MAAM,IAAIkB,KAAK,CAAE,oBAAmBF,KAAM,iBAAgB,CAAC;EAC7D;EACA,OAAOM,UAAU;AACnB;AAOO,SAASC,MAAMA,CACpBP,KAAa,EACbI,YAAsC,EACD;EACrC,IAAI;IACF,MAAMI,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACV,KAAK,CAAC;IAC9B,MAAMW,GAAG,GAAGR,KAAK,CAACK,IAAI,CAAC;IACvB,OAAOG,GAAG,IAAIP,YAAY;EAC5B,CAAC,CAAC,MAAM;IACN,OAAOA,YAAY;EACrB;AACF;AACO,SAASQ,aAAaA,CAACZ,KAAa,EAA2B;EACpE,MAAMa,WAAW,GAAGN,MAAM,CAACP,KAAK,CAAC;EACjC,IAAIa,WAAW,KAAK7B,SAAS,EAAE;IAC7B,MAAM,IAAIkB,KAAK,CAAE,oBAAmBF,KAAM,wCAAuC,CAAC;EACpF;EACA,OAAOa,WAAW;AACpB;AAOO,SAASC,YAAYA,CAC1Bd,KAAc,EACdI,YAAsC,EACD;EACrC,MAAMW,GAAG,GAAGC,QAAQ,CAAChB,KAAK,CAAC;EAC3B,OAAOe,GAAG,KAAK/B,SAAS,GACpBoB,YAAY,GACZA,YAAY,KAAKpB,SAAS,GACxBuB,MAAM,CAACQ,GAAG,CAAC,GACXR,MAAM,CAACQ,GAAG,EAAEX,YAAY,CAAC;AACjC;AACO,SAASa,mBAAmBA,CAACjB,KAAc,EAA2B;EAC3E,OAAOY,aAAa,CAACM,eAAe,CAAClB,KAAK,CAAC,CAAC;AAC9C;AAIO,SAASgB,QAAQA,CACtBhB,KAAc,EACdI,YAAqB,EACN;EACf,OAAQ,OAAOJ,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAGI,YAAY;AAC1D;AACO,SAASc,eAAeA,CAA4BlB,KAAc,EAAK;EAC5E,MAAMmB,aAAa,GAAGH,QAAQ,CAAIhB,KAAK,CAAC;EACxC,IAAImB,aAAa,KAAKnC,SAAS,EAAE;IAC/B,MAAM,IAAIkB,KAAK,CAAE,oBAAmBF,KAAM,oBAAmB,CAAC;EAChE;EACA,OAAOmB,aAAa;AACtB;AAIO,SAASC,OAAOA,CAAcpB,KAAc,EAAEI,YAAwB,EAAmB;EAC9F,OAAQiB,KAAK,CAACC,OAAO,CAACtB,KAAK,CAAC,GAAGA,KAAK,GAAGI,YAAY;AACrD;AACO,SAASmB,cAAcA,CAAcvB,KAAc,EAAO;EAC/D,IAAI,CAACqB,KAAK,CAACC,OAAO,CAACtB,KAAK,CAAC,EAAE;IACzB,MAAM,IAAIE,KAAK,CAAE,oBAAmBF,KAAM,oBAAmB,CAAC;EAChE;EACA,OAAOA,KAAK;AACd;AAOO,SAASwB,aAAaA,CAC3BxB,KAAc,EACdI,YAAuB,EACN;EACjB,MAAMV,GAAG,GAAG0B,OAAO,CAACpB,KAAK,CAAC;EAC1B,IAAIN,GAAG,KAAKV,SAAS,EAAE;IACrB,OAAOoB,YAAY;EACrB;EACA,OAAOX,eAAe,CAACC,GAAG,CAAC+B,GAAG,CAACC,CAAC,IAAIV,QAAQ,CAAIU,CAAC,CAAC,CAAC,CAAC;AACtD;AAEO,SAASC,oBAAoBA,CAA4B3B,KAAc,EAAO;EACnF,MAAMN,GAAG,GAAG6B,cAAc,CAACvB,KAAK,CAAC;EACjC,OAAON,GAAG,CAAC+B,GAAG,CAACC,CAAC,IAAIR,eAAe,CAAIQ,CAAC,CAAC,CAAC;AAC5C;AAOO,SAASE,UAAUA,CACxB5B,KAAc,EACdI,YAAwC,EACD;EACvC,MAAMV,GAAG,GAAG0B,OAAO,CAACpB,KAAK,CAAC;EAC1B,IAAIN,GAAG,KAAKV,SAAS,EAAE;IACrB,OAAOoB,YAAY;EACrB;EACA,OAAOX,eAAe,CAACC,GAAG,CAAC+B,GAAG,CAACC,CAAC,IAAIvB,KAAK,CAACuB,CAAC,CAAC,CAAC,CAAC;AAChD;AACO,SAASG,iBAAiBA,CAAC7B,KAAc,EAA6B;EAC3E,MAAMN,GAAG,GAAG6B,cAAc,CAACvB,KAAK,CAAC;EACjC,OAAON,GAAG,CAAC+B,GAAG,CAACC,CAAC,IAAIrB,YAAY,CAACqB,CAAC,CAAC,CAAC;AACtC;AAIO,SAASI,QAAQA,CACtB9B,KAAc,EACdI,YAAqB,EACN;EACf,IAAI,OAAOJ,KAAK,KAAK,QAAQ,EAAE;IAC7B,OAAQ,CAAC+B,KAAK,CAAC/B,KAAK,CAAC,GAAGA,KAAK,GAAGI,YAAY;EAC9C;EACA,IAAI,OAAOJ,KAAK,KAAK,QAAQ,EAAE;IAC7B,IAAI;MACF,MAAMgC,WAAW,GAAGC,UAAU,CAACjC,KAAK,CAAC;MACrC,OAAQ,CAAC+B,KAAK,CAACC,WAAW,CAAC,GAAGA,WAAW,GAAG5B,YAAY;IAC1D,CAAC,CAAC,MAAM;MACN,OAAOA,YAAY;IACrB;EACF;EACA,OAAOA,YAAY;AACrB;AACO,SAAS8B,eAAeA,CAA4BlC,KAAc,EAAK;EAC5E,MAAMmC,aAAa,GAAGL,QAAQ,CAAC9B,KAAK,CAAC;EACrC,IAAImC,aAAa,KAAKnD,SAAS,EAAE;IAC/B,MAAM,IAAIkB,KAAK,CAAE,oBAAmBF,KAAM,oBAAmB,CAAC;EAChE;EACA,OAAOmC,aAAa;AACtB;AAIO,SAASC,SAASA,CAACpC,KAAc,EAAEI,YAAsB,EAAuB;EACrF,IAAI,OAAOJ,KAAK,KAAK,SAAS,EAAE;IAC9B,OAAOA,KAAK;EACd;EACA,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC7B,OAAO,CAAC+B,KAAK,CAAC/B,KAAK,CAAC,GAAGA,KAAK,KAAK,CAAC,GAAG,KAAK;EAC5C;EACA,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC7B,IAAIA,KAAK,KAAK,GAAG,IAAIA,KAAK,KAAK,OAAO,EAAE;MACtC,OAAO,KAAK;IACd,CAAC,MAAM,IAAIA,KAAK,KAAK,GAAG,IAAIA,KAAK,KAAK,MAAM,EAAE;MAC5C,OAAO,IAAI;IACb;IACA,OAAOI,YAAY;EACrB;EACA,OAAOA,YAAY;AACrB;AAEO,SAASiC,gBAAgBA,CAACrC,KAAc,EAAW;EACxD,MAAMsC,cAAc,GAAGF,SAAS,CAACpC,KAAK,CAAC;EACvC,IAAIsC,cAAc,KAAKtD,SAAS,EAAE;IAChC,MAAM,IAAIkB,KAAK,CAAE,oBAAmBF,KAAM,qBAAoB,CAAC;EACjE;EACA,OAAOsC,cAAc;AACvB;AAEA,MAAMC,eAAe,GAAG,gBAAgB;AAGjC,SAASC,MAAMA,CAACxC,KAAc,EAAEI,YAAmB,EAAoB;EAC5E,MAAMqC,IAAI,GACRzC,KAAK,YAAY0C,IAAI,GACjB1C,KAAK,GACL,IAAI0C,IAAI,CACN,OAAO1C,KAAK,KAAK,QAAQ,IAAIuC,eAAe,CAACI,IAAI,CAAC3C,KAAK,CAAC,GACpDiC,UAAU,CAACjC,KAAK,CAAC,GACjB4C,MAAM,CAAC5C,KAAK,CAClB,CAAC;EACP,OAAO+B,KAAK,CAACU,IAAI,CAACI,OAAO,CAAC,CAAC,CAAC,GAAGzC,YAAY,GAAGqC,IAAI;AACpD;AAEO,SAASK,aAAaA,CAAC9C,KAAc,EAAQ;EAClD,MAAM+C,WAAW,GAAGP,MAAM,CAACxC,KAAK,CAAC;EACjC,IAAI+C,WAAW,KAAK/D,SAAS,EAAE;IAC7B,MAAM,IAAIkB,KAAK,CAAE,oBAAmBF,KAAM,+BAA8B,CAAC;EAC3E;EACA,OAAO+C,WAAW;AACpB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO,SAASC,MAAMA,CAAIjE,GAAa,EAAe;EACpD;EACA,OAAOA,GAAG,KAAK,IAAI;AACrB;AAEO,SAASkE,OAAOA,CAACC,GAAY,EAAS;EAC3C,OAAOA,GAAG,YAAYhD,KAAK,GAAGgD,GAAG,GAAG,IAAIhD,KAAK,CAAC,OAAOgD,GAAG,KAAK,QAAQ,GAAGA,GAAG,GAAGN,MAAM,CAACM,GAAG,CAAC,CAAC;AAC5F;AAEO,SAASC,aAAaA,CAACD,GAAY,EAAU;EAClD,MAAME,QAAQ,GAAGjD,KAAK,CAAC+C,GAAG,CAAC;EAC3B,IAAIE,QAAQ,KAAKpE,SAAS,EAAE;IAC1B,OAAOgC,QAAQ,CAACkC,GAAG,CAAC,IAAIN,MAAM,CAACM,GAAG,CAAC;EACrC;EAEA,MAAMjD,YAAY,GAAGe,QAAQ,CAACoC,QAAQ,CAAC,SAAS,CAAC,CAAC;EAClD,IAAInD,YAAY,KAAKjB,SAAS,EAAE;IAC9B,OAAO4D,MAAM,CAACM,GAAG,CAAC;EACpB;EACA,OAAOjD,YAAY;AACrB;AAEO,SAASoD,qBAAqBA,CAACH,GAAY,EAAU;EAC1D,MAAME,QAAQ,GAAGjD,KAAK,CAAC+C,GAAG,CAAC;EAC3B,IAAIE,QAAQ,KAAKpE,SAAS,EAAE;IAC1B,OAAOgC,QAAQ,CAACkC,GAAG,CAAC,IAAIN,MAAM,CAACM,GAAG,CAAC;EACrC;EAEA,MAAMI,KAAK,GAAGtC,QAAQ,CAACoC,QAAQ,CAAC,OAAO,CAAC,CAAC;EACzC,IAAIE,KAAK,KAAKtE,SAAS,EAAE;IACvB,OAAO4D,MAAM,CAACM,GAAG,CAAC;EACpB;EACA,OAAOI,KAAK;AACd;AAEO,SAASC,iBAAiBA,CAAIvD,KAAc,EAAEwD,QAAW,EAAK;EACnE,IAAIxD,KAAK,KAAKwD,QAAQ,EAAE;IACtB,MAAM,IAAItD,KAAK,CAAE,oBAAmBF,KAAM,kBAAiBwD,QAAS,IAAG,CAAC;EAC1E;EACA,OAAOxD,KAAK;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASyD,SAASA,CACvBjD,IAAY,EACqD;EACjE,IAAI;IACF,OAAO;MAACG,GAAG,EAAEF,IAAI,CAACC,KAAK,CAACF,IAAI,CAAC;MAAE0C,GAAG,EAAElE;IAAS,CAAC;EAChD,CAAC,CAAC,OAAOkE,GAAY,EAAE;IACrB,OAAO;MAACA,GAAG;MAAEvC,GAAG,EAAE3B;IAAS,CAAC;EAC9B;AACF;;AAKA;;AA4BA;;AAUA;;AAQO,SAAS0E,SAASA,CACvBC,IAAO,EACPC,MAAc,EACQ;EACtB,OAAOvE,MAAM,CAACQ,WAAW,CACvBR,MAAM,CAACS,OAAO,CAAC6D,IAAI,CAAC,CAAClC,GAAG,CAAC,CAAC,CAACoC,GAAG,EAAE7D,KAAK,CAAC,KAAK,CAAE,GAAE4D,MAAO,GAAEC,GAAI,EAAC,EAAE7D,KAAK,CAAC,CACvE,CAAC;AACH;;;;;SCtXA;SACA;;SAEA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;SACA;;SAEA;SACA;;SAEA;SACA;SACA;;;;;UCtBA;UACA;UACA;UACA;UACA;UACA,iCAAiC,WAAW;UAC5C;UACA;;;;;UCPA;UACA;UACA;UACA;UACA,yCAAyC,wCAAwC;UACjF;UACA;UACA;;;;;UCPA;;;;;UCAA;UACA;UACA;UACA,uDAAuD,iBAAiB;UACxE;UACA,gDAAgD,aAAa;UAC7D;;;;;;;;;;;;;;;ACNuC;AACe;AACkB;AAEX;AAG7D;AACA;AACA;;AAEA;AACA,MAAM;EAACkE,IAAI;EAAEC,gBAAgB;EAAEC,YAAY;EAAEC;AAAY,CAAC,GAAGC,OAAO,CAACC,GAAG;AAExE,MAAMC,IAAI,GAAGvC,UAAU,CAACiC,IAAI,IAAI,EAAE,CAAC;AACnC,IAAInC,KAAK,CAACyC,IAAI,CAAC,EAAE;EACfC,UAAU,CAAC;IAACC,KAAK,EAAE,OAAO;IAAExB,GAAG,EAAG,6BAA4BgB,IAAK,EAAC;IAAES,IAAI,EAAE,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAC,CAAC;EAC5F;EACAN,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC;AACjB;AAEA,IAAIR,YAAY,KAAKrF,SAAS,EAAE;EAC9ByF,UAAU,CAAC;IAACC,KAAK,EAAE,OAAO;IAAExB,GAAG,EAAG,kCAAiC;IAAEyB,IAAI,EAAE,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAC,CAAC;EAC3F;EACAN,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC;AACjB;;AAEA;AACA;AACA;;AAEA,SAASC,MAAMA,CACbf,cAAuD,EACvDgB,GAAsB,EAChB;EACN,MAAMC,IAAI,GAAG3D,KAAK,CAACC,OAAO,CAACyD,GAAG,CAAC,GAAGA,GAAG,GAAG,CAACA,GAAG,CAAC;EAC7C,IAAIX,YAAY,KAAKpF,SAAS,IAAIgG,IAAI,CAACC,MAAM,KAAK,CAAC,EAAE;IACnD;EACF;EACAlB,cAAc,CAACK,YAAY,EAAEY,IAAI,CAACvD,GAAG,CAACsD,GAAG,IAAK,IAAG,IAAIrC,IAAI,CAAC,CAAC,CAACwC,WAAW,CAAC,CAAE,KAAIH,GAAI,IAAG,CAAC,CAACI,IAAI,CAAC,EAAE,CAAC,CAAC;AAClG;AAEA,SAASV,UAAUA,CAACC,KAAwB,EAAQ;EAClD,IAAIP,gBAAgB,KAAKnF,SAAS,EAAE;IAClC;EACF;EACA+E,uDAAc,CAACI,gBAAgB,EAAG,GAAE1D,IAAI,CAAC2E,SAAS,CAAC;IAACC,CAAC,EAAE,IAAI3C,IAAI,CAAC,CAAC,CAACwC,WAAW,CAAC,CAAC;IAAE,GAAGR;EAAK,CAAC,CAAE,IAAG,CAAC;AAClG;;AAEA;AACA,IAAIN,YAAY,KAAKpF,SAAS,EAAE;EAC9BgF,sDAAa,CAACI,YAAY,EAAE,EAAE,CAAC;AACjC;AACA,IAAID,gBAAgB,KAAKnF,SAAS,EAAE;EAClCgF,sDAAa,CAACG,gBAAgB,EAAE,EAAE,CAAC;AACrC;;AAEA;AACA;AACA;;AAEA;AACA,MAAMmB,MAAM,GAAGR,MAAM,CAACS,IAAI,CAAC,IAAI,EAAExB,mDAAc,CAAC;AAChDyB,OAAO,CAACT,GAAG,GAAG,CAAC,GAAGU,IAAe,KAAKH,MAAM,CAACG,IAAI,CAAChE,GAAG,CAACiE,GAAG,IAAIjF,IAAI,CAAC2E,SAAS,CAACM,GAAG,CAAC,CAAC,CAAC;AAClFF,OAAO,CAACG,KAAK,GAAG,CAAC,GAAGF,IAAe,KAAKH,MAAM,CAACG,IAAI,CAAChE,GAAG,CAACiE,GAAG,IAAIjF,IAAI,CAAC2E,SAAS,CAACM,GAAG,CAAC,CAAC,CAAC;AAEpF,IAAIE,OAA6B;AACjC;AACA,MAAM,EAAC,yBAA0BvB,YAAY,CAAC,CAC3CwB,IAAI,CAACC,QAAQ,IAAI;EAAA,IAAAC,MAAA;EAChB,MAAMC,eAAe,IAAAD,MAAA,GAAG5F,sDAAK,CAAC2F,QAAQ,CAAC,cAAAC,MAAA,uBAAfA,MAAA,CAAkB,SAAS,CAAC;EACpD,IAAI,OAAOC,eAAe,KAAK,UAAU,EAAE;IACzCvB,UAAU,CAAC;MACTC,KAAK,EAAE,OAAO;MACdxB,GAAG,EAAG,8CAA6C;MACnDyB,IAAI,EAAE,EAAE;MACRC,MAAM,EAAE;IACV,CAAC,CAAC;IACF;IACAN,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC;EACjB;EACAe,OAAO,GAAGI,eAAe;AAC3B,CAAC,CAAC,CACDC,KAAK,CAAC/C,GAAG,IAAI;EACZuB,UAAU,CAAC;IACTC,KAAK,EAAE,OAAO;IACdxB,GAAG,EAAG,mCAAkCG,sEAAqB,CAACH,GAAG,CAAE,EAAC;IACpEyB,IAAI,EAAE,EAAE;IACRC,MAAM,EAAE;EACV,CAAC,CAAC;EACF;EACAN,OAAO,CAACO,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;;AAEJ;AACA;AACA;;AAEA,MAAMqB,MAAM,GAAGjC,uDAAY,CAAC,CAACkC,GAAoB,EAAExF,GAAmB,KAAK;EACzE,MAAMyF,GAAG,GAAGD,GAAG,CAACC,GAAG,IAAI,EAAE;EAEzB,IAAIA,GAAG,CAACC,UAAU,CAAC,UAAU,CAAC,EAAE;IAC9B1F,GAAG,CAAC2F,GAAG,CAAC,CAAC;IACT;EACF;EAEA,MAAM1B,MAAM,GAAGuB,GAAG,CAACvB,MAAM,IAAI,EAAE;EAE/B,MAAM2B,aAAa,GAAIrD,GAAW,IAAW;IAC3CuB,UAAU,CAAC;MAACC,KAAK,EAAE,OAAO;MAAExB,GAAG;MAAEyB,IAAI,EAAEyB,GAAG;MAAExB;IAAM,CAAC,CAAC;IACpDjE,GAAG,CAAC6F,UAAU,GAAG,GAAG;IACpB7F,GAAG,CAAC2F,GAAG,CAAC,CAAC;EACX,CAAC;EAED,IAAI;IACF;IACA,IAAIG,IAAI,GAAG,EAAE;IACbN,GAAG,CAACO,EAAE,CAAC,MAAM,EAAEC,KAAK,IAAI;MACtBF,IAAI,IAAIE,KAAK;IACf,CAAC,CAAC;;IAEF;IACA,MAAMC,SAAS,GAAG,IAAIC,GAAG,CAAE,mBAAkBT,GAAI,EAAC,CAAC;IACnD,MAAMU,cAAc,GAAGF,SAAS,CAACG,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC;IAChD,MAAMC,qBAAqB,GAAG5H,MAAM,CAACQ,WAAW,CAAC,CAC/C,GAAG,IAAIqH,eAAe,CAACC,kBAAkB,CAACL,cAAc,CAAC,CAAC,CAAChH,OAAO,CAAC,CAAC,CACrE,CAAC;IAEF,MAAMsH,OAAO,GAAGA,CACdX,IAAqB,EACrBY,QAAgB;IAChB;IACAb,UAAU,GAAG,GAAG,EAChBc,OAA+B,GAAG,CAAC,CAAC,KAC3B;MACT7C,UAAU,CAAC;QACTC,KAAK,EAAE,UAAU;QACjBC,IAAI,EAAEyB,GAAG;QACTxB,MAAM;QACN4B,UAAU;QACVa,QAAQ;QACRC,OAAO;QACPC,UAAU,EAAEd,IAAI,CAACxB;MACnB,CAAC,CAAC;MACFtE,GAAG,CAAC6F,UAAU,GAAGA,UAAU;MAC3B,KAAK,MAAM,CAACgB,UAAU,EAAEC,WAAW,CAAC,IAAIpI,MAAM,CAACS,OAAO,CAACwH,OAAO,CAAC,EAAE;QAC/D3G,GAAG,CAAC+G,SAAS,CAACF,UAAU,EAAEC,WAAW,CAAC;MACxC;MACA9G,GAAG,CAACgH,KAAK,CAAClB,IAAI,CAAC;MACf9F,GAAG,CAAC2F,GAAG,CAAC,CAAC;IACX,CAAC;IAEDH,GAAG,CAACO,EAAE,CAAC,KAAK,EAAE,MAAM;MAClB;MACAjC,UAAU,CAAC;QAACC,KAAK,EAAE,SAAS;QAAEC,IAAI,EAAEyB,GAAG;QAAExB,MAAM;QAAE2C,UAAU,EAAEd,IAAI,CAACxB;MAAM,CAAC,CAAC;;MAE1E;MACA,MAAMP,KAAK,GAAG;QACZkD,OAAO,EAAE,KAAK;QACdC,QAAQ,EAAE,UAAU;QACpBC,OAAO,EAAElB,SAAS,CAACmB,QAAQ;QAC3BjB,cAAc;QACdQ,OAAO,EAAEnB,GAAG,CAACmB,OAAO;QACpBL,qBAAqB;QACrBe,cAAc,EAAE;UACdC,SAAS,EAAE,WAAW;UACtB;UACA;UACA;UACAC,IAAI,EAAE;YACJtD,MAAM;YACND,IAAI,EAAEiC,SAAS,CAACmB,QAAQ;YACxB;YACA;YACAI,SAAS,EAAEhC,GAAG,CAACmB,OAAO,CAAC,YAAY;UACrC,CAAC;UACDc,SAAS,EAAEtE,uDAAU,CAAC,CAAC;UACvB+D,QAAQ,EAAE,UAAU;UACpBQ,KAAK,EAAE,UAAU;UACjBC,SAAS,EAAE5F,IAAI,CAAC6F,GAAG,CAAC;QACtB,CAAC;QACD9B,IAAI;QACJ+B,eAAe,EAAE;MACnB,CAAC;;MAED;MACA,IAAI,CAAC5C,OAAO,EAAE;QACZ;QACAwB,OAAO,CAAC,0BAA0B,EAAE,CAAC,EAAE,GAAG,CAAC;QAC3C;MACF;MACA,MAAMqB,OAAO,GAAG/F,IAAI,CAAC6F,GAAG,CAAC,CAAC;MAC1BG,OAAO,CAACC,OAAO,CAAC/C,OAAO,CAAClB,KAAK,CAAC,CAAC,CAC5BmB,IAAI,CAAC+C,UAAU,IAAI;QAClB,MAAMvB,QAAQ,GAAG3E,IAAI,CAAC6F,GAAG,CAAC,CAAC,GAAGE,OAAO;QACrC,IAAI;UACF,IAAIG,UAAU,KAAK5J,SAAS,EAAE;YAC5B,OAAOuH,aAAa,CAAE,qBAAoB9F,IAAI,CAAC2E,SAAS,CAACwD,UAAU,CAAE,EAAC,CAAC;UACzE;UACAjI,GAAG,CAAC+G,SAAS,CAAC,cAAc,EAAE,kBAAkB,CAAC;UACjD,IACE,OAAOkB,UAAU,KAAK,QAAQ;UAC9B;UACAA,UAAU,KAAK,IAAI,IACnB,CAACvH,KAAK,CAACC,OAAO,CAACsH,UAAU,CAAC,EAC1B;YACA,MAAM;cAACnC,IAAI;cAAEa,OAAO;cAAEd,UAAU;cAAEgC;YAAe,CAAC,GAAGI,UAAU;YAC/D,IAAI,EAAE,YAAY,IAAIA,UAAU,CAAC,EAAE;cACjC,OAAOxB,OAAO,CAAC3G,IAAI,CAAC2E,SAAS,CAACwD,UAAU,CAAC,EAAEvB,QAAQ,CAAC;YACtD,CAAC,MAAM,IAAI,OAAOb,UAAU,KAAK,QAAQ,EAAE;cACzC,OAAOD,aAAa,CAAE,cAAa9F,IAAI,CAAC2E,SAAS,CAACoB,UAAU,CAAE,kBAAiB,CAAC;YAClF;YACA,MAAMqC,OAAO,GACX,OAAOpC,IAAI,KAAK,QAAQ,GACpB,OAAO+B,eAAe,KAAK,SAAS,IAAIA,eAAe,GACrDM,MAAM,CAACC,IAAI,CAACtC,IAAI,EAAE,QAAQ,CAAC,GAC3BA,IAAI,GACNhG,IAAI,CAAC2E,SAAS,CAACqB,IAAI,CAAC;YAC1B;YACA,OAAOW,OAAO,CAACyB,OAAO,EAAExB,QAAQ,EAAEb,UAAU,EAAEc,OAAO,CAAC;UACxD,CAAC,MAAM,IAAI,OAAOsB,UAAU,KAAK,QAAQ,EAAE;YACzC,OAAOxB,OAAO,CAACwB,UAAU,EAAEvB,QAAQ,CAAC;UACtC;UACA,OAAOD,OAAO,CAAC3G,IAAI,CAAC2E,SAAS,CAACwD,UAAU,CAAC,EAAEvB,QAAQ,CAAC;QACtD,CAAC,CAAC,OAAOnE,GAAY,EAAE;UACrB,OAAOqD,aAAa,CAAClD,sEAAqB,CAACH,GAAG,CAAC,CAAC;QAClD;MACF,CAAC,CAAC,CACD+C,KAAK,CAAE/C,GAAY,IAAK;QACvB,OAAOqD,aAAa,CAAClD,sEAAqB,CAACH,GAAG,CAAC,CAAC;MAClD,CAAC,CAAC;IACN,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOA,GAAY,EAAE;IACrBqD,aAAa,CAAC3D,MAAM,CAACM,GAAG,CAAC,CAAC;EAC5B;AACF,CAAC,CAAC,CACC8F,MAAM,CAAC9E,IAAI,CAAC,CACZwC,EAAE,CAAC,OAAO,EAAExD,GAAG,IAAI;EAClBuB,UAAU,CAAC;IAACC,KAAK,EAAE,OAAO;IAAExB,GAAG,EAAEG,sEAAqB,CAACH,GAAG,CAAC;IAAEyB,IAAI,EAAE,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAC,CAAC;AACrF,CAAC,CAAC,CACD8B,EAAE,CAAC,WAAW,EAAE,MAAM;EACrBjC,UAAU,CAAC;IAACC,KAAK,EAAE,OAAO;IAAEF;EAAI,CAAC,CAAC;AACpC,CAAC,CAAC;AAEJ,SAASyE,OAAOA,CAAA,EAAS;EACvB/C,MAAM,CAACgD,KAAK,CAAC,CAAC;AAChB;AAEA5E,OAAO,CAACoC,EAAE,CAAC,QAAQ,EAAE,MAAMuC,OAAO,CAAC,CAAC,CAAC;AACrC3E,OAAO,CAACoC,EAAE,CAAC,SAAS,EAAE,MAAMuC,OAAO,CAAC,CAAC,CAAC;AACtC3E,OAAO,CAACoC,EAAE,CAAC,mBAAmB,EAAExD,GAAG,IAAI;EACrCuB,UAAU,CAAC;IAACC,KAAK,EAAE,OAAO;IAAExB,GAAG,EAAEG,sEAAqB,CAACH,GAAG,CAAC;IAAEyB,IAAI,EAAE,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAC,CAAC;EACnFqE,OAAO,CAAC,CAAC;AACX,CAAC,CAAC;AACF3E,OAAO,CAACoC,EAAE,CAAC,oBAAoB,EAAExD,GAAG,IAAI;EACtCuB,UAAU,CAAC;IAACC,KAAK,EAAE,OAAO;IAAExB,GAAG,EAAEG,sEAAqB,CAACH,GAAG,CAAC;IAAEyB,IAAI,EAAE,EAAE;IAAEC,MAAM,EAAE;EAAE,CAAC,CAAC;EACnFqE,OAAO,CAAC,CAAC;AACX,CAAC,CAAC,C","sources":["webpack://b/external node-commonjs \"node:crypto\"","webpack://b/external node-commonjs \"node:fs\"","webpack://b/external node-commonjs \"node:http\"","webpack://b/./src/type_utils.ts","webpack://b/webpack/bootstrap","webpack://b/webpack/runtime/compat get default export","webpack://b/webpack/runtime/define property getters","webpack://b/webpack/runtime/hasOwnProperty shorthand","webpack://b/webpack/runtime/make namespace object","webpack://b/./src/lambda-server-runtime/runtime.ts"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:crypto\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:fs\");","module.exports = __WEBPACK_EXTERNAL_createRequire(import.meta.url)(\"node:http\");","function notUndefined<T>(val: T | undefined): val is T {\n  return val !== undefined;\n}\n\nexport function isString(val: unknown): val is string {\n  return typeof val === 'string';\n}\n\nexport function isNumber(val: unknown): val is number {\n  return typeof val === 'number';\n}\n\nexport function iterNumberEnum<T extends Record<string, string | number>>(e: T): T[keyof T][] {\n  return Object.values(e).filter(isNumber) as unknown as T[keyof T][];\n}\n\nexport function iterStringEnum<T extends Record<string, string>>(e: T): T[keyof T][] {\n  return Object.values(e).filter(isString) as unknown as T[keyof T][];\n}\n\nexport function removeUndefined<T>(arr: (T | undefined)[]): T[] {\n  return arr.filter(notUndefined);\n}\n\nexport function removeUndefinedOrNullProps<T extends Record<string, unknown>>(obj: T): {} {\n  return Object.fromEntries(\n    // eslint-disable-next-line no-null/no-null\n    Object.entries(obj).filter(e => e[1] !== undefined && e[1] !== null)\n  ) as T;\n}\n\nexport function neverHappens(value: never, errorMessage?: string): never {\n  throw new Error(errorMessage);\n}\n\nexport function asMap(value: unknown): Record<string, unknown> | undefined;\nexport function asMap(\n  value: unknown,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asMap(\n  value: unknown,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null\n    ? (value as Record<string, unknown>)\n    : defaultValue;\n}\nexport function asMapOrThrow(value: unknown): Record<string, unknown> {\n  const valueAsMap = asMap(value);\n  if (valueAsMap === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a map`);\n  }\n  return valueAsMap;\n}\n\nexport function asJson(value: string): Record<string, unknown> | undefined;\nexport function asJson(\n  value: string,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asJson(\n  value: string,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  try {\n    const json = JSON.parse(value);\n    const res = asMap(json);\n    return res ?? defaultValue;\n  } catch {\n    return defaultValue;\n  }\n}\nexport function asJsonOrThrow(value: string): Record<string, unknown> {\n  const valueAsJson = asJson(value);\n  if (valueAsJson === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a valid JSON string of a map`);\n  }\n  return valueAsJson;\n}\n\nexport function asJsonString(value: unknown): Record<string, unknown> | undefined;\nexport function asJsonString(\n  value: unknown,\n  defaultValue: Record<string, unknown>\n): Record<string, unknown>;\nexport function asJsonString(\n  value: unknown,\n  defaultValue?: Record<string, unknown>\n): Record<string, unknown> | undefined {\n  const str = asString(value);\n  return str === undefined\n    ? defaultValue\n    : defaultValue === undefined\n      ? asJson(str)\n      : asJson(str, defaultValue);\n}\nexport function asJsonStringOrThrow(value: unknown): Record<string, unknown> {\n  return asJsonOrThrow(asStringOrThrow(value));\n}\n\nexport function asString<T extends string = string>(value: unknown): T | undefined;\nexport function asString<T extends string = string>(value: unknown, defaultValue: string): T;\nexport function asString<T extends string = string>(\n  value: unknown,\n  defaultValue?: string\n): T | undefined {\n  return (typeof value === 'string' ? value : defaultValue) as T;\n}\nexport function asStringOrThrow<T extends string = string>(value: unknown): T {\n  const valueAsString = asString<T>(value);\n  if (valueAsString === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a string`);\n  }\n  return valueAsString;\n}\n\nexport function asArray<T = unknown>(value: unknown): T[] | undefined;\nexport function asArray<T = unknown>(value: unknown, defaultValue: unknown[]): T[];\nexport function asArray<T = unknown>(value: unknown, defaultValue?: unknown[]): T[] | undefined {\n  return (Array.isArray(value) ? value : defaultValue) as T[];\n}\nexport function asArrayOrThrow<T = unknown>(value: unknown): T[] {\n  if (!Array.isArray(value)) {\n    throw new Error(`Invalid value: \\`${value}\\` is not an array`);\n  }\n  return value as T[];\n}\n\nexport function asStringArray<T extends string = string>(value: unknown): T[] | undefined;\nexport function asStringArray<T extends string = string>(\n  value: unknown,\n  defaultValue: string[]\n): T[];\nexport function asStringArray<T extends string = string>(\n  value: unknown,\n  defaultValue?: string[]\n): T[] | undefined {\n  const arr = asArray(value);\n  if (arr === undefined) {\n    return defaultValue as T[];\n  }\n  return removeUndefined(arr.map(s => asString<T>(s)));\n}\n\nexport function asStringArrayOrThrow<T extends string = string>(value: unknown): T[] {\n  const arr = asArrayOrThrow(value);\n  return arr.map(s => asStringOrThrow<T>(s));\n}\n\nexport function asMapArray(value: unknown): Record<string, unknown>[] | undefined;\nexport function asMapArray(\n  value: unknown,\n  defaultValue: Record<string, unknown>[]\n): Record<string, unknown>[];\nexport function asMapArray(\n  value: unknown,\n  defaultValue?: Record<string, unknown>[]\n): Record<string, unknown>[] | undefined {\n  const arr = asArray(value);\n  if (arr === undefined) {\n    return defaultValue;\n  }\n  return removeUndefined(arr.map(s => asMap(s)));\n}\nexport function asMapArrayOrThrow(value: unknown): Record<string, unknown>[] {\n  const arr = asArrayOrThrow(value);\n  return arr.map(s => asMapOrThrow(s));\n}\n\nexport function asNumber<T extends number = number>(value: unknown): T | undefined;\nexport function asNumber<T extends number = number>(value: unknown, defaultValue: number): T;\nexport function asNumber<T extends number = number>(\n  value: unknown,\n  defaultValue?: number\n): T | undefined {\n  if (typeof value === 'number') {\n    return (!isNaN(value) ? value : defaultValue) as T;\n  }\n  if (typeof value === 'string') {\n    try {\n      const parsedValue = parseFloat(value);\n      return (!isNaN(parsedValue) ? parsedValue : defaultValue) as T;\n    } catch {\n      return defaultValue as T;\n    }\n  }\n  return defaultValue as T;\n}\nexport function asNumberOrThrow<T extends number = number>(value: unknown): T {\n  const valueAsNumber = asNumber(value);\n  if (valueAsNumber === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a number`);\n  }\n  return valueAsNumber as T;\n}\n\nexport function asBoolean(value: unknown): boolean | undefined;\nexport function asBoolean(value: unknown, defaultValue: boolean): boolean;\nexport function asBoolean(value: unknown, defaultValue?: boolean): boolean | undefined {\n  if (typeof value === 'boolean') {\n    return value;\n  }\n  if (typeof value === 'number') {\n    return !isNaN(value) ? value !== 0 : false;\n  }\n  if (typeof value === 'string') {\n    if (value === '0' || value === 'false') {\n      return false;\n    } else if (value === '1' || value === 'true') {\n      return true;\n    }\n    return defaultValue;\n  }\n  return defaultValue;\n}\n\nexport function asBooleanOrThrow(value: unknown): boolean {\n  const valueAsBoolean = asBoolean(value);\n  if (valueAsBoolean === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` is not a boolean`);\n  }\n  return valueAsBoolean;\n}\n\nconst TIMESTAMP_REGEX = /^[0-9]{1,15}$/u;\nexport function asDate(value: unknown): Date | undefined;\nexport function asDate(value: unknown, defaultValue: Date): Date;\nexport function asDate(value: unknown, defaultValue?: Date): Date | undefined {\n  const date =\n    value instanceof Date\n      ? value\n      : new Date(\n          typeof value === 'string' && TIMESTAMP_REGEX.test(value)\n            ? parseFloat(value)\n            : String(value)\n        );\n  return isNaN(date.getTime()) ? defaultValue : date;\n}\n\nexport function asDateOrThrow(value: unknown): Date {\n  const valueAsDate = asDate(value);\n  if (valueAsDate === undefined) {\n    throw new Error(`Invalid value: \\`${value}\\` cannot be parsed as a Date`);\n  }\n  return valueAsDate;\n}\n\n// export function asDate(value: unknown): Date | undefined;\n// export function asDate(value: unknown, defaultValue: Date): Date;\n// export function asDate(value: unknown, defaultValue?: Date): Date | undefined {\n//   if (typeof value === 'number') {\n//     return new Date(value);\n//   }\n//   return value instanceof Date ? value : defaultValue;\n// }\n\nexport function isNull<T>(val: T | null): val is null {\n  // eslint-disable-next-line no-null/no-null\n  return val === null;\n}\n\nexport function asError(err: unknown): Error {\n  return err instanceof Error ? err : new Error(typeof err === 'string' ? err : String(err));\n}\n\nexport function errorAsString(err: unknown): string {\n  const errorMap = asMap(err);\n  if (errorMap === undefined) {\n    return asString(err) ?? String(err);\n  }\n\n  const errorMessage = asString(errorMap['message']);\n  if (errorMessage === undefined) {\n    return String(err);\n  }\n  return errorMessage;\n}\n\nexport function errorAndStackAsString(err: unknown): string {\n  const errorMap = asMap(err);\n  if (errorMap === undefined) {\n    return asString(err) ?? String(err);\n  }\n\n  const stack = asString(errorMap['stack']);\n  if (stack === undefined) {\n    return String(err);\n  }\n  return stack;\n}\n\nexport function asConstantOrThrow<T>(value: unknown, expected: T): T {\n  if (value !== expected) {\n    throw new Error(`Invalid value: \\`${value}\\`, expected \\`${expected}\\``);\n  }\n  return value as T;\n}\n\n// export function asParsedJson<T>(json: string): T {\n//   try {\n//     return JSON.parse(json) as T;\n//   } catch {\n//     const defaultValue = {};\n//     return defaultValue as T;\n//   }\n// }\nexport function parseJson(\n  json: string\n): {res: unknown; err: undefined} | {res: undefined; err: unknown} {\n  try {\n    return {res: JSON.parse(json), err: undefined};\n  } catch (err: unknown) {\n    return {err, res: undefined};\n  }\n}\nexport type Brand<Type, Name> = Type & {__brand: Name};\nexport type StringBrand = string & {__brand: string};\nexport type NumberBrand = number & {__brand: number};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type AnyBrand = (string | number) & {__brand: any};\n\nexport type Untrusted<T> = T extends\n  | Function\n  | Date\n  | boolean\n  | number\n  | string\n  | undefined\n  | null\n  | unknown[]\n  ? unknown\n  : {[P in keyof T]?: Untrusted<T[P]>};\n\nexport type DeepPartial<T> = T extends\n  | Function\n  | Date\n  | boolean\n  | number\n  | string\n  | undefined\n  | null\n  | unknown[]\n  ? T\n  : {[P in keyof T]?: DeepPartial<T[P]>};\n\nexport type MapInterface<I, Type> = {[Key in keyof I]: Type};\n// Get all the keys of a type including the optional attributes\ntype NonHomomorphicKeys<T> = ({[P in keyof T]: P} & None)[keyof T];\nexport type MapInterfaceStrict<I, Type> = {[Key in NonHomomorphicKeys<I>]: Type};\n\ntype KeysOfType<T, Type> = {[Key in keyof T]: T[Key] extends Type ? Key : never}[keyof T];\nexport type RestrictInterface<T, Type> = Pick<T, KeysOfType<T, Type>>;\n\ninterface RecursiveArray<T> extends Array<T | RecursiveArray<T>> {}\nexport type NestedArray<T> = (T | RecursiveArray<T>)[];\n\n// Type for an empty object (ie: {})\nexport type None = Record<string, never>;\n\nexport type NonEmptyArray<T> = [T, ...T[]];\n\nexport type AddPrefix<T, P extends string> = {\n  [K in keyof T as K extends string ? `${P}${K}` : never]: T[K];\n};\nexport function addPrefix<T extends Record<string, unknown>, Prefix extends string>(\n  attr: T,\n  prefix: Prefix\n): AddPrefix<T, Prefix> {\n  return Object.fromEntries(\n    Object.entries(attr).map(([key, value]) => [`${prefix}${key}`, value])\n  ) as AddPrefix<T, Prefix>;\n}\n\nexport type WithNull<T> = {\n  [Key in keyof T]: T[Key] extends Exclude<T[Key], undefined> ? T[Key] : T[Key] | null;\n};\ntype Id<T> = T;\nexport type Flatten<T> = Id<{[k in keyof T]: T[k]}>;\n\nexport type Defined<T> = Exclude<T, undefined>;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import {randomUUID} from 'node:crypto';\nimport {appendFileSync, writeFileSync} from 'node:fs';\nimport {createServer, IncomingMessage, ServerResponse} from 'node:http';\n\nimport {asMap, errorAndStackAsString} from '@src/type_utils';\nimport {LambdaServerEvent} from '@src/webpack/plugins/lambda_server_plugin';\n\n//\n// ENV VARIABLES LOADING\n//\n\n// eslint-disable-next-line node/no-process-env\nconst {PORT, RUNTIME_LOG_FILE, APP_LOG_FILE, HANDLER_PATH} = process.env;\n\nconst port = parseFloat(PORT ?? '');\nif (isNaN(port)) {\n  runtimeLog({event: 'error', err: `Invalid process.env.PORT: ${PORT}`, path: '', method: ''});\n  // eslint-disable-next-line node/no-process-exit\n  process.exit(0);\n}\n\nif (HANDLER_PATH === undefined) {\n  runtimeLog({event: 'error', err: `Missing process.env.HANDLER_PATH`, path: '', method: ''});\n  // eslint-disable-next-line node/no-process-exit\n  process.exit(0);\n}\n\n//\n// LOGGING FUNCTIONS\n//\n\nfunction appLog(\n  appendFileSync: (file: string, content: string) => void,\n  log: string | string[]\n): void {\n  const logs = Array.isArray(log) ? log : [log];\n  if (APP_LOG_FILE === undefined || logs.length === 0) {\n    return;\n  }\n  appendFileSync(APP_LOG_FILE, logs.map(log => `[${new Date().toISOString()}] ${log}\\n`).join(''));\n}\n\nfunction runtimeLog(event: LambdaServerEvent): void {\n  if (RUNTIME_LOG_FILE === undefined) {\n    return;\n  }\n  appendFileSync(RUNTIME_LOG_FILE, `${JSON.stringify({t: new Date().toISOString(), ...event})}\\n`);\n}\n\n// Clear all previous logs\nif (APP_LOG_FILE !== undefined) {\n  writeFileSync(APP_LOG_FILE, '');\n}\nif (RUNTIME_LOG_FILE !== undefined) {\n  writeFileSync(RUNTIME_LOG_FILE, '');\n}\n\n//\n// HANDLER LOADING\n//\n\n// eslint-disable-next-line no-null/no-null\nconst logger = appLog.bind(null, appendFileSync);\nconsole.log = (...args: unknown[]) => logger(args.map(arg => JSON.stringify(arg)));\nconsole.error = (...args: unknown[]) => logger(args.map(arg => JSON.stringify(arg)));\n\nlet handler: Function | undefined;\n// eslint-disable-next-line import/dynamic-import-chunkname, node/no-unsupported-features/es-syntax\nimport(/* webpackIgnore: true */ HANDLER_PATH)\n  .then(imported => {\n    const importedHandler = asMap(imported)?.['handler'];\n    if (typeof importedHandler !== 'function') {\n      runtimeLog({\n        event: 'error',\n        err: `Lambda is not exporting a \"handler\" function`,\n        path: '',\n        method: '',\n      });\n      // eslint-disable-next-line node/no-process-exit\n      process.exit(0);\n    }\n    handler = importedHandler;\n  })\n  .catch(err => {\n    runtimeLog({\n      event: 'error',\n      err: `Failure to load lambda handler: ${errorAndStackAsString(err)}`,\n      path: '',\n      method: '',\n    });\n    // eslint-disable-next-line node/no-process-exit\n    process.exit(0);\n  });\n\n//\n// LAMBDA SERVER\n//\n\nconst server = createServer((req: IncomingMessage, res: ServerResponse) => {\n  const url = req.url ?? '';\n\n  if (url.startsWith('/favicon')) {\n    res.end();\n    return;\n  }\n\n  const method = req.method ?? '';\n\n  const internalError = (err: string): void => {\n    runtimeLog({event: 'error', err, path: url, method});\n    res.statusCode = 500;\n    res.end();\n  };\n\n  try {\n    // Parse body\n    let body = '';\n    req.on('data', chunk => {\n      body += chunk;\n    });\n\n    // Parse URL\n    const parsedUrl = new URL(`http://localhost${url}`);\n    const rawQueryString = parsedUrl.search.slice(1);\n    const queryStringParameters = Object.fromEntries([\n      ...new URLSearchParams(decodeURIComponent(rawQueryString)).entries(),\n    ]);\n\n    const sendRes = (\n      body: string | Buffer,\n      duration: number,\n      // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n      statusCode = 200,\n      headers: Record<string, string> = {}\n    ): void => {\n      runtimeLog({\n        event: 'response',\n        path: url,\n        method,\n        statusCode,\n        duration,\n        headers,\n        bodyLength: body.length,\n      });\n      res.statusCode = statusCode;\n      for (const [headerName, headerValue] of Object.entries(headers)) {\n        res.setHeader(headerName, headerValue);\n      }\n      res.write(body);\n      res.end();\n    };\n\n    req.on('end', () => {\n      // Log the request\n      runtimeLog({event: 'request', path: url, method, bodyLength: body.length});\n\n      // Create the lambda event\n      const event = {\n        version: '2.0',\n        routeKey: '$default',\n        rawPath: parsedUrl.pathname,\n        rawQueryString,\n        headers: req.headers,\n        queryStringParameters,\n        requestContext: {\n          accountId: 'anonymous',\n          // apiId: 'rqez6mmiihukf4yvq2l7rrq2340xpkvp',\n          // domainName: 'rqez6mmiihukf4yvq2l7rrq2340xpkvp.lambda-url.eu-west-3.on.aws',\n          // domainPrefix: 'rqez6mmiihukf4yvq2l7rrq2340xpkvp',\n          http: {\n            method,\n            path: parsedUrl.pathname,\n            // protocol: 'HTTP/1.1',\n            // sourceIp: '88.138.164.86',\n            userAgent: req.headers['user-agent'],\n          },\n          requestId: randomUUID(),\n          routeKey: '$default',\n          stage: '$default',\n          timeEpoch: Date.now(),\n        },\n        body,\n        isBase64Encoded: false,\n      };\n\n      // Run the handler\n      if (!handler) {\n        // eslint-disable-next-line @typescript-eslint/no-magic-numbers\n        sendRes('Lambda handler not found', 0, 404);\n        return;\n      }\n      const startTs = Date.now();\n      Promise.resolve(handler(event))\n        .then(handlerRes => {\n          const duration = Date.now() - startTs;\n          try {\n            if (handlerRes === undefined) {\n              return internalError(`Invalid response: ${JSON.stringify(handlerRes)}`);\n            }\n            res.setHeader('Content-Type', 'application/json');\n            if (\n              typeof handlerRes === 'object' &&\n              // eslint-disable-next-line no-null/no-null\n              handlerRes !== null &&\n              !Array.isArray(handlerRes)\n            ) {\n              const {body, headers, statusCode, isBase64Encoded} = handlerRes;\n              if (!('statusCode' in handlerRes)) {\n                return sendRes(JSON.stringify(handlerRes), duration);\n              } else if (typeof statusCode !== 'number') {\n                return internalError(`statusCode ${JSON.stringify(statusCode)} is not a number`);\n              }\n              const resBody =\n                typeof body === 'string'\n                  ? typeof isBase64Encoded === 'boolean' && isBase64Encoded\n                    ? Buffer.from(body, 'base64')\n                    : body\n                  : JSON.stringify(body);\n              // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n              return sendRes(resBody, duration, statusCode, headers);\n            } else if (typeof handlerRes === 'string') {\n              return sendRes(handlerRes, duration);\n            }\n            return sendRes(JSON.stringify(handlerRes), duration);\n          } catch (err: unknown) {\n            return internalError(errorAndStackAsString(err));\n          }\n        })\n        .catch((err: unknown) => {\n          return internalError(errorAndStackAsString(err));\n        });\n    });\n  } catch (err: unknown) {\n    internalError(String(err));\n  }\n})\n  .listen(PORT)\n  .on('error', err => {\n    runtimeLog({event: 'error', err: errorAndStackAsString(err), path: '', method: ''});\n  })\n  .on('listening', () => {\n    runtimeLog({event: 'start', port});\n  });\n\nfunction cleanup(): void {\n  server.close();\n}\n\nprocess.on('SIGINT', () => cleanup());\nprocess.on('SIGTERM', () => cleanup());\nprocess.on('uncaughtException', err => {\n  runtimeLog({event: 'error', err: errorAndStackAsString(err), path: '', method: ''});\n  cleanup();\n});\nprocess.on('unhandledRejection', err => {\n  runtimeLog({event: 'error', err: errorAndStackAsString(err), path: '', method: ''});\n  cleanup();\n});\n"],"names":["notUndefined","val","undefined","isString","isNumber","iterNumberEnum","e","Object","values","filter","iterStringEnum","removeUndefined","arr","removeUndefinedOrNullProps","obj","fromEntries","entries","neverHappens","value","errorMessage","Error","asMap","defaultValue","asMapOrThrow","valueAsMap","asJson","json","JSON","parse","res","asJsonOrThrow","valueAsJson","asJsonString","str","asString","asJsonStringOrThrow","asStringOrThrow","valueAsString","asArray","Array","isArray","asArrayOrThrow","asStringArray","map","s","asStringArrayOrThrow","asMapArray","asMapArrayOrThrow","asNumber","isNaN","parsedValue","parseFloat","asNumberOrThrow","valueAsNumber","asBoolean","asBooleanOrThrow","valueAsBoolean","TIMESTAMP_REGEX","asDate","date","Date","test","String","getTime","asDateOrThrow","valueAsDate","isNull","asError","err","errorAsString","errorMap","errorAndStackAsString","stack","asConstantOrThrow","expected","parseJson","addPrefix","attr","prefix","key","randomUUID","appendFileSync","writeFileSync","createServer","PORT","RUNTIME_LOG_FILE","APP_LOG_FILE","HANDLER_PATH","process","env","port","runtimeLog","event","path","method","exit","appLog","log","logs","length","toISOString","join","stringify","t","logger","bind","console","args","arg","error","handler","then","imported","_asMap","importedHandler","catch","server","req","url","startsWith","end","internalError","statusCode","body","on","chunk","parsedUrl","URL","rawQueryString","search","slice","queryStringParameters","URLSearchParams","decodeURIComponent","sendRes","duration","headers","bodyLength","headerName","headerValue","setHeader","write","version","routeKey","rawPath","pathname","requestContext","accountId","http","userAgent","requestId","stage","timeEpoch","now","isBase64Encoded","startTs","Promise","resolve","handlerRes","resBody","Buffer","from","listen","cleanup","close"],"sourceRoot":""}